// Category: tools/editFile
// Modules: 1
// Total size: 4,398 chars


// === Module: YZB (offset: 0xc9da79, 4,398 chars) ===
var YZB=z(()=>{rC();fw();ZE();mO();ZN();qI();Mu();wC();zKA();RZB();Fu();KZB=dE({metadata:{name:"editFile",displayName:"Edit File",description:SME,category:"file",requiresConfirmation:!0,requiresSequentialExecution:!0},inputSchema:S.object({path:S.string().describe("The path to the file to edit."),oldText:S.string().describe("The text to replace (must be unique within the file)."),newText:S.string().describe("The text to replace it with (must be different from oldText)."),replaceAll:S.boolean().optional().describe("Replace all occurrences of oldText (default false).")}),validateParams:({oldText:A,newText:B})=>{if(A===B)return"oldText and newText cannot be identical";if(!A)return"oldText cannot be empty";return null},getDescription:({path:A})=>{return`Editing ${UK.basename(A)}`},getLocations:()=>[],shouldConfirm:async(A,B)=>{let{path:Q,oldText:E,newText:g,replaceAll:C}=A,I=UK.basename(Q),w=Bun.file(Q);if(!await w.exists())return null;let D;try{D=await w.text()}catch{return null}let H=Do(D),L=Do(E),R=Do(g),U;try{U=jKA(H,L,R,C)}catch{return null}let G=c4(Q,H,U);return{type:"edit",title:`Edit ${I}`,description:`Replace text in ${Q}`,affectedPaths:[Q],isDestructive:!1,fileName:I,fileDiff:G,originalContent:H,newContent:U}},execute:async({path:A,oldText:B,newText:Q,replaceAll:E=!1},g)=>{let C=Date.now(),I=UK.isAbsolute(A)?A:UK.resolve(g.projectRoot,A),w=UK.basename(I),D=g.projectRoot;if(fA.debug("[editFile] Starting",{path:I,replaceAll:E,oldTextLength:B.length,newTextLength:Q.length}),!xx(I,D))return fA.warn("[editFile] Blocked: path outside project",{path:I,projectRoot:D}),{success:!1,llmContent:`Error: File path "${A}" is outside the project directory "${D}". File operations are restricted to the project folder.`,returnDisplay:"Blocked: path outside project"};if(g.sessionId&&g.sessionCreatedAt&&!Cz("editFile",g.mode??"act",I,{projectRoot:D,sessionSlug:g.sessionSlug??"",createdAt:g.sessionCreatedAt}))return{success:!1,llmContent:`Error: In plan mode, you can only edit the plan file at ${aU(D,g.sessionSlug??"",g.sessionCreatedAt)}. Attempted to edit ${I} which is not allowed.`,returnDisplay:"Blocked: plan mode restriction"};try{if(!await Bun.file(I).exists())return{success:!1,llmContent:`File not found: ${I}`,returnDisplay:"File not found."};return yB.getState().snapshotService?.registerFile(I),await Hu(I,async()=>{let R=await Bun.file(I).text(),U=Do(R),G=Do(B),Y=Do(Q),J;try{J=jKA(U,G,Y,E)}catch(q){let s=uQ(q);return{success:!1,llmContent:`Failed to edit ${w}: ${s}`,returnDisplay:s}}let c=c4(I,U,J),h=g.sessionSlug&&g.sessionCreatedAt?aU(D,g.sessionSlug,g.sessionCreatedAt):null;if(!(g.mode==="plan"&&g.sessionSlug&&g.sessionCreatedAt&&h!==null&&I===h))await g.ask?.({permission:"edit",patterns:[I],always:["*"],metadata:{confirmationDetails:{type:"edit",title:`Edit ${w}`,description:`Replace text in ${I}`,affectedPaths:[I],isDestructive:!1,fileName:w,fileDiff:c,originalContent:U,newContent:J}}});await Bun.write(I,J),fA.info("[editFile] File edited successfully",{path:I,replaceAll:E,duration:Date.now()-C});let T=`Successfully edited ${I}.`,k=UK.extname(I);if(qN.includes(k))try{await sC.touchFile(I,!0);let j=((await sC.diagnostics())[I]||[]).filter((i)=>i.severity===1);if(j.length>0){let i=j.map(sC.formatDiagnostic).join(`
`);T+=`

This file has compilation errors that need to be fixed:
<file_diagnostics>
${i}
</file_diagnostics>`}}catch(q){fA.warn("LSP diagnostics failed",q)}return{success:!0,summary:`Edited ${w}`,llmContent:T,returnDisplay:`Edited ${w}`,locations:[{path:I,type:"write"}],diffData:{fileName:w,filePath:I,diff:c,isNewFile:!1},metadata:{toolParams:{path:I,replaceAll:E}}}})}catch(H){let L=uQ(H);return fA.error("[editFile] Failed",{path:I,error:L,duration:Date.now()-C}),{success:!1,llmContent:`Error editing file ${w}: ${L}`,returnDisplay:`Error editing file ${w}: ${L}`}}}})});import{readdir as xME,stat as SZB}from"fs/promises";import*as aJ from"path";async function fME(A,B,Q){if(B>Q)return[];let E=[];try{let g=await xME(A,{withFileTypes:!0});for(let C of g){if(C.name.startsWith("."))continue;if(C.isDirectory())E.push({name:C.name,type:"directory"});else if(C.isFile()){let I=await SZB(aJ.join(A,C.name));E.push({name:C.name,type:"file",size:I.size})}if(E.length>=vKA)break}}catch{return[]}return E.sort((g,C)=>{if(g.type!==C.type)return g.type==="directory"?-1:1;return g.name.localeCompare(C.name)})}var vKA=1000,JZB=5,xZB;
