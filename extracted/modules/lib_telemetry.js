// Category: lib/telemetry
// Modules: 36
// Total size: 51,240 chars


// === Module: cc (offset: 0x125317, 1,138 chars) ===
var cc=_((z8A)=>{Object.defineProperty(z8A,"__esModule",{value:!0});z8A.unregisterGlobal=z8A.getGlobal=z8A.registerGlobal=void 0;var J3B=O8A(),Th=M$(),S3B=W8A(),x3B=Th.VERSION.split(".")[0],vV=Symbol.for(`opentelemetry.js.api.${x3B}`),iV=J3B._globalThis;function f3B(A,B,Q,E=!1){var g;let C=iV[vV]=(g=iV[vV])!==null&&g!==void 0?g:{version:Th.VERSION};if(!E&&C[A]){let I=Error(`@opentelemetry/api: Attempted duplicate registration of API: ${A}`);return Q.error(I.stack||I.message),!1}if(C.version!==Th.VERSION){let I=Error(`@opentelemetry/api: Registration of version v${C.version} for ${A} does not match previously registered API v${Th.VERSION}`);return Q.error(I.stack||I.message),!1}return C[A]=B,Q.debug(`@opentelemetry/api: Registered a global for ${A} v${Th.VERSION}.`),!0}z8A.registerGlobal=f3B;function c3B(A){var B,Q;let E=(B=iV[vV])===null||B===void 0?void 0:B.version;if(!E||!(0,S3B.isCompatible)(E))return;return(Q=iV[vV])===null||Q===void 0?void 0:Q[A]}z8A.getGlobal=c3B;function k3B(A,B){B.debug(`@opentelemetry/api: Unregistering a global for ${A} v${Th.VERSION}.`);let Q=iV[vV];if(Q)delete Q[A]}z8A.unregisterGlobal=k3B});

// === Module: rNA (offset: 0x13b125, 338 chars) ===
var rNA=_((nNA)=>{Object.defineProperty(nNA,"__esModule",{value:!0});nNA.SDK_INFO=void 0;var HlB=gkA(),C2=yg(),FlB=mNA();nNA.SDK_INFO={[C2.ATTR_TELEMETRY_SDK_NAME]:"opentelemetry",[FlB.ATTR_PROCESS_RUNTIME_NAME]:"node",[C2.ATTR_TELEMETRY_SDK_LANGUAGE]:C2.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS,[C2.ATTR_TELEMETRY_SDK_VERSION]:HlB.VERSION}});

// === Module: VyA (offset: 0x1401c3, 361 chars) ===
var VyA=_((TyA)=>{Object.defineProperty(TyA,"__esModule",{value:!0});TyA.API_BACKWARDS_COMPATIBILITY_VERSION=TyA.makeGetter=TyA._global=TyA.GLOBAL_LOGS_API_KEY=void 0;TyA.GLOBAL_LOGS_API_KEY=Symbol.for("io.opentelemetry.js.api.logs");TyA._global=globalThis;function u$B(A,B,Q){return(E)=>E===A?B:Q}TyA.makeGetter=u$B;TyA.API_BACKWARDS_COMPATIBILITY_VERSION=1});

// === Module: A6A (offset: 0x14ded3, 12,492 chars) ===
var A6A=_((rZA)=>{Object.defineProperty(rZA,"__esModule",{value:!0});rZA.HttpInstrumentation=void 0;var sE=_B(),aS=JI(),lrB=RB("url"),$rB=hyA(),iD=XE(),Bn=RB("events"),PI=yg(),Vw=nZA();class pZA extends iD.InstrumentationBase{_spanNotEnded=new WeakSet;_headerCapture;_semconvStability=iD.SemconvStability.OLD;constructor(A={}){super("@opentelemetry/instrumentation-http",$rB.VERSION,A);this._headerCapture=this._createHeaderCapture(),this._semconvStability=(0,iD.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._oldHttpServerDurationHistogram=this.meter.createHistogram("http.server.duration",{description:"Measures the duration of inbound HTTP requests.",unit:"ms",valueType:sE.ValueType.DOUBLE}),this._oldHttpClientDurationHistogram=this.meter.createHistogram("http.client.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"ms",valueType:sE.ValueType.DOUBLE}),this._stableHttpServerDurationHistogram=this.meter.createHistogram(PI.METRIC_HTTP_SERVER_REQUEST_DURATION,{description:"Duration of HTTP server requests.",unit:"s",valueType:sE.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[0.005,0.01,0.025,0.05,0.075,0.1,0.25,0.5,0.75,1,2.5,5,7.5,10]}}),this._stableHttpClientDurationHistogram=this.meter.createHistogram(PI.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Duration of HTTP client requests.",unit:"s",valueType:sE.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[0.005,0.01,0.025,0.05,0.075,0.1,0.25,0.5,0.75,1,2.5,5,7.5,10]}})}_recordServerDuration(A,B,Q){if(this._semconvStability&iD.SemconvStability.OLD)this._oldHttpServerDurationHistogram.record(A,B);if(this._semconvStability&iD.SemconvStability.STABLE)this._stableHttpServerDurationHistogram.record(A/1000,Q)}_recordClientDuration(A,B,Q){if(this._semconvStability&iD.SemconvStability.OLD)this._oldHttpClientDurationHistogram.record(A,B);if(this._semconvStability&iD.SemconvStability.STABLE)this._stableHttpClientDurationHistogram.record(A/1000,Q)}setConfig(A={}){super.setConfig(A),this._headerCapture=this._createHeaderCapture()}init(){return[this._getHttpsInstrumentation(),this._getHttpInstrumentation()]}_getHttpInstrumentation(){return new iD.InstrumentationNodeModuleDefinition("http",["*"],(A)=>{let B=A[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){let Q=this._wrap(A,"request",this._getPatchOutgoingRequestFunction("http")),E=this._wrap(A,"get",this._getPatchOutgoingGetFunction(Q));if(B)A.default.request=Q,A.default.get=E}if(!this.getConfig().disableIncomingRequestInstrumentation)this._wrap(A.Server.prototype,"emit",this._getPatchIncomingRequestFunction("http"));return A},(A)=>{if(A===void 0)return;if(!this.getConfig().disableOutgoingRequestInstrumentation)this._unwrap(A,"request"),this._unwrap(A,"get");if(!this.getConfig().disableIncomingRequestInstrumentation)this._unwrap(A.Server.prototype,"emit")})}_getHttpsInstrumentation(){return new iD.InstrumentationNodeModuleDefinition("https",["*"],(A)=>{let B=A[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){let Q=this._wrap(A,"request",this._getPatchHttpsOutgoingRequestFunction("https")),E=this._wrap(A,"get",this._getPatchHttpsOutgoingGetFunction(Q));if(B)A.default.request=Q,A.default.get=E}if(!this.getConfig().disableIncomingRequestInstrumentation)this._wrap(A.Server.prototype,"emit",this._getPatchIncomingRequestFunction("https"));return A},(A)=>{if(A===void 0)return;if(!this.getConfig().disableOutgoingRequestInstrumentation)this._unwrap(A,"request"),this._unwrap(A,"get");if(!this.getConfig().disableIncomingRequestInstrumentation)this._unwrap(A.Server.prototype,"emit")})}_getPatchIncomingRequestFunction(A){return(B)=>{return this._incomingRequestFunction(A,B)}}_getPatchOutgoingRequestFunction(A){return(B)=>{return this._outgoingRequestFunction(A,B)}}_getPatchOutgoingGetFunction(A){return(B)=>{return function(E,...g){let C=A(E,...g);return C.end(),C}}}_getPatchHttpsOutgoingRequestFunction(A){return(B)=>{let Q=this;return function(g,...C){if(A==="https"&&typeof g==="object"&&g?.constructor?.name!=="URL")g=Object.assign({},g),Q._setDefaultOptions(g);return Q._getPatchOutgoingRequestFunction(A)(B)(g,...C)}}}_setDefaultOptions(A){A.protocol=A.protocol||"https:",A.port=A.port||443}_getPatchHttpsOutgoingGetFunction(A){return(B)=>{let Q=this;return function(g,...C){return Q._getPatchOutgoingGetFunction(A)(B)(g,...C)}}}_traceClientRequest(A,B,Q,E,g){if(this.getConfig().requestHook)this._callRequestHook(B,A);let C=!1;return A.prependListener("response",(I)=>{if(this._diag.debug("outgoingRequest on response()"),A.listenerCount("response")<=1)I.resume();let w=(0,Vw.getOutgoingRequestAttributesOnResponse)(I,this._semconvStability);if(B.setAttributes(w),E=Object.assign(E,(0,Vw.getOutgoingRequestMetricAttributesOnResponse)(w)),g=Object.assign(g,(0,Vw.getOutgoingStableRequestMetricAttributesOnResponse)(w)),this.getConfig().responseHook)this._callResponseHook(B,I);this._headerCapture.client.captureRequestHeaders(B,(H)=>A.getHeader(H)),this._headerCapture.client.captureResponseHeaders(B,(H)=>I.headers[H]),sE.context.bind(sE.context.active(),I);let D=()=>{if(this._diag.debug("outgoingRequest on end()"),C)return;C=!0;let H;if(I.aborted&&!I.complete)H={code:sE.SpanStatusCode.ERROR};else H={code:(0,Vw.parseResponseStatus)(sE.SpanKind.CLIENT,I.statusCode)};if(B.setStatus(H),this.getConfig().applyCustomAttributesOnSpan)(0,iD.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(B,A,I),()=>{},!0);this._closeHttpSpan(B,sE.SpanKind.CLIENT,Q,E,g)};I.on("end",D),I.on(Bn.errorMonitor,(H)=>{if(this._diag.debug("outgoingRequest on error()",H),C)return;C=!0,this._onOutgoingRequestError(B,E,g,Q,H)})}),A.on("close",()=>{if(this._diag.debug("outgoingRequest on request close()"),A.aborted||C)return;C=!0,this._closeHttpSpan(B,sE.SpanKind.CLIENT,Q,E,g)}),A.on(Bn.errorMonitor,(I)=>{if(this._diag.debug("outgoingRequest on request error()",I),C)return;C=!0,this._onOutgoingRequestError(B,E,g,Q,I)}),this._diag.debug("http.ClientRequest return request"),A}_incomingRequestFunction(A,B){let Q=this;return function(g,...C){if(g!=="request")return B.apply(this,[g,...C]);let I=C[0],w=C[1],D=I.method||"GET";if(Q._diag.debug(`${A} instrumentation incomingRequest`),(0,iD.safeExecuteInTheMiddle)(()=>Q.getConfig().ignoreIncomingRequestHook?.(I),(V)=>{if(V!=null)Q._diag.error("caught ignoreIncomingRequestHook error: ",V)},!0))return sE.context.with((0,aS.suppressTracing)(sE.context.active()),()=>{return sE.context.bind(sE.context.active(),I),sE.context.bind(sE.context.active(),w),B.apply(this,[g,...C])});let H=I.headers,L=(0,Vw.getIncomingRequestAttributes)(I,{component:A,serverName:Q.getConfig().serverName,hookAttributes:Q._callStartSpanHook(I,Q.getConfig().startIncomingSpanHook),semconvStability:Q._semconvStability,enableSyntheticSourceDetection:Q.getConfig().enableSyntheticSourceDetection||!1},Q._diag),R={kind:sE.SpanKind.SERVER,attributes:L},U=(0,aS.hrTime)(),G=(0,Vw.getIncomingRequestMetricAttributes)(L),Y={[PI.ATTR_HTTP_REQUEST_METHOD]:L[PI.ATTR_HTTP_REQUEST_METHOD],[PI.ATTR_URL_SCHEME]:L[PI.ATTR_URL_SCHEME]};if(L[PI.ATTR_NETWORK_PROTOCOL_VERSION])Y[PI.ATTR_NETWORK_PROTOCOL_VERSION]=L[PI.ATTR_NETWORK_PROTOCOL_VERSION];let J=sE.propagation.extract(sE.ROOT_CONTEXT,H),c=Q._startHttpSpan(D,R,J),h={type:aS.RPCType.HTTP,span:c};return sE.context.with((0,aS.setRPCMetadata)(sE.trace.setSpan(J,c),h),()=>{if(sE.context.bind(sE.context.active(),I),sE.context.bind(sE.context.active(),w),Q.getConfig().requestHook)Q._callRequestHook(c,I);if(Q.getConfig().responseHook)Q._callResponseHook(c,w);Q._headerCapture.server.captureRequestHeaders(c,(T)=>I.headers[T]);let V=!1;return w.on("close",()=>{if(V)return;Q._onServerResponseFinish(I,w,c,G,Y,U)}),w.on(Bn.errorMonitor,(T)=>{V=!0,Q._onServerResponseError(c,G,Y,U,T)}),(0,iD.safeExecuteInTheMiddle)(()=>B.apply(this,[g,...C]),(T)=>{if(T)throw Q._onServerResponseError(c,G,Y,U,T),T})})}}_outgoingRequestFunction(A,B){let Q=this;return function(g,...C){if(!(0,Vw.isValidOptionsType)(g))return B.apply(this,[g,...C]);let I=typeof C[0]==="object"&&(typeof g==="string"||g instanceof lrB.URL)?C.shift():void 0,{method:w,invalidUrl:D,optionsParsed:H}=(0,Vw.getRequestInfo)(Q._diag,g,I);if((0,iD.safeExecuteInTheMiddle)(()=>Q.getConfig().ignoreOutgoingRequestHook?.(H),(k)=>{if(k!=null)Q._diag.error("caught ignoreOutgoingRequestHook error: ",k)},!0))return B.apply(this,[H,...C]);let{hostname:L,port:R}=(0,Vw.extractHostnameAndPort)(H),U=(0,Vw.getOutgoingRequestAttributes)(H,{component:A,port:R,hostname:L,hookAttributes:Q._callStartSpanHook(H,Q.getConfig().startOutgoingSpanHook),redactedQueryParams:Q.getConfig().redactedQueryParams},Q._semconvStability,Q.getConfig().enableSyntheticSourceDetection||!1),G=(0,aS.hrTime)(),Y=(0,Vw.getOutgoingRequestMetricAttributes)(U),J={[PI.ATTR_HTTP_REQUEST_METHOD]:U[PI.ATTR_HTTP_REQUEST_METHOD],[PI.ATTR_SERVER_ADDRESS]:U[PI.ATTR_SERVER_ADDRESS],[PI.ATTR_SERVER_PORT]:U[PI.ATTR_SERVER_PORT]};if(U[PI.ATTR_HTTP_RESPONSE_STATUS_CODE])J[PI.ATTR_HTTP_RESPONSE_STATUS_CODE]=U[PI.ATTR_HTTP_RESPONSE_STATUS_CODE];if(U[PI.ATTR_NETWORK_PROTOCOL_VERSION])J[PI.ATTR_NETWORK_PROTOCOL_VERSION]=U[PI.ATTR_NETWORK_PROTOCOL_VERSION];let c={kind:sE.SpanKind.CLIENT,attributes:U},h=Q._startHttpSpan(w,c),V=sE.context.active(),T=sE.trace.setSpan(V,h);if(!H.headers)H.headers={};else H.headers=Object.assign({},H.headers);return sE.propagation.inject(T,H.headers),sE.context.with(T,()=>{let k=C[C.length-1];if(typeof k==="function")C[C.length-1]=sE.context.bind(V,k);let q=(0,iD.safeExecuteInTheMiddle)(()=>{if(D)return B.apply(this,[g,...C]);else return B.apply(this,[H,...C])},(s)=>{if(s)throw Q._onOutgoingRequestError(h,Y,J,G,s),s});return Q._diag.debug(`${A} instrumentation outgoingRequest`),sE.context.bind(V,q),Q._traceClientRequest(q,h,G,Y,J)})}}_onServerResponseFinish(A,B,Q,E,g,C){let I=(0,Vw.getIncomingRequestAttributesOnResponse)(A,B,this._semconvStability);E=Object.assign(E,(0,Vw.getIncomingRequestMetricAttributesOnResponse)(I)),g=Object.assign(g,(0,Vw.getIncomingStableRequestMetricAttributesOnResponse)(I)),this._headerCapture.server.captureResponseHeaders(Q,(D)=>B.getHeader(D)),Q.setAttributes(I).setStatus({code:(0,Vw.parseResponseStatus)(sE.SpanKind.SERVER,B.statusCode)});let w=I[PI.ATTR_HTTP_ROUTE];if(w)Q.updateName(`${A.method||"GET"} ${w}`);if(this.getConfig().applyCustomAttributesOnSpan)(0,iD.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(Q,A,B),()=>{},!0);this._closeHttpSpan(Q,sE.SpanKind.SERVER,C,E,g)}_onOutgoingRequestError(A,B,Q,E,g){(0,Vw.setSpanWithError)(A,g,this._semconvStability),Q[PI.ATTR_ERROR_TYPE]=g.name,this._closeHttpSpan(A,sE.SpanKind.CLIENT,E,B,Q)}_onServerResponseError(A,B,Q,E,g){(0,Vw.setSpanWithError)(A,g,this._semconvStability),Q[PI.ATTR_ERROR_TYPE]=g.name,this._closeHttpSpan(A,sE.SpanKind.SERVER,E,B,Q)}_startHttpSpan(A,B,Q=sE.context.active()){let E=B.kind===sE.SpanKind.CLIENT?this.getConfig().requireParentforOutgoingSpans:this.getConfig().requireParentforIncomingSpans,g,C=sE.trace.getSpan(Q);if(E===!0&&(!C||!sE.trace.isSpanContextValid(C.spanContext())))g=sE.trace.wrapSpanContext(sE.INVALID_SPAN_CONTEXT);else if(E===!0&&C?.spanContext().isRemote)g=C;else g=this.tracer.startSpan(A,B,Q);return this._spanNotEnded.add(g),g}_closeHttpSpan(A,B,Q,E,g){if(!this._spanNotEnded.has(A))return;A.end(),this._spanNotEnded.delete(A);let C=(0,aS.hrTimeToMilliseconds)((0,aS.hrTimeDuration)(Q,(0,aS.hrTime)()));if(B===sE.SpanKind.SERVER)this._recordServerDuration(C,E,g);else if(B===sE.SpanKind.CLIENT)this._recordClientDuration(C,E,g)}_callResponseHook(A,B){(0,iD.safeExecuteInTheMiddle)(()=>this.getConfig().responseHook(A,B),()=>{},!0)}_callRequestHook(A,B){(0,iD.safeExecuteInTheMiddle)(()=>this.getConfig().requestHook(A,B),()=>{},!0)}_callStartSpanHook(A,B){if(typeof B==="function")return(0,iD.safeExecuteInTheMiddle)(()=>B(A),()=>{},!0)}_createHeaderCapture(){let A=this.getConfig();return{client:{captureRequestHeaders:(0,Vw.headerCapture)("request",A.headersToSpanAttributes?.client?.requestHeaders??[]),captureResponseHeaders:(0,Vw.headerCapture)("response",A.headersToSpanAttributes?.client?.responseHeaders??[])},server:{captureRequestHeaders:(0,Vw.headerCapture)("request",A.headersToSpanAttributes?.server?.requestHeaders??[]),captureResponseHeaders:(0,Vw.headerCapture)("response",A.headersToSpanAttributes?.server?.responseHeaders??[])}}}}rZA.HttpInstrumentation=pZA});

// === Module: uY (offset: 0x16797b, 2,551 chars) ===
var uY=z(()=>{dM();rZ()});var Kv="operation.name",F9A="ai.operationId",Yv="ai.prompt",L9A="ai.schema",U9A="ai.response.object",G9A="ai.response.text",R9A="ai.response.toolCalls",Ik="ai.prompt.messages",LX="ai.prompt.tools",A6="ai.model.id",K9A="ai.response.providerMetadata",Y9A="ai.usage.cachedInputTokens",J9A="ai.telemetry.functionId",S9A="ai.usage.completionTokens",x9A="ai.usage.promptTokens",zp="ai.toolCall.name",jp="ai.toolCall.id",f9A="ai.toolCall.args",c9A="ai.toolCall.result";var vp=()=>{};function k9A(A,B){let Q=A.parent_span_id;if(!Q)return;let E=A.data[$I],g=A.data[lw];if(typeof E==="number"||typeof g==="number"){let C=B.get(Q)||{inputTokens:0,outputTokens:0};if(typeof E==="number")C.inputTokens+=E;if(typeof g==="number")C.outputTokens+=g;B.set(Q,C)}}function ip(A,B){let Q=B.get(A.span_id);if(!Q||!A.data)return;if(Q.inputTokens>0)A.data[$I]=Q.inputTokens;if(Q.outputTokens>0)A.data[lw]=Q.outputTokens;if(Q.inputTokens>0||Q.outputTokens>0)A.data["gen_ai.usage.total_tokens"]=Q.inputTokens+Q.outputTokens}function sp(A){return nZ.get(A)}function bp(A){nZ.delete(A)}function o9A(A){let B=A.map((Q)=>{if(typeof Q==="string")try{return JSON.parse(Q)}catch{return Q}return Q});return JSON.stringify(B)}function YBQ(A){try{let B=JSON.parse(A);if(!!B&&typeof B==="object"){let{prompt:Q,system:E}=B;if(typeof Q==="string"||typeof E==="string"){let g=[];if(typeof E==="string")g.push({role:"system",content:E});if(typeof Q==="string")g.push({role:"user",content:Q});return g}}}catch{}return[]}function h9A(A,B){if(B[Yv]){let E=S8(B[Yv]);A.setAttribute("gen_ai.prompt",E)}let Q=B[Yv];if(typeof Q==="string"&&!B[GM]&&!B[Ik]){let E=YBQ(Q);if(E.length){let{systemInstructions:g,filteredMessages:C}=IL(E);if(g)A.setAttribute(CL,g);let I=Array.isArray(C)?C.length:0;A.setAttributes({[GM]:S8(C),[hH]:I})}}else if(typeof B[Ik]==="string")try{let E=JSON.parse(B[Ik]);if(Array.isArray(E)){let{systemInstructions:g,filteredMessages:C}=IL(E);if(g)A.setAttribute(CL,g);let I=Array.isArray(C)?C.length:0;A.setAttributes({[Ik]:void 0,[GM]:S8(C),[hH]:I})}}catch{}}function X9A(A){switch(A){case"ai.generateText":case"ai.streamText":case"ai.generateObject":case"ai.streamObject":case"ai.embed":case"ai.embedMany":return Mv;case"ai.generateText.doGenerate":return l1A;case"ai.streamText.doStream":return $1A;case"ai.generateObject.doGenerate":return m1A;case"ai.streamObject.doStream":return n1A;case"ai.embed.doEmbed":return r1A;case"ai.embedMany.doEmbed":return e1A;case"ai.toolCall":return A9A;default:if(A.startsWith("ai.stream"))return"ai.run";return}}

// === Module: djA (offset: 0x18ac5e, 201 chars) ===
var djA=_((sjA)=>{Object.defineProperty(sjA,"__esModule",{value:!0});sjA.PACKAGE_NAME=sjA.PACKAGE_VERSION=void 0;sjA.PACKAGE_VERSION="0.21.0";sjA.PACKAGE_NAME="@opentelemetry/instrumentation-undici"});

// === Module: M2A (offset: 0x18d86f, 202 chars) ===
var M2A=_((w2A)=>{Object.defineProperty(w2A,"__esModule",{value:!0});w2A.PACKAGE_NAME=w2A.PACKAGE_VERSION=void 0;w2A.PACKAGE_VERSION="0.59.0";w2A.PACKAGE_NAME="@opentelemetry/instrumentation-express"});

// === Module: QvA (offset: 0x1942d7, 6,570 chars) ===
var QvA=z(()=>{m2A();zw=iA(_B(),1),Li=iA(JI(),1),BvA=iA(XE(),1),nw=iA(yg(),1),r2A=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend","onResponse","onError"],xI={HOOK_NAME:"hook.name",FASTIFY_TYPE:"fastify.type",HOOK_CALLBACK_NAME:"hook.callback.name",ROOT:"fastify.root"},O8={ROUTE:"route-hook",INSTANCE:"hook",HANDLER:"request-handler"},OH=Symbol("fastify otel instance"),N8=Symbol("fastify otel request spans"),z6=Symbol("fastify otel request context"),e2A=Symbol("fastify otel addhook original"),AvA=Symbol("fastify otel setnotfound original"),Fi=Symbol("fastify otel ignore path");Xe=class Xe extends BvA.InstrumentationBase{constructor(A){super(p2A,BwQ,A);if(this.servername=A?.servername??process.env.OTEL_SERVICE_NAME??"fastify",this[Fi]=null,this._logger=zw.diag.createComponentLogger({namespace:p2A}),A?.ignorePaths!=null||process.env.OTEL_FASTIFY_IGNORE_PATHS!=null){let B=A?.ignorePaths??process.env.OTEL_FASTIFY_IGNORE_PATHS;if((typeof B!=="string"||B.length===0)&&typeof B!=="function")throw TypeError("ignorePaths must be a string or a function");let Q=KM;this[Fi]=(E)=>{if(typeof B==="function")return B(E);else return Q(E.url,B)}}}enable(){if(this._handleInitialization===void 0&&this.getConfig().registerOnInitialization){let A=this.plugin();this._handleInitialization=(B)=>{B.fastify.register(A)},n2A.subscribe("fastify.initialization",this._handleInitialization)}return super.enable()}disable(){if(this._handleInitialization)n2A.unsubscribe("fastify.initialization",this._handleInitialization),this._handleInitialization=void 0;return super.disable()}init(){return[]}plugin(){let A=this;return B[Symbol.for("skip-override")]=!0,B[Symbol.for("fastify.display-name")]="@fastify/otel",B[Symbol.for("plugin-meta")]={fastify:QwQ,name:"@fastify/otel"},B;function B(Q,E,g){Q.decorate(OH,A),Q.decorate(e2A,Q.addHook),Q.decorate(AvA,Q.setNotFoundHandler),Q.decorateRequest("opentelemetry",function(){let R=this[z6];return{span:this[N8],tracer:A.tracer,context:R,inject:(G,Y)=>{return zw.propagation.inject(R,G,Y)},extract:(G,Y)=>{return zw.propagation.extract(R,G,Y)}}}),Q.decorateRequest(N8,null),Q.decorateRequest(z6,null),Q.addHook("onRoute",function(L){if(A[Fi]?.(L)===!0){A._logger.debug(`Ignoring route instrumentation ${L.method} ${L.url} because it matches the ignore path`);return}for(let R of r2A)if(L[R]!=null){let U=L[R];if(typeof U==="function")L[R]=H(U,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - route -> ${R}`,[xI.FASTIFY_TYPE]:O8.ROUTE,[nw.ATTR_HTTP_ROUTE]:L.url,[xI.HOOK_CALLBACK_NAME]:U.name?.length>0?U.name:nY});else if(Array.isArray(U)){let G=[];for(let Y of U)G.push(H(Y,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - route -> ${R}`,[xI.FASTIFY_TYPE]:O8.ROUTE,[nw.ATTR_HTTP_ROUTE]:L.url,[xI.HOOK_CALLBACK_NAME]:Y.name?.length>0?Y.name:nY}));L[R]=G}}if(L.onSend!=null)L.onSend=Array.isArray(L.onSend)?[...L.onSend,C]:[L.onSend,C];else L.onSend=C;if(L.onError!=null)L.onError=Array.isArray(L.onError)?[...L.onError,I]:[L.onError,I];else L.onError=I;L.handler=H(L.handler,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - route-handler`,[xI.FASTIFY_TYPE]:O8.HANDLER,[nw.ATTR_HTTP_ROUTE]:L.url,[xI.HOOK_CALLBACK_NAME]:L.handler.name.length>0?L.handler.name:nY})}),Q.addHook("onRequest",function(L,R,U){if(this[OH].isEnabled()===!1)return U();else if(this[OH][Fi]?.({url:L.url,method:L.method})===!0)return this[OH]._logger.debug(`Ignoring request ${L.method} ${L.url} because it matches the ignore path`),U();let G=zw.context.active();if(zw.trace.getSpan(G)==null)G=zw.propagation.extract(G,L.headers);let Y=Li.getRPCMetadata(G);if(L.routeOptions.url!=null&&Y?.type===Li.RPCType.HTTP)Y.route=L.routeOptions.url;let J=this[OH].tracer.startSpan("request",{attributes:{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.ROOT]:"@fastify/otel",[nw.ATTR_HTTP_ROUTE]:L.url,[nw.ATTR_HTTP_REQUEST_METHOD]:L.method}},G);L[z6]=zw.trace.setSpan(G,J),L[N8]=J,zw.context.with(L[z6],()=>{U()})}),Q.addHook("onResponse",function(L,R,U){let G=L[N8];if(G!=null)G.setStatus({code:zw.SpanStatusCode.OK,message:"OK"}),G.setAttributes({[nw.ATTR_HTTP_RESPONSE_STATUS_CODE]:404}),G.end();L[N8]=null,U()}),Q.addHook=w,Q.setNotFoundHandler=D,g();function C(L,R,U,G){let Y=L[N8];if(Y!=null){if(R.statusCode<500)Y.setStatus({code:zw.SpanStatusCode.OK,message:"OK"});Y.setAttributes({[nw.ATTR_HTTP_RESPONSE_STATUS_CODE]:R.statusCode}),Y.end()}L[N8]=null,G(null,U)}function I(L,R,U,G){let Y=L[N8];if(Y!=null)Y.setStatus({code:zw.SpanStatusCode.ERROR,message:U.message}),Y.recordException(U);G()}function w(L,R){let U=this[e2A];if(r2A.includes(L))return U.call(this,L,H(R,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - ${L}`,[xI.FASTIFY_TYPE]:O8.INSTANCE,[xI.HOOK_CALLBACK_NAME]:R.name?.length>0?R.name:nY}));else return U.call(this,L,R)}function D(L,R){let U=this[AvA];if(typeof L==="function")R=H(L,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[xI.FASTIFY_TYPE]:O8.INSTANCE,[xI.HOOK_CALLBACK_NAME]:L.name?.length>0?L.name:nY}),U.call(this,R);else{if(L.preValidation!=null)L.preValidation=H(L.preValidation,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - not-found-handler - preValidation`,[xI.FASTIFY_TYPE]:O8.INSTANCE,[xI.HOOK_CALLBACK_NAME]:L.preValidation.name?.length>0?L.preValidation.name:nY});if(L.preHandler!=null)L.preHandler=H(L.preHandler,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - not-found-handler - preHandler`,[xI.FASTIFY_TYPE]:O8.INSTANCE,[xI.HOOK_CALLBACK_NAME]:L.preHandler.name?.length>0?L.preHandler.name:nY});R=H(R,{[nw.ATTR_SERVICE_NAME]:Q[OH].servername,[xI.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[xI.FASTIFY_TYPE]:O8.INSTANCE,[xI.HOOK_CALLBACK_NAME]:R.name?.length>0?R.name:nY}),U.call(this,L,R)}}function H(L,R={}){return function(...G){let Y=this[OH],[J]=G;if(Y.isEnabled()===!1)return L.call(this,...G);let c=J[z6]??zw.context.active(),h=Y.tracer.startSpan(`handler - ${L.name?.length>0?L.name:this.pluginName??nY}`,{attributes:R},c);return zw.context.with(zw.trace.setSpan(c,h),function(){try{let V=L.call(this,...G);if(typeof V?.then==="function")return V.then((T)=>{return h.end(),T},(T)=>{return h.setStatus({code:zw.SpanStatusCode.ERROR,message:T.message}),h.recordException(T),h.end(),Promise.reject(T)});return h.end(),V}catch(V){throw h.setStatus({code:zw.SpanStatusCode.ERROR,message:V.message}),h.recordException(V),h.end(),V}},this)}}}}}});var pY,j6,v6;

// === Module: gvA (offset: 0x195e01, 709 chars) ===
var gvA=z(()=>{i6=Symbol("opentelemetry.instrumentation.fastify.request_active_span")});function Pe(A,B,Q,E={}){let g=B.startSpan(Q,{attributes:E}),C=A[i6]||[];return C.push(g),Object.defineProperty(A,i6,{enumerable:!1,configurable:!0,value:C}),g}function Ui(A,B){let Q=A[i6]||[];if(!Q.length)return;Q.forEach((E)=>{if(B)E.setStatus({code:IvA.SpanStatusCode.ERROR,message:B.message}),E.recordException(B);E.end()}),delete A[i6]}function wvA(A,B,Q){let E,g=void 0;try{if(g=A(),CvA(g))g.then((C)=>B(void 0,C),(C)=>B(C))}catch(C){E=C}finally{if(!CvA(g)){if(B(E,g),E)throw E}return g}}function CvA(A){return typeof A==="object"&&A&&typeof Object.getOwnPropertyDescriptor(A,"then")?.value==="function"||!1}var IvA;

// === Module: LvA (offset: 0x1962be, 4,557 chars) ===
var LvA=z(()=>{CQ();EvA();DvA();_0=iA(_B(),1),Gi=iA(JI(),1),fk=iA(XE(),1),HvA=iA(yg(),1),CwQ=new Set(["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"]);Oe=class Oe extends fk.InstrumentationBase{constructor(A={}){super(gwQ,EwQ,A)}init(){return[new fk.InstrumentationNodeModuleDefinition("fastify",[">=3.0.0 <4"],(A)=>{return this._patchConstructor(A)})]}_hookOnRequest(){let A=this;return function(Q,E,g){if(!A.isEnabled())return g();A._wrap(E,"send",A._patchSend());let C=Q,I=Gi.getRPCMetadata(_0.context.active()),w=C.routeOptions?C.routeOptions.url:Q.routerPath;if(w&&I?.type===Gi.RPCType.HTTP)I.route=w;let D=Q.method||"GET";bE().setTransactionName(`${D} ${w}`),g()}}_wrapHandler(A,B,Q,E){let g=this;return this._diag.debug("Patching fastify route.handler function"),function(...C){if(!g.isEnabled())return Q.apply(this,C);let I=Q.name||A||MvA,w=`${v6.MIDDLEWARE} - ${I}`,D=C[1],H=Pe(D,g.tracer,w,{[pY.FASTIFY_TYPE]:j6.MIDDLEWARE,[pY.PLUGIN_NAME]:A,[pY.HOOK_NAME]:B}),L=E&&C[C.length-1];if(L)C[C.length-1]=function(...R){Ui(D),L.apply(this,R)};return _0.context.with(_0.trace.setSpan(_0.context.active(),H),()=>{return wvA(()=>{return Q.apply(this,C)},(R)=>{if(R instanceof Error)H.setStatus({code:_0.SpanStatusCode.ERROR,message:R.message}),H.recordException(R);if(!E)Ui(D)})})}}_wrapAddHook(){let A=this;return this._diag.debug("Patching fastify server.addHook function"),function(B){return function(...E){let g=E[0],C=E[1],I=this.pluginName;if(!CwQ.has(g))return B.apply(this,E);let w=typeof E[E.length-1]==="function"&&C.constructor.name!=="AsyncFunction";return B.apply(this,[g,A._wrapHandler(I,g,C,w)])}}}_patchConstructor(A){let B=this;function Q(...E){let g=A.fastify.apply(this,E);return g.addHook("onRequest",B._hookOnRequest()),g.addHook("preHandler",B._hookPreHandler()),IwQ(),B._wrap(g,"addHook",B._wrapAddHook()),g}if(A.errorCodes!==void 0)Q.errorCodes=A.errorCodes;return Q.fastify=Q,Q.default=Q,Q}_patchSend(){let A=this;return this._diag.debug("Patching fastify reply.send function"),function(Q){return function(...g){let C=g[0];if(!A.isEnabled())return Q.apply(this,g);return fk.safeExecuteInTheMiddle(()=>{return Q.apply(this,g)},(I)=>{if(!I&&C instanceof Error)I=C;Ui(this,I)})}}}_hookPreHandler(){let A=this;return this._diag.debug("Patching fastify preHandler function"),function(Q,E,g){if(!A.isEnabled())return g();let C=Q,I=C.routeOptions?.handler||C.context?.handler,w=I?.name.startsWith("bound ")?I.name.substring(6):I?.name,D=`${v6.REQUEST_HANDLER} - ${w||this.pluginName||MvA}`,H={[pY.PLUGIN_NAME]:this.pluginName,[pY.FASTIFY_TYPE]:j6.REQUEST_HANDLER,[HvA.SEMATTRS_HTTP_ROUTE]:C.routeOptions?C.routeOptions.url:Q.routerPath};if(w)H[pY.FASTIFY_NAME]=w;let L=Pe(E,A.tracer,D,H);FvA(L);let{requestHook:R}=A.getConfig();if(R)fk.safeExecuteInTheMiddle(()=>R(L,{request:Q}),(U)=>{if(U)A._diag.error("request hook failed",U)},!0);return _0.context.with(_0.trace.setSpan(_0.context.active(),L),()=>{g()})}}}});import*as Ne from"diagnostics_channel";function wwQ(){let A=BQ();if(!A)return;else return A.getIntegrationByName(Ri)}function UvA(A,B,Q,E){let g=wwQ()?.getShouldHandleError()||KvA;if(E==="diagnostics-channel")this.diagnosticsChannelExists=!0;if(this.diagnosticsChannelExists&&E==="onError-hook"){Lw&&sA.warn("Fastify error handler was already registered via diagnostics channel.","You can safely remove `setupFastifyErrorHandler` call and set `shouldHandleError` on the integration options.");return}if(g(A,B,Q))jQ(A,{mechanism:{handled:!1,type:"auto.function.fastify"}})}function KvA(A,B,Q){let E=Q.statusCode;return E>=500||E<=299}function YvA(A){let B=_Q(A),Q=B.description,E=B.data,g=E["fastify.type"],C=g==="hook",I=g===Q?.startsWith("handler -"),w=Q==="request"||g==="request-handler";if(E[KE]||!I&&!w&&!C)return;let D=C?"hook":I?"middleware":w?"request-handler":"<unknown>";A.setAttributes({[BE]:"auto.http.otel.fastify",[KE]:`${D}.fastify`});let H=E["fastify.name"]||E["plugin.name"]||E["hook.name"];if(typeof H==="string"){let L=H.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");A.updateName(L)}}function MwQ(){let A=BQ();if(A)A.on("spanStart",(B)=>{YvA(B)})}function HwQ(A){A.addHook("onRequest",async(B,Q)=>{if(B.opentelemetry){let{span:C}=B.opentelemetry();if(C)YvA(C)}let E=B.routeOptions?.url,g=B.method||"GET";bE().setTransactionName(`${g} ${E}`)})}var Ri="Fastify",GvA,RvA,DwQ=({shouldHandleError:A})=>{let B;return{name:Ri,setupOnce(){B=A||KvA,GvA(),RvA()},getShouldHandleError(){return B},setShouldHandleError(Q){B=Q}}},Te;

// === Module: Ki (offset: 0x197bc6, 260 chars) ===
var Ki=_((kvA)=>{Object.defineProperty(kvA,"__esModule",{value:!0});kvA.OTEL_GRAPHQL_DATA_SYMBOL=kvA.OTEL_PATCHED_SYMBOL=void 0;kvA.OTEL_PATCHED_SYMBOL=Symbol.for("opentelemetry.patched");kvA.OTEL_GRAPHQL_DATA_SYMBOL=Symbol.for("opentelemetry.graphql_data")});

// === Module: lvA (offset: 0x198f55, 202 chars) ===
var lvA=_((uvA)=>{Object.defineProperty(uvA,"__esModule",{value:!0});uvA.PACKAGE_NAME=uvA.PACKAGE_VERSION=void 0;uvA.PACKAGE_VERSION="0.58.0";uvA.PACKAGE_NAME="@opentelemetry/instrumentation-graphql"});

// === Module: MiA (offset: 0x19a8c9, 192 chars) ===
var MiA=_((wiA)=>{Object.defineProperty(wiA,"__esModule",{value:!0});wiA.EVENT_LISTENERS_SET=void 0;wiA.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.kafkajs.eventListenersSet")});

// === Module: JiA (offset: 0x19b1c7, 202 chars) ===
var JiA=_((KiA)=>{Object.defineProperty(KiA,"__esModule",{value:!0});KiA.PACKAGE_NAME=KiA.PACKAGE_VERSION=void 0;KiA.PACKAGE_VERSION="0.20.0";KiA.PACKAGE_NAME="@opentelemetry/instrumentation-kafkajs"});

// === Module: WiA (offset: 0x19d9fe, 207 chars) ===
var WiA=_((ZiA)=>{Object.defineProperty(ZiA,"__esModule",{value:!0});ZiA.PACKAGE_NAME=ZiA.PACKAGE_VERSION=void 0;ZiA.PACKAGE_VERSION="0.55.0";ZiA.PACKAGE_NAME="@opentelemetry/instrumentation-lru-memoizer"});

// === Module: B5A (offset: 0x19e364, 202 chars) ===
var B5A=_((eiA)=>{Object.defineProperty(eiA,"__esModule",{value:!0});eiA.PACKAGE_NAME=eiA.PACKAGE_VERSION=void 0;eiA.PACKAGE_VERSION="0.64.0";eiA.PACKAGE_NAME="@opentelemetry/instrumentation-mongodb"});

// === Module: k5A (offset: 0x1a227f, 203 chars) ===
var k5A=_((f5A)=>{Object.defineProperty(f5A,"__esModule",{value:!0});f5A.PACKAGE_NAME=f5A.PACKAGE_VERSION=void 0;f5A.PACKAGE_VERSION="0.57.0";f5A.PACKAGE_NAME="@opentelemetry/instrumentation-mongoose"});

// === Module: l5A (offset: 0x1a4bee, 200 chars) ===
var l5A=_((u5A)=>{Object.defineProperty(u5A,"__esModule",{value:!0});u5A.PACKAGE_NAME=u5A.PACKAGE_VERSION=void 0;u5A.PACKAGE_VERSION="0.57.0";u5A.PACKAGE_NAME="@opentelemetry/instrumentation-mysql"});

// === Module: slA (offset: 0x1b64ab, 339 chars) ===
var slA=_((vlA)=>{Object.defineProperty(vlA,"__esModule",{value:!0});vlA.SDK_INFO=void 0;var G8Q=usA(),ki=qlA(),R8Q=jlA();vlA.SDK_INFO={[ki.ATTR_TELEMETRY_SDK_NAME]:"opentelemetry",[R8Q.ATTR_PROCESS_RUNTIME_NAME]:"node",[ki.ATTR_TELEMETRY_SDK_LANGUAGE]:ki.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS,[ki.ATTR_TELEMETRY_SDK_VERSION]:G8Q.VERSION}});

// === Module: SmA (offset: 0x1bbb54, 201 chars) ===
var SmA=_((YmA)=>{Object.defineProperty(YmA,"__esModule",{value:!0});YmA.PACKAGE_NAME=YmA.PACKAGE_VERSION=void 0;YmA.PACKAGE_VERSION="0.57.0";YmA.PACKAGE_NAME="@opentelemetry/instrumentation-mysql2"});

// === Module: dmA (offset: 0x1bcf5d, 202 chars) ===
var dmA=_((smA)=>{Object.defineProperty(smA,"__esModule",{value:!0});smA.PACKAGE_NAME=smA.PACKAGE_VERSION=void 0;smA.PACKAGE_VERSION="0.59.0";smA.PACKAGE_NAME="@opentelemetry/instrumentation-ioredis"});

// === Module: ji (offset: 0x1be046, 199 chars) ===
var ji=_((pmA)=>{Object.defineProperty(pmA,"__esModule",{value:!0});pmA.PACKAGE_NAME=pmA.PACKAGE_VERSION=void 0;pmA.PACKAGE_VERSION="0.59.0";pmA.PACKAGE_NAME="@opentelemetry/instrumentation-redis"});

// === Module: YnA (offset: 0x1bf674, 6,784 chars) ===
var YnA=_((RnA)=>{Object.defineProperty(RnA,"__esModule",{value:!0});RnA.RedisInstrumentationV4_V5=void 0;var oU=_B(),fI=XE(),LnA=FnA(),_fQ=zi(),UnA=ji(),VAA=yg(),tfQ=vi(),e6=Symbol("opentelemetry.instrumentation.redis.open_spans"),GnA=Symbol("opentelemetry.instrumentation.redis.multi_command_options");class si extends fI.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(A={}){super(UnA.PACKAGE_NAME,UnA.PACKAGE_VERSION,A);this._semconvStability=A.semconvStability?A.semconvStability:(0,fI.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(A={}){super.setConfig(A),this._semconvStability=A.semconvStability?A.semconvStability:(0,fI.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[this._getInstrumentationNodeModuleDefinition("@redis/client"),this._getInstrumentationNodeModuleDefinition("@node-redis/client")]}_getInstrumentationNodeModuleDefinition(A){let B=new fI.InstrumentationNodeModuleFile(`${A}/dist/lib/commander.js`,["^1.0.0"],(g,C)=>{let I=g.transformCommandArguments;if(!I)return this._diag.error("internal instrumentation error, missing transformCommandArguments function"),g;let w=C?.startsWith("1.0.")?"extendWithCommands":"attachCommands";if((0,fI.isWrapped)(g?.[w]))this._unwrap(g,w);return this._wrap(g,w,this._getPatchExtendWithCommands(I)),g},(g)=>{if((0,fI.isWrapped)(g?.extendWithCommands))this._unwrap(g,"extendWithCommands");if((0,fI.isWrapped)(g?.attachCommands))this._unwrap(g,"attachCommands")}),Q=new fI.InstrumentationNodeModuleFile(`${A}/dist/lib/client/multi-command.js`,["^1.0.0","^5.0.0"],(g)=>{let C=g?.default?.prototype;if((0,fI.isWrapped)(C?.exec))this._unwrap(C,"exec");if(this._wrap(C,"exec",this._getPatchMultiCommandsExec(!1)),(0,fI.isWrapped)(C?.execAsPipeline))this._unwrap(C,"execAsPipeline");if(this._wrap(C,"execAsPipeline",this._getPatchMultiCommandsExec(!0)),(0,fI.isWrapped)(C?.addCommand))this._unwrap(C,"addCommand");return this._wrap(C,"addCommand",this._getPatchMultiCommandsAddCommand()),g},(g)=>{let C=g?.default?.prototype;if((0,fI.isWrapped)(C?.exec))this._unwrap(C,"exec");if((0,fI.isWrapped)(C?.addCommand))this._unwrap(C,"addCommand")}),E=new fI.InstrumentationNodeModuleFile(`${A}/dist/lib/client/index.js`,["^1.0.0","^5.0.0"],(g)=>{let C=g?.default?.prototype;if(C?.multi){if((0,fI.isWrapped)(C?.multi))this._unwrap(C,"multi");this._wrap(C,"multi",this._getPatchRedisClientMulti())}if(C?.MULTI){if((0,fI.isWrapped)(C?.MULTI))this._unwrap(C,"MULTI");this._wrap(C,"MULTI",this._getPatchRedisClientMulti())}if((0,fI.isWrapped)(C?.sendCommand))this._unwrap(C,"sendCommand");return this._wrap(C,"sendCommand",this._getPatchRedisClientSendCommand()),this._wrap(C,"connect",this._getPatchedClientConnect()),g},(g)=>{let C=g?.default?.prototype;if((0,fI.isWrapped)(C?.multi))this._unwrap(C,"multi");if((0,fI.isWrapped)(C?.MULTI))this._unwrap(C,"MULTI");if((0,fI.isWrapped)(C?.sendCommand))this._unwrap(C,"sendCommand")});return new fI.InstrumentationNodeModuleDefinition(A,["^1.0.0","^5.0.0"],(g)=>{return g},()=>{},[B,Q,E])}_getPatchExtendWithCommands(A){let B=this;return function(E){return function(C){if(C?.BaseClass?.name!=="RedisClient")return E.apply(this,arguments);let I=C.executor;return C.executor=function(w,D){let H=A(w,D).args;return B._traceClientCommand(I,this,arguments,H)},E.apply(this,arguments)}}}_getPatchMultiCommandsExec(A){let B=this;return function(E){return function(){let C=E.apply(this,arguments);if(typeof C?.then!=="function")return B._diag.error("non-promise result when patching exec/execAsPipeline"),C;return C.then((I)=>{let w=this[e6];return B._endSpansWithRedisReplies(w,I,A),I}).catch((I)=>{let w=this[e6];if(!w)B._diag.error("cannot find open spans to end for multi/pipeline");else{let D=I.constructor.name==="MultiErrorReply"?I.replies:Array(w.length).fill(I);B._endSpansWithRedisReplies(w,D,A)}return Promise.reject(I)})}}}_getPatchMultiCommandsAddCommand(){let A=this;return function(Q){return function(g){return A._traceClientCommand(Q,this,arguments,g)}}}_getPatchRedisClientMulti(){return function(B){return function(){let E=B.apply(this,arguments);return E[GnA]=this.options,E}}}_getPatchRedisClientSendCommand(){let A=this;return function(Q){return function(g){return A._traceClientCommand(Q,this,arguments,g)}}}_getPatchedClientConnect(){let A=this;return function(Q){return function(){let g=this.options,C=(0,LnA.getClientAttributes)(A._diag,g,A._semconvStability),I=A.tracer.startSpan(`${si.COMPONENT}-connect`,{kind:oU.SpanKind.CLIENT,attributes:C});return oU.context.with(oU.trace.setSpan(oU.context.active(),I),()=>{return Q.apply(this)}).then((D)=>{return I.end(),D}).catch((D)=>{return I.recordException(D),I.setStatus({code:oU.SpanStatusCode.ERROR,message:D.message}),I.end(),Promise.reject(D)})}}}_traceClientCommand(A,B,Q,E){if(oU.trace.getSpan(oU.context.active())===void 0&&this.getConfig().requireParentSpan)return A.apply(B,Q);let C=B.options||B[GnA],I=E[0],w=E.slice(1),D=this.getConfig().dbStatementSerializer||_fQ.defaultDbStatementSerializer,H=(0,LnA.getClientAttributes)(this._diag,C,this._semconvStability);if(this._semconvStability&fI.SemconvStability.STABLE)H[VAA.ATTR_DB_OPERATION_NAME]=I;try{let U=D(I,w);if(U!=null){if(this._semconvStability&fI.SemconvStability.OLD)H[tfQ.ATTR_DB_STATEMENT]=U;if(this._semconvStability&fI.SemconvStability.STABLE)H[VAA.ATTR_DB_QUERY_TEXT]=U}}catch(U){this._diag.error("dbStatementSerializer throw an exception",U,{commandName:I})}let L=this.tracer.startSpan(`${si.COMPONENT}-${I}`,{kind:oU.SpanKind.CLIENT,attributes:H}),R=oU.context.with(oU.trace.setSpan(oU.context.active(),L),()=>{return A.apply(B,Q)});if(typeof R?.then==="function")R.then((U)=>{this._endSpanWithResponse(L,I,w,U,void 0)},(U)=>{this._endSpanWithResponse(L,I,w,null,U)});else{let U=R;U[e6]=U[e6]||[],U[e6].push({span:L,commandName:I,commandArgs:w})}return R}_endSpansWithRedisReplies(A,B,Q=!1){if(!A)return this._diag.error("cannot find open spans to end for redis multi/pipeline");if(B.length!==A.length)return this._diag.error("number of multi command spans does not match response from redis");let E=A.map((I)=>I.commandName),C=E.every((I)=>I===E[0])?(Q?"PIPELINE ":"MULTI ")+E[0]:Q?"PIPELINE":"MULTI";for(let I=0;I<A.length;I++){let{span:w,commandArgs:D}=A[I],H=B[I],[L,R]=H instanceof Error?[null,H]:[H,void 0];if(this._semconvStability&fI.SemconvStability.STABLE)w.setAttribute(VAA.ATTR_DB_OPERATION_NAME,C);this._endSpanWithResponse(w,E[I],D,L,R)}}_endSpanWithResponse(A,B,Q,E,g){let{responseHook:C}=this.getConfig();if(!g&&C)try{C(A,B,Q,E)}catch(I){this._diag.error("responseHook throw an exception",I)}if(g)A.recordException(g),A.setStatus({code:oU.SpanStatusCode.ERROR,message:g?.message});A.end()}}RnA.RedisInstrumentationV4_V5=si});

// === Module: jnA (offset: 0x1c1ed9, 187 chars) ===
var jnA=_((WnA)=>{Object.defineProperty(WnA,"__esModule",{value:!0});WnA.EVENT_LISTENERS_SET=void 0;WnA.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.pg.eventListenersSet")});

// === Module: enA (offset: 0x1c3cb6, 197 chars) ===
var enA=_((pnA)=>{Object.defineProperty(pnA,"__esModule",{value:!0});pnA.PACKAGE_NAME=pnA.PACKAGE_VERSION=void 0;pnA.PACKAGE_VERSION="0.63.0";pnA.PACKAGE_NAME="@opentelemetry/instrumentation-pg"});

// === Module: PpA (offset: 0x1c7de9, 617 chars) ===
var PpA=z(()=>{hpA();Eq=Symbol.for("io.opentelemetry.js.api.logs"),dX=ri});class ei{constructor(){this._proxyLoggerProvider=new pi}static getInstance(){if(!this._instance)this._instance=new ei;return this._instance}setGlobalLoggerProvider(A){if(dX[Eq])return this.getLoggerProvider();return dX[Eq]=XpA(mAA,A,ni),this._proxyLoggerProvider._setDelegate(A),A}getLoggerProvider(){var A,B;return(B=(A=dX[Eq])===null||A===void 0?void 0:A.call(dX,mAA))!==null&&B!==void 0?B:this._proxyLoggerProvider}getLogger(A,B,Q){return this.getLoggerProvider().getLogger(A,B,Q)}disable(){delete dX[Eq],this._proxyLoggerProvider=new pi}}

// === Module: JrA (offset: 0x1cca0d, 2,700 chars) ===
var JrA=z(()=>{HrA();UrA=iA(_B(),1),z8=iA(_B(),1),ukQ={name:"@prisma/instrumentation-contract",version:"7.2.0",description:"Shared types and utilities for Prisma instrumentation",main:"dist/index.js",module:"dist/index.mjs",types:"dist/index.d.ts",exports:{".":{require:{types:"./dist/index.d.ts",default:"./dist/index.js"},import:{types:"./dist/index.d.mts",default:"./dist/index.mjs"}}},license:"Apache-2.0",homepage:"https://www.prisma.io",repository:{type:"git",url:"https://github.com/prisma/prisma.git",directory:"packages/instrumentation-contract"},bugs:"https://github.com/prisma/prisma/issues",scripts:{dev:"DEV=true tsx helpers/build.ts",build:"tsx helpers/build.ts",prepublishOnly:"pnpm run build",test:"vitest run"},files:["dist"],sideEffects:!1,devDependencies:{"@opentelemetry/api":"1.9.0"},peerDependencies:{"@opentelemetry/api":"^1.8"}},akQ=ukQ.version.split(".")[0],FBA=`V${akQ}_PRISMA_INSTRUMENTATION`,$X=globalThis;nkQ=process.env.PRISMA_SHOW_ALL_TRACES==="true";KrA={name:"@prisma/instrumentation",version:"7.2.0",description:"OpenTelemetry compliant instrumentation for Prisma Client",main:"dist/index.js",module:"dist/index.mjs",types:"dist/index.d.ts",exports:{".":{require:{types:"./dist/index.d.ts",default:"./dist/index.js"},import:{types:"./dist/index.d.ts",default:"./dist/index.mjs"}}},license:"Apache-2.0",homepage:"https://www.prisma.io",repository:{type:"git",url:"https://github.com/prisma/prisma.git",directory:"packages/instrumentation"},bugs:"https://github.com/prisma/prisma/issues",devDependencies:{"@opentelemetry/api":"1.9.0","@prisma/instrumentation-contract":"workspace:*","@types/node":"~20.19.24",typescript:"5.4.5"},dependencies:{"@opentelemetry/instrumentation":"^0.207.0"},peerDependencies:{"@opentelemetry/api":"^1.8"},files:["dist"],keywords:["prisma","instrumentation","opentelemetry","otel"],scripts:{dev:"DEV=true tsx helpers/build.ts",build:"tsx helpers/build.ts",prepublishOnly:"pnpm run build",test:"vitest run"},sideEffects:!1},LrA=KrA.version,B4Q=KrA.name,YrA=class extends lX{tracerProvider;constructor(A={}){super(B4Q,LrA,A)}setTracerProvider(A){this.tracerProvider=A}init(){return[new B5(Q4Q,[LrA])]}enable(){let A=this._config;$kQ(new ekQ({tracerProvider:this.tracerProvider??UrA.trace.getTracerProvider(),ignoreSpanTypes:A.ignoreSpanTypes??[]}))}disable(){mkQ()}isEnabled(){return lkQ()!==void 0}}});function E4Q(A){return!!A&&typeof A==="object"&&"dispatchEngineSpans"in A}function xrA(){let A=globalThis.PRISMA_INSTRUMENTATION;return A&&typeof A==="object"&&"helper"in A?A.helper:void 0}function g4Q(A){switch(A){case"client":return XU.SpanKind.CLIENT;case"internal":default:return XU.SpanKind.INTERNAL}}var XU,SrA="Prisma",frA,C4Q,LBA;

// === Module: hrA (offset: 0x1cda22, 199 chars) ===
var hrA=_((krA)=>{Object.defineProperty(krA,"__esModule",{value:!0});krA.PACKAGE_NAME=krA.PACKAGE_VERSION=void 0;krA.PACKAGE_VERSION="0.57.0";krA.PACKAGE_NAME="@opentelemetry/instrumentation-hapi"});

// === Module: BeA (offset: 0x1d0422, 198 chars) ===
var BeA=_((erA)=>{Object.defineProperty(erA,"__esModule",{value:!0});erA.PACKAGE_NAME=erA.PACKAGE_VERSION=void 0;erA.PACKAGE_VERSION="0.59.0";erA.PACKAGE_NAME="@opentelemetry/instrumentation-koa"});

// === Module: TeA (offset: 0x1d17ee, 202 chars) ===
var TeA=_((OeA)=>{Object.defineProperty(OeA,"__esModule",{value:!0});OeA.PACKAGE_NAME=OeA.PACKAGE_VERSION=void 0;OeA.PACKAGE_VERSION="0.54.0";OeA.PACKAGE_NAME="@opentelemetry/instrumentation-connect"});

// === Module: ZeA (offset: 0x1d18b8, 200 chars) ===
var ZeA=_((yeA)=>{Object.defineProperty(yeA,"__esModule",{value:!0});yeA._LAYERS_STORE_PROPERTY=void 0;yeA._LAYERS_STORE_PROPERTY=Symbol("opentelemetry.instrumentation-connect.request-route-stack")});

// === Module: EAB (offset: 0x1d2d2b, 202 chars) ===
var EAB=_((BAB)=>{Object.defineProperty(BAB,"__esModule",{value:!0});BAB.PACKAGE_NAME=BAB.PACKAGE_VERSION=void 0;BAB.PACKAGE_VERSION="0.30.0";BAB.PACKAGE_NAME="@opentelemetry/instrumentation-tedious"});

// === Module: HAB (offset: 0x1d2df5, 4,569 chars) ===
var HAB=_((DAB)=>{Object.defineProperty(DAB,"__esModule",{value:!0});DAB.TediousInstrumentation=DAB.INJECTED_CTX=void 0;var nX=_B(),YoQ=RB("events"),JR=XE(),jk=yg(),s8=peA(),gAB=AAB(),CAB=EAB(),wAB=Symbol("opentelemetry.instrumentation-tedious.current-database");DAB.INJECTED_CTX=Symbol("opentelemetry.instrumentation-tedious.context-info-injected");var IAB=["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"];function D5(A){Object.defineProperty(this,wAB,{value:A,writable:!0})}class VBA extends JR.InstrumentationBase{static COMPONENT="tedious";_netSemconvStability;_dbSemconvStability;constructor(A={}){super(CAB.PACKAGE_NAME,CAB.PACKAGE_VERSION,A);this._setSemconvStabilityFromEnv()}_setSemconvStabilityFromEnv(){this._netSemconvStability=(0,JR.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN),this._dbSemconvStability=(0,JR.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[new JR.InstrumentationNodeModuleDefinition(VBA.COMPONENT,[">=1.11.0 <20"],(A)=>{let B=A.Connection.prototype;for(let Q of IAB){if((0,JR.isWrapped)(B[Q]))this._unwrap(B,Q);this._wrap(B,Q,this._patchQuery(Q,A))}if((0,JR.isWrapped)(B.connect))this._unwrap(B,"connect");return this._wrap(B,"connect",this._patchConnect),A},(A)=>{if(A===void 0)return;let B=A.Connection.prototype;for(let Q of IAB)this._unwrap(B,Q);this._unwrap(B,"connect")})]}_patchConnect(A){return function(){return D5.call(this,this.config?.options?.database),this.removeListener("databaseChange",D5),this.on("databaseChange",D5),this.once("end",()=>{this.removeListener("databaseChange",D5)}),A.apply(this,arguments)}}_buildTraceparent(A){let B=A.spanContext();return`00-${B.traceId}-${B.spanId}-0${Number(B.traceFlags||nX.TraceFlags.NONE).toString(16)}`}_injectContextInfo(A,B,Q){return new Promise((E)=>{try{let C=new B.Request("set context_info @opentelemetry_traceparent",(w)=>{E()});Object.defineProperty(C,DAB.INJECTED_CTX,{value:!0});let I=Buffer.from(Q,"utf8");C.addParameter("opentelemetry_traceparent",B.TYPES.VarBinary,I,{length:I.length}),A.execSql(C)}catch{E()}})}_shouldInjectFor(A){return A==="execSql"||A==="execSqlBatch"||A==="callProcedure"||A==="execute"}_patchQuery(A,B){return(Q)=>{let E=this;function g(C){if(C?.[DAB.INJECTED_CTX])return Q.apply(this,arguments);if(!(C instanceof YoQ.EventEmitter))return E._diag.warn(`Unexpected invocation of patched ${A} method. Span not recorded`),Q.apply(this,arguments);let I=0,w=0,D=()=>w++,H=()=>I++,L=this[wAB],R=((T)=>{if(T.sqlTextOrProcedure==="sp_prepare"&&T.parametersByName?.stmt?.value)return T.parametersByName.stmt.value;return T.sqlTextOrProcedure})(C),U={};if(E._dbSemconvStability&JR.SemconvStability.OLD)U[s8.ATTR_DB_SYSTEM]=s8.DB_SYSTEM_VALUE_MSSQL,U[s8.ATTR_DB_NAME]=L,U[s8.ATTR_DB_USER]=this.config?.userName??this.config?.authentication?.options?.userName,U[s8.ATTR_DB_STATEMENT]=R,U[s8.ATTR_DB_SQL_TABLE]=C.table;if(E._dbSemconvStability&JR.SemconvStability.STABLE)U[jk.ATTR_DB_NAMESPACE]=L,U[jk.ATTR_DB_SYSTEM_NAME]=jk.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER,U[jk.ATTR_DB_QUERY_TEXT]=R,U[jk.ATTR_DB_COLLECTION_NAME]=C.table;if(E._netSemconvStability&JR.SemconvStability.OLD)U[s8.ATTR_NET_PEER_NAME]=this.config?.server,U[s8.ATTR_NET_PEER_PORT]=this.config?.options?.port;if(E._netSemconvStability&JR.SemconvStability.STABLE)U[jk.ATTR_SERVER_ADDRESS]=this.config?.server,U[jk.ATTR_SERVER_PORT]=this.config?.options?.port;let G=E.tracer.startSpan((0,gAB.getSpanName)(A,L,R,C.table),{kind:nX.SpanKind.CLIENT,attributes:U}),Y=(0,gAB.once)((T)=>{if(C.removeListener("done",D),C.removeListener("doneInProc",D),C.removeListener("doneProc",H),C.removeListener("error",Y),this.removeListener("end",Y),G.setAttribute("tedious.procedure_count",I),G.setAttribute("tedious.statement_count",w),T)G.setStatus({code:nX.SpanStatusCode.ERROR,message:T.message});G.end()});if(C.on("done",D),C.on("doneInProc",D),C.on("doneProc",H),C.once("error",Y),this.on("end",Y),typeof C.callback==="function")E._wrap(C,"callback",E._patchCallbackQuery(Y));else E._diag.error("Expected request.callback to be a function");let J=()=>{return nX.context.with(nX.trace.setSpan(nX.context.active(),G),Q,this,...arguments)};if(!(E.getConfig().enableTraceContextPropagation&&E._shouldInjectFor(A)))return J();let V=E._buildTraceparent(G);E._injectContextInfo(this,B,V).finally(J)}return Object.defineProperty(g,"length",{value:Q.length,writable:!1}),g}}_patchCallbackQuery(A){return(B)=>{return function(Q,E,g){return A(Q),B.apply(this,arguments)}}}}DAB.TediousInstrumentation=VBA});

// === Module: JAB (offset: 0x1d42a9, 207 chars) ===
var JAB=_((KAB)=>{Object.defineProperty(KAB,"__esModule",{value:!0});KAB.PACKAGE_NAME=KAB.PACKAGE_VERSION=void 0;KAB.PACKAGE_VERSION="0.54.0";KAB.PACKAGE_NAME="@opentelemetry/instrumentation-generic-pool"});

// === Module: bAB (offset: 0x1d545f, 3,048 chars) ===
var bAB=_((iAB)=>{Object.defineProperty(iAB,"__esModule",{value:!0});iAB.isConfirmChannelTracing=iAB.unmarkConfirmChannelTracing=iAB.markConfirmChannelTracing=iAB.getConnectionAttributesFromUrl=iAB.getConnectionAttributesFromServer=iAB.normalizeExchange=iAB.CONNECTION_ATTRIBUTES=iAB.CHANNEL_CONSUME_TIMEOUT_TIMER=iAB.CHANNEL_SPANS_NOT_ENDED=iAB.MESSAGE_STORED_SPAN=void 0;var bBA=_B(),b8=XE(),M5=yg(),Rq=vBA(),H5=iBA();iAB.MESSAGE_STORED_SPAN=Symbol("opentelemetry.amqplib.message.stored-span");iAB.CHANNEL_SPANS_NOT_ENDED=Symbol("opentelemetry.amqplib.channel.spans-not-ended");iAB.CHANNEL_CONSUME_TIMEOUT_TIMER=Symbol("opentelemetry.amqplib.channel.consumer-timeout-timer");iAB.CONNECTION_ATTRIBUTES=Symbol("opentelemetry.amqplib.connection.attributes");var dBA=(0,bBA.createContextKey)("opentelemetry.amqplib.channel.is-confirm-channel"),ioQ=(A)=>A!==""?A:"<default>";iAB.normalizeExchange=ioQ;var soQ=(A)=>{return A.replace(/:[^:@/]*@/,":***@")},zAB=(A,B)=>{return A||(B==="AMQP"?5672:5671)},jAB=(A)=>{let B=A||"amqp";return(B.endsWith(":")?B.substring(0,B.length-1):B).toUpperCase()},vAB=(A)=>{return A||"localhost"},SR=(A,B,Q,E)=>{if(Q)return{[B]:Q};else return bBA.diag.error(`amqplib instrumentation: could not extract connection attribute ${E} from user supplied url`,{url:A}),{}},boQ=(A)=>{let B=A.serverProperties.product?.toLowerCase?.();if(B)return{[Rq.ATTR_MESSAGING_SYSTEM]:B};else return{}};iAB.getConnectionAttributesFromServer=boQ;var doQ=(A,B)=>{let Q={[H5.ATTR_MESSAGING_PROTOCOL_VERSION]:"0.9.1"};if(A=A||"amqp://localhost",typeof A==="object"){let E=A,g=jAB(E?.protocol);Object.assign(Q,{...SR(A,H5.ATTR_MESSAGING_PROTOCOL,g,"protocol")});let C=vAB(E?.hostname);if(B&b8.SemconvStability.OLD)Object.assign(Q,{...SR(A,Rq.ATTR_NET_PEER_NAME,C,"hostname")});if(B&b8.SemconvStability.STABLE)Object.assign(Q,{...SR(A,M5.ATTR_SERVER_ADDRESS,C,"hostname")});let I=zAB(E.port,g);if(B&b8.SemconvStability.OLD)Object.assign(Q,SR(A,Rq.ATTR_NET_PEER_PORT,I,"port"));if(B&b8.SemconvStability.STABLE)Object.assign(Q,SR(A,M5.ATTR_SERVER_PORT,I,"port"))}else{let E=soQ(A);Q[H5.ATTR_MESSAGING_URL]=E;try{let g=new URL(E),C=jAB(g.protocol);Object.assign(Q,{...SR(E,H5.ATTR_MESSAGING_PROTOCOL,C,"protocol")});let I=vAB(g.hostname);if(B&b8.SemconvStability.OLD)Object.assign(Q,{...SR(E,Rq.ATTR_NET_PEER_NAME,I,"hostname")});if(B&b8.SemconvStability.STABLE)Object.assign(Q,{...SR(E,M5.ATTR_SERVER_ADDRESS,I,"hostname")});let w=zAB(g.port?parseInt(g.port):void 0,C);if(B&b8.SemconvStability.OLD)Object.assign(Q,SR(E,Rq.ATTR_NET_PEER_PORT,w,"port"));if(B&b8.SemconvStability.STABLE)Object.assign(Q,SR(E,M5.ATTR_SERVER_PORT,w,"port"))}catch(g){bBA.diag.error("amqplib instrumentation: error while extracting connection details from connection url",{censoredUrl:E,err:g})}}return Q};iAB.getConnectionAttributesFromUrl=doQ;var _oQ=(A)=>{return A.setValue(dBA,!0)};iAB.markConfirmChannelTracing=_oQ;var toQ=(A)=>{return A.deleteValue(dBA)};iAB.unmarkConfirmChannelTracing=toQ;var uoQ=(A)=>{return A.getValue(dBA)===!0};iAB.isConfirmChannelTracing=uoQ});

// === Module: tAB (offset: 0x1d6047, 202 chars) ===
var tAB=_((dAB)=>{Object.defineProperty(dAB,"__esModule",{value:!0});dAB.PACKAGE_NAME=dAB.PACKAGE_VERSION=void 0;dAB.PACKAGE_VERSION="0.58.0";dAB.PACKAGE_NAME="@opentelemetry/instrumentation-amqplib"});
