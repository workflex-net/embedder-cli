// Category: lib/app
// Modules: 29
// Total size: 147,611 chars


// === Module: eS (offset: 0x1534d3, 1,578 chars) ===
var eS=z(()=>{VY();vM()});function f6A(A){let B=rS(),Q={sid:UD(),init:!0,timestamp:B,started:B,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>UeB(Q)};if(A)WY(Q,A);return Q}function WY(A,B={}){if(B.user){if(!A.ipAddress&&B.user.ip_address)A.ipAddress=B.user.ip_address;if(!A.did&&!B.did)A.did=B.user.id||B.user.email||B.user.username}if(A.timestamp=B.timestamp||rS(),B.abnormal_mechanism)A.abnormal_mechanism=B.abnormal_mechanism;if(B.ignoreDuration)A.ignoreDuration=B.ignoreDuration;if(B.sid)A.sid=B.sid.length===32?B.sid:UD();if(B.init!==void 0)A.init=B.init;if(!A.did&&B.did)A.did=`${B.did}`;if(typeof B.started==="number")A.started=B.started;if(A.ignoreDuration)A.duration=void 0;else if(typeof B.duration==="number")A.duration=B.duration;else{let Q=A.timestamp-A.started;A.duration=Q>=0?Q:0}if(B.release)A.release=B.release;if(B.environment)A.environment=B.environment;if(!A.ipAddress&&B.ipAddress)A.ipAddress=B.ipAddress;if(!A.userAgent&&B.userAgent)A.userAgent=B.userAgent;if(typeof B.errors==="number")A.errors=B.errors;if(B.status)A.status=B.status}function c6A(A,B){let Q={};if(B)Q={status:B};else if(A.status==="ok")Q={status:"exited"};WY(A,Q)}function UeB(A){return{sid:`${A.sid}`,init:A.init,started:new Date(A.started*1000).toISOString(),timestamp:new Date(A.timestamp*1000).toISOString(),status:A.status,errors:A.errors,did:typeof A.did==="number"||typeof A.did==="string"?`${A.did}`:void 0,duration:A.duration,abnormal_mechanism:A.abnormal_mechanism,attrs:{release:A.release,environment:A.environment,ip_address:A.ipAddress,user_agent:A.userAgent}}}

// === Module: RqA (offset: 0x15cef8, 2,521 chars) ===
var RqA=z(()=>{aw();iY();b2();FF()});function KqA(A,B,Q,E,g,C){let{normalizeDepth:I=3,normalizeMaxBreadth:w=1000}=A,D={...B,event_id:B.event_id||Q.event_id||UD(),timestamp:B.timestamp||qY()},H=Q.integrations||A.integrations.map((c)=>c.name);if(aeB(D,A),meB(D,H),g)g.emit("applyFrameMetadata",B);if(B.type===void 0)leB(D,A.stackParser);let L=peB(E,Q.captureContext);if(Q.mechanism)$h(D,Q.mechanism);let R=g?g.getEventProcessors():[],U=GqA(C,L),G=[...Q.attachments||[],...U.attachments];if(G.length)Q.attachments=G;UqA(D,U);let Y=[...R,...U.eventProcessors];return IqA(Y,D,Q).then((c)=>{if(c)$eB(c);if(typeof I==="number"&&I>0)return neB(c,I,w);return c})}function aeB(A,B){let{environment:Q,release:E,dist:g,maxValueLength:C}=B;if(A.environment=A.environment||Q||CX,!A.release&&E)A.release=E;if(!A.dist&&g)A.dist=g;let I=A.request;if(I?.url&&C)I.url=mS(I.url,C);if(C)A.exception?.values?.forEach((w)=>{if(w.value)w.value=mS(w.value,C)})}function leB(A,B){let Q=HqA(B);A.exception?.values?.forEach((E)=>{E.stacktrace?.frames?.forEach((g)=>{if(g.filename)g.debug_id=Q[g.filename]})})}function $eB(A){let B={};if(A.exception?.values?.forEach((E)=>{E.stacktrace?.frames?.forEach((g)=>{if(g.debug_id){if(g.abs_path)B[g.abs_path]=g.debug_id;else if(g.filename)B[g.filename]=g.debug_id;delete g.debug_id}})}),Object.keys(B).length===0)return;A.debug_meta=A.debug_meta||{},A.debug_meta.images=A.debug_meta.images||[];let Q=A.debug_meta.images;Object.entries(B).forEach(([E,g])=>{Q.push({type:"sourcemap",code_file:E,debug_id:g})})}function meB(A,B){if(B.length>0)A.sdk=A.sdk||{},A.sdk.integrations=[...A.sdk.integrations||[],...B]}function neB(A,B,Q){if(!A)return null;let E={...A,...A.breadcrumbs&&{breadcrumbs:A.breadcrumbs.map((g)=>({...g,...g.data&&{data:i0(g.data,B,Q)}}))},...A.user&&{user:i0(A.user,B,Q)},...A.contexts&&{contexts:i0(A.contexts,B,Q)},...A.extra&&{extra:i0(A.extra,B,Q)}};if(A.contexts?.trace&&E.contexts){if(E.contexts.trace=A.contexts.trace,A.contexts.trace.data)E.contexts.trace.data=i0(A.contexts.trace.data,B,Q)}if(A.spans)E.spans=A.spans.map((g)=>{return{...g,...g.data&&{data:i0(g.data,B,Q)}}});if(A.contexts?.flags&&E.contexts)E.contexts.flags=i0(A.contexts.flags,3,Q);return E}function peB(A,B){if(!B)return A;let Q=A?A.clone():new sM;return Q.update(B),Q}function YqA(A){if(!A)return;if(reB(A))return{captureContext:A};if(AAQ(A))return{captureContext:A};return A}function reB(A){return A instanceof sM||typeof A==="function"}function AAQ(A){return Object.keys(A).some((B)=>eeB.includes(B))}var eeB;

// === Module: Sv (offset: 0x16914c, 3,458 chars) ===
var Sv=z(()=>{N9A=["responses.create","chat.completions.create","embeddings.create","conversations.create"],hBQ=["response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"],T9A=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta",...hBQ]});function xv(A){if(A.includes("chat.completions"))return gk.CHAT;if(A.includes("responses"))return gk.CHAT;if(A.includes("embeddings"))return gk.EMBEDDINGS;if(A.includes("conversations"))return gk.CHAT;return A.split(".").pop()||"unknown"}function _p(A){return`gen_ai.${xv(A)}`}function y9A(A){return N9A.includes(A)}function V9A(A,B){return A?`${A}.${B}`:B}function Z9A(A){return A!==null&&typeof A==="object"&&"object"in A&&A.object==="chat.completion"}function q9A(A){return A!==null&&typeof A==="object"&&"object"in A&&A.object==="response"}function W9A(A){if(A===null||typeof A!=="object"||!("object"in A))return!1;let B=A;return B.object==="list"&&typeof B.model==="string"&&B.model.toLowerCase().includes("embedding")}function z9A(A){return A!==null&&typeof A==="object"&&"object"in A&&A.object==="conversation"}function j9A(A){return A!==null&&typeof A==="object"&&"type"in A&&typeof A.type==="string"&&A.type.startsWith("response.")}function v9A(A){return A!==null&&typeof A==="object"&&"object"in A&&A.object==="chat.completion.chunk"}function i9A(A,B,Q){if(fv(A,B.id,B.model,B.created),B.usage)B6(A,B.usage.prompt_tokens,B.usage.completion_tokens,B.usage.total_tokens);if(Array.isArray(B.choices)){let E=B.choices.map((g)=>g.finish_reason).filter((g)=>g!==null);if(E.length>0)A.setAttributes({[LF]:JSON.stringify(E)});if(Q){let g=B.choices.map((C)=>C.message?.tool_calls).filter((C)=>Array.isArray(C)&&C.length>0).flat();if(g.length>0)A.setAttributes({[dD]:JSON.stringify(g)})}}}function s9A(A,B,Q){if(fv(A,B.id,B.model,B.created_at),B.status)A.setAttributes({[LF]:JSON.stringify([B.status])});if(B.usage)B6(A,B.usage.input_tokens,B.usage.output_tokens,B.usage.total_tokens);if(Q){let E=B;if(Array.isArray(E.output)&&E.output.length>0){let g=E.output.filter((C)=>typeof C==="object"&&C!==null&&C.type==="function_call");if(g.length>0)A.setAttributes({[dD]:JSON.stringify(g)})}}}function b9A(A,B){if(A.setAttributes({[Tp]:B.model,[GD]:B.model}),B.usage)B6(A,B.usage.prompt_tokens,void 0,B.usage.total_tokens)}function d9A(A,B){let{id:Q,created_at:E}=B;if(A.setAttributes({[Np]:Q,[GU]:Q,[$Z]:Q}),E)A.setAttributes({[yp]:new Date(E*1000).toISOString()})}function B6(A,B,Q,E){if(B!==void 0)A.setAttributes({[Q9A]:B,[$I]:B});if(Q!==void 0)A.setAttributes({[B9A]:Q,[lw]:Q});if(E!==void 0)A.setAttributes({[oH]:E})}function fv(A,B,Q,E){A.setAttributes({[Np]:B,[GU]:B}),A.setAttributes({[Tp]:Q,[GD]:Q}),A.setAttributes({[yp]:new Date(E*1000).toISOString()})}function XBQ(A){if("conversation"in A&&typeof A.conversation==="string")return A.conversation;if("previous_response_id"in A&&typeof A.previous_response_id==="string")return A.previous_response_id;return}function _9A(A){let B={[Fw]:A.model??"unknown"};if("temperature"in A)B[U8]=A.temperature;if("top_p"in A)B[R8]=A.top_p;if("frequency_penalty"in A)B[G8]=A.frequency_penalty;if("presence_penalty"in A)B[HX]=A.presence_penalty;if("stream"in A)B[DX]=A.stream;if("encoding_format"in A)B[b1A]=A.encoding_format;if("dimensions"in A)B[d1A]=A.dimensions;let Q=XBQ(A);if(Q)B[$Z]=Q;return B}

// === Module: Ad (offset: 0xb23d78, 27,084 chars) ===
var Ad=z(()=>{fLB()});var cLB=()=>{};function CC(...A){return A.reduce((B,Q)=>({...B,...Q!=null?Q:{}}),{})}async function XLB(A,B){if(A==null)return Promise.resolve();let Q=B==null?void 0:B.abortSignal;return new Promise((E,g)=>{if(Q==null?void 0:Q.aborted){g(kLB());return}let C=setTimeout(()=>{I(),E()},A),I=()=>{clearTimeout(C),Q==null||Q.removeEventListener("abort",w)},w=()=>{I(),g(kLB())};Q==null||Q.addEventListener("abort",w)})}function kLB(){return new DOMException("Delay was aborted","AbortError")}function wO(A){return Object.fromEntries([...A.headers])}function Qd(A=globalThis){var B,Q,E;if(A.window)return"runtime/browser";if((B=A.navigator)==null?void 0:B.userAgent)return`runtime/${A.navigator.userAgent.toLowerCase()}`;if((E=(Q=A.process)==null?void 0:Q.versions)==null?void 0:E.node)return`runtime/node.js/${A.process.version.substring(0)}`;if(A.EdgeRuntime)return"runtime/vercel-edge";return"runtime/unknown"}function H3Q(A){return Object.fromEntries(Object.entries(A).filter(([B,Q])=>Q!=null))}function DO(A,...B){let Q=H3Q(A!=null?A:{}),E=new Headers(Q),g=E.get("user-agent")||"";return E.set("user-agent",[g,...B].filter(Boolean).join(" ")),Object.fromEntries(E)}function Q9(A){if(A==null)return"unknown error";if(typeof A==="string")return A;if(A instanceof Error)return A.message;return JSON.stringify(A)}function cJ(A){return(A instanceof Error||A instanceof DOMException)&&(A.name==="AbortError"||A.name==="ResponseAborted"||A.name==="TimeoutError")}function PLB({error:A,url:B,requestBodyValues:Q}){if(cJ(A))return A;if(A instanceof TypeError&&F3Q.includes(A.message.toLowerCase())){let E=A.cause;if(E!=null)return new cI({message:`Cannot connect to API: ${E.message}`,cause:E,url:B,requestBodyValues:Q,isRetryable:!0})}return A}function TLB({mediaType:A,url:B,supportedUrls:Q}){return B=B.toLowerCase(),A=A.toLowerCase(),Object.entries(Q).map(([E,g])=>{let C=E.toLowerCase();return C==="*"||C==="*/*"?{mediaTypePrefix:"",regexes:g}:{mediaTypePrefix:C.replace(/\*/,""),regexes:g}}).filter(({mediaTypePrefix:E})=>A.startsWith(E)).flatMap(({regexes:E})=>E).some((E)=>E.test(B))}function MO({apiKey:A,environmentVariableName:B,apiKeyParameterName:Q="apiKey",description:E}){if(typeof A==="string")return A;if(A!=null)throw new s1({message:`${E} API key must be a string.`});if(typeof process>"u")throw new s1({message:`${E} API key is missing. Pass it using the '${Q}' parameter. Environment variables is not supported in this environment.`});if(A=process.env[B],A==null)throw new s1({message:`${E} API key is missing. Pass it using the '${Q}' parameter or the ${B} environment variable.`});if(typeof A!=="string")throw new s1({message:`${E} API key must be a string. The value of the ${B} environment variable is not a string.`});return A}function E9({settingValue:A,environmentVariableName:B}){if(typeof A==="string")return A;if(A!=null||typeof process>"u")return;if(A=process.env[B],A==null||typeof A!=="string")return;return A}function yLB(A){var B;let[Q,E=""]=A.toLowerCase().split("/");return(B={mpeg:"mp3","x-wav":"wav",opus:"ogg",mp4:"m4a","x-m4a":"m4a"}[E])!=null?B:E}function R3Q(A){let B=JSON.parse(A);if(B===null||typeof B!=="object")return B;if(U3Q.test(A)===!1&&G3Q.test(A)===!1)return B;return K3Q(B)}function K3Q(A){let B=[A];while(B.length){let Q=B;B=[];for(let E of Q){if(Object.prototype.hasOwnProperty.call(E,"__proto__"))throw SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(E,"constructor")&&Object.prototype.hasOwnProperty.call(E.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let g in E){let C=E[g];if(C&&typeof C==="object")B.push(C)}}}return A}function KFA(A){let{stackTraceLimit:B}=Error;Error.stackTraceLimit=0;try{return R3Q(A)}finally{Error.stackTraceLimit=B}}function Y3Q(A){return{[Bd]:!0,validate:A}}function J3Q(A){return typeof A==="object"&&A!==null&&Bd in A&&A[Bd]===!0&&"validate"in A}function S3Q(A){return J3Q(A)?A:x3Q(A)}function x3Q(A){return Y3Q(async(B)=>{let Q=await A["~standard"].validate(B);return Q.issues==null?{success:!0,value:Q.value}:{success:!1,error:new Dx({value:B,cause:Q.issues})}})}async function Ed({value:A,schema:B}){let Q=await oJ({value:A,schema:B});if(!Q.success)throw Dx.wrap({value:A,cause:Q.error});return Q.value}async function oJ({value:A,schema:B}){let Q=S3Q(B);try{if(Q.validate==null)return{success:!0,value:A,rawValue:A};let E=await Q.validate(A);if(E.success)return{success:!0,value:E.value,rawValue:A};return{success:!1,error:Dx.wrap({value:A,cause:E.error}),rawValue:A}}catch(E){return{success:!1,error:Dx.wrap({value:A,cause:E}),rawValue:A}}}async function f3Q({text:A,schema:B}){try{let Q=KFA(A);if(B==null)return Q;return Ed({value:Q,schema:B})}catch(Q){if(i1.isInstance(Q)||Dx.isInstance(Q))throw Q;throw new i1({text:A,cause:Q})}}async function jR({text:A,schema:B}){try{let Q=KFA(A);if(B==null)return{success:!0,value:Q,rawValue:Q};return await oJ({value:Q,schema:B})}catch(Q){return{success:!1,error:i1.isInstance(Q)?Q:new i1({text:A,cause:Q}),rawValue:void 0}}}function YFA(A){try{return KFA(A),!0}catch(B){return!1}}function c3Q({stream:A,schema:B}){return A.pipeThrough(new TextDecoderStream).pipeThrough(new QFA).pipeThrough(new TransformStream({async transform({data:Q},E){if(Q==="[DONE]")return;E.enqueue(await jR({text:Q,schema:B}))}}))}async function eC({provider:A,providerOptions:B,schema:Q}){if((B==null?void 0:B[A])==null)return;let E=await oJ({value:B[A],schema:Q});if(!E.success)throw new sb({argument:"providerOptions",message:`invalid ${A} provider options`,cause:E.error});return E.value}function qLB(A){return A}function Jw({id:A,name:B,inputSchema:Q}){return({execute:E,outputSchema:g,toModelOutput:C,onInputStart:I,onInputDelta:w,onInputAvailable:D,...H})=>qLB({type:"provider-defined",id:A,name:B,args:H,inputSchema:Q,outputSchema:g,execute:E,toModelOutput:C,onInputStart:I,onInputDelta:w,onInputAvailable:D})}function ZU({id:A,name:B,inputSchema:Q,outputSchema:E}){return({execute:g,toModelOutput:C,onInputStart:I,onInputDelta:w,onInputAvailable:D,...H})=>qLB({type:"provider-defined",id:A,name:B,args:H,inputSchema:Q,outputSchema:E,execute:g,toModelOutput:C,onInputStart:I,onInputDelta:w,onInputAvailable:D})}async function SD(A){if(typeof A==="function")A=A();return Promise.resolve(A)}function xL(){return{}}function P3Q(A,B){var Q,E,g;let C={type:"array"};if(((Q=A.type)==null?void 0:Q._def)&&((g=(E=A.type)==null?void 0:E._def)==null?void 0:g.typeName)!==bB.ZodAny)C.items=NC(A.type._def,{...B,currentPath:[...B.currentPath,"items"]});if(A.minLength)C.minItems=A.minLength.value;if(A.maxLength)C.maxItems=A.maxLength.value;if(A.exactLength)C.minItems=A.exactLength.value,C.maxItems=A.exactLength.value;return C}function O3Q(A){let B={type:"integer",format:"int64"};if(!A.checks)return B;for(let Q of A.checks)switch(Q.kind){case"min":if(Q.inclusive)B.minimum=Q.value;else B.exclusiveMinimum=Q.value;break;case"max":if(Q.inclusive)B.maximum=Q.value;else B.exclusiveMaximum=Q.value;break;case"multipleOf":B.multipleOf=Q.value;break}return B}function N3Q(){return{type:"boolean"}}function zLB(A,B){return NC(A.type._def,B)}function jLB(A,B,Q){let E=Q!=null?Q:B.dateStrategy;if(Array.isArray(E))return{anyOf:E.map((g,C)=>jLB(A,B,g))};switch(E){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return y3Q(A)}}function V3Q(A,B){return{...NC(A.innerType._def,B),default:A.defaultValue()}}function Z3Q(A,B){return B.effectStrategy==="input"?NC(A.schema._def,B):xL()}function q3Q(A){return{type:"string",enum:Array.from(A.values)}}function z3Q(A,B){let Q=[NC(A.left._def,{...B,currentPath:[...B.currentPath,"allOf","0"]}),NC(A.right._def,{...B,currentPath:[...B.currentPath,"allOf","1"]})].filter((g)=>!!g),E=[];return Q.forEach((g)=>{if(W3Q(g))E.push(...g.allOf);else{let C=g;if("additionalProperties"in g&&g.additionalProperties===!1){let{additionalProperties:I,...w}=g;C=w}E.push(C)}}),E.length?{allOf:E}:void 0}function j3Q(A){let B=typeof A.value;if(B!=="bigint"&&B!=="number"&&B!=="boolean"&&B!=="string")return{type:Array.isArray(A.value)?"array":"object"};return{type:B==="bigint"?"integer":B,const:A.value}}function vLB(A,B){let Q={type:"string"};if(A.checks)for(let E of A.checks)switch(E.kind){case"min":Q.minLength=typeof Q.minLength==="number"?Math.max(Q.minLength,E.value):E.value;break;case"max":Q.maxLength=typeof Q.maxLength==="number"?Math.min(Q.maxLength,E.value):E.value;break;case"email":switch(B.emailStrategy){case"format:email":QG(Q,"email",E.message,B);break;case"format:idn-email":QG(Q,"idn-email",E.message,B);break;case"pattern:zod":sH(Q,BG.email,E.message,B);break}break;case"url":QG(Q,"uri",E.message,B);break;case"uuid":QG(Q,"uuid",E.message,B);break;case"regex":sH(Q,E.regex,E.message,B);break;case"cuid":sH(Q,BG.cuid,E.message,B);break;case"cuid2":sH(Q,BG.cuid2,E.message,B);break;case"startsWith":sH(Q,RegExp(`^${UFA(E.value,B)}`),E.message,B);break;case"endsWith":sH(Q,RegExp(`${UFA(E.value,B)}$`),E.message,B);break;case"datetime":QG(Q,"date-time",E.message,B);break;case"date":QG(Q,"date",E.message,B);break;case"time":QG(Q,"time",E.message,B);break;case"duration":QG(Q,"duration",E.message,B);break;case"length":Q.minLength=typeof Q.minLength==="number"?Math.max(Q.minLength,E.value):E.value,Q.maxLength=typeof Q.maxLength==="number"?Math.min(Q.maxLength,E.value):E.value;break;case"includes":{sH(Q,RegExp(UFA(E.value,B)),E.message,B);break}case"ip":{if(E.version!=="v6")QG(Q,"ipv4",E.message,B);if(E.version!=="v4")QG(Q,"ipv6",E.message,B);break}case"base64url":sH(Q,BG.base64url,E.message,B);break;case"jwt":sH(Q,BG.jwt,E.message,B);break;case"cidr":{if(E.version!=="v6")sH(Q,BG.ipv4Cidr,E.message,B);if(E.version!=="v4")sH(Q,BG.ipv6Cidr,E.message,B);break}case"emoji":sH(Q,BG.emoji(),E.message,B);break;case"ulid":{sH(Q,BG.ulid,E.message,B);break}case"base64":{switch(B.base64Strategy){case"format:binary":{QG(Q,"binary",E.message,B);break}case"contentEncoding:base64":{Q.contentEncoding="base64";break}case"pattern:zod":{sH(Q,BG.base64,E.message,B);break}}break}case"nanoid":sH(Q,BG.nanoid,E.message,B);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return Q}function UFA(A,B){return B.patternStrategy==="escape"?i3Q(A):A}function i3Q(A){let B="";for(let Q=0;Q<A.length;Q++){if(!v3Q.has(A[Q]))B+="\\";B+=A[Q]}return B}function QG(A,B,Q,E){var g;if(A.format||((g=A.anyOf)==null?void 0:g.some((C)=>C.format))){if(!A.anyOf)A.anyOf=[];if(A.format)A.anyOf.push({format:A.format}),delete A.format;A.anyOf.push({format:B,...Q&&E.errorMessages&&{errorMessage:{format:Q}}})}else A.format=B}function sH(A,B,Q,E){var g;if(A.pattern||((g=A.allOf)==null?void 0:g.some((C)=>C.pattern))){if(!A.allOf)A.allOf=[];if(A.pattern)A.allOf.push({pattern:A.pattern}),delete A.pattern;A.allOf.push({pattern:hLB(B,E),...Q&&E.errorMessages&&{errorMessage:{pattern:Q}}})}else A.pattern=hLB(B,E)}function hLB(A,B){var Q;if(!B.applyRegexFlags||!A.flags)return A.source;let E={i:A.flags.includes("i"),m:A.flags.includes("m"),s:A.flags.includes("s")},g=E.i?A.source.toLowerCase():A.source,C="",I=!1,w=!1,D=!1;for(let H=0;H<g.length;H++){if(I){C+=g[H],I=!1;continue}if(E.i){if(w){if(g[H].match(/[a-z]/)){if(D)C+=g[H],C+=`${g[H-2]}-${g[H]}`.toUpperCase(),D=!1;else if(g[H+1]==="-"&&((Q=g[H+2])==null?void 0:Q.match(/[a-z]/)))C+=g[H],D=!0;else C+=`${g[H]}${g[H].toUpperCase()}`;continue}}else if(g[H].match(/[a-z]/)){C+=`[${g[H]}${g[H].toUpperCase()}]`;continue}}if(E.m){if(g[H]==="^"){C+=`(^|(?<=[\r
]))`;continue}else if(g[H]==="$"){C+=`($|(?=[\r
]))`;continue}}if(E.s&&g[H]==="."){C+=w?`${g[H]}\r
`:`[${g[H]}\r
]`;continue}if(C+=g[H],g[H]==="\\")I=!0;else if(w&&g[H]==="]")w=!1;else if(!w&&g[H]==="[")w=!0}try{new RegExp(C)}catch(H){return console.warn(`Could not convert regex pattern at ${B.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),A.source}return C}function iLB(A,B){var Q,E,g,C,I,w;let D={type:"object",additionalProperties:(Q=NC(A.valueType._def,{...B,currentPath:[...B.currentPath,"additionalProperties"]}))!=null?Q:B.allowedAdditionalProperties};if(((E=A.keyType)==null?void 0:E._def.typeName)===bB.ZodString&&((g=A.keyType._def.checks)==null?void 0:g.length)){let{type:H,...L}=vLB(A.keyType._def,B);return{...D,propertyNames:L}}else if(((C=A.keyType)==null?void 0:C._def.typeName)===bB.ZodEnum)return{...D,propertyNames:{enum:A.keyType._def.values}};else if(((I=A.keyType)==null?void 0:I._def.typeName)===bB.ZodBranded&&A.keyType._def.type._def.typeName===bB.ZodString&&((w=A.keyType._def.type._def.checks)==null?void 0:w.length)){let{type:H,...L}=zLB(A.keyType._def,B);return{...D,propertyNames:L}}return D}function s3Q(A,B){if(B.mapStrategy==="record")return iLB(A,B);let Q=NC(A.keyType._def,{...B,currentPath:[...B.currentPath,"items","items","0"]})||xL(),E=NC(A.valueType._def,{...B,currentPath:[...B.currentPath,"items","items","1"]})||xL();return{type:"array",maxItems:125,items:{type:"array",items:[Q,E],minItems:2,maxItems:2}}}function b3Q(A){let B=A.values,E=Object.keys(A.values).filter((C)=>{return typeof B[B[C]]!=="number"}).map((C)=>B[C]),g=Array.from(new Set(E.map((C)=>typeof C)));return{type:g.length===1?g[0]==="string"?"string":"number":["string","number"],enum:E}}function d3Q(){return{not:xL()}}function _3Q(){return{type:"null"}}function t3Q(A,B){let Q=A.options instanceof Map?Array.from(A.options.values()):A.options;if(Q.every((E)=>(E._def.typeName in GFA)&&(!E._def.checks||!E._def.checks.length))){let E=Q.reduce((g,C)=>{let I=GFA[C._def.typeName];return I&&!g.includes(I)?[...g,I]:g},[]);return{type:E.length>1?E:E[0]}}else if(Q.every((E)=>E._def.typeName==="ZodLiteral"&&!E.description)){let E=Q.reduce((g,C)=>{let I=typeof C._def.value;switch(I){case"string":case"number":case"boolean":return[...g,I];case"bigint":return[...g,"integer"];case"object":if(C._def.value===null)return[...g,"null"];case"symbol":case"undefined":case"function":default:return g}},[]);if(E.length===Q.length){let g=E.filter((C,I,w)=>w.indexOf(C)===I);return{type:g.length>1?g:g[0],enum:Q.reduce((C,I)=>{return C.includes(I._def.value)?C:[...C,I._def.value]},[])}}}else if(Q.every((E)=>E._def.typeName==="ZodEnum"))return{type:"string",enum:Q.reduce((E,g)=>[...E,...g._def.values.filter((C)=>!E.includes(C))],[])};return u3Q(A,B)}function a3Q(A,B){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(A.innerType._def.typeName)&&(!A.innerType._def.checks||!A.innerType._def.checks.length))return{type:[GFA[A.innerType._def.typeName],"null"]};let Q=NC(A.innerType._def,{...B,currentPath:[...B.currentPath,"anyOf","0"]});return Q&&{anyOf:[Q,{type:"null"}]}}function l3Q(A){let B={type:"number"};if(!A.checks)return B;for(let Q of A.checks)switch(Q.kind){case"int":B.type="integer";break;case"min":if(Q.inclusive)B.minimum=Q.value;else B.exclusiveMinimum=Q.value;break;case"max":if(Q.inclusive)B.maximum=Q.value;else B.exclusiveMaximum=Q.value;break;case"multipleOf":B.multipleOf=Q.value;break}return B}function $3Q(A,B){let Q={type:"object",properties:{}},E=[],g=A.shape();for(let I in g){let w=g[I];if(w===void 0||w._def===void 0)continue;let D=n3Q(w),H=NC(w._def,{...B,currentPath:[...B.currentPath,"properties",I],propertyPath:[...B.currentPath,"properties",I]});if(H===void 0)continue;if(Q.properties[I]=H,!D)E.push(I)}if(E.length)Q.required=E;let C=m3Q(A,B);if(C!==void 0)Q.additionalProperties=C;return Q}function m3Q(A,B){if(A.catchall._def.typeName!=="ZodNever")return NC(A.catchall._def,{...B,currentPath:[...B.currentPath,"additionalProperties"]});switch(A.unknownKeys){case"passthrough":return B.allowedAdditionalProperties;case"strict":return B.rejectedAdditionalProperties;case"strip":return B.removeAdditionalStrategy==="strict"?B.allowedAdditionalProperties:B.rejectedAdditionalProperties}}function n3Q(A){try{return A.isOptional()}catch(B){return!0}}function e3Q(A,B){return NC(A.type._def,B)}function AjQ(A,B){let E={type:"array",uniqueItems:!0,items:NC(A.valueType._def,{...B,currentPath:[...B.currentPath,"items"]})};if(A.minSize)E.minItems=A.minSize.value;if(A.maxSize)E.maxItems=A.maxSize.value;return E}function BjQ(A,B){if(A.rest)return{type:"array",minItems:A.items.length,items:A.items.map((Q,E)=>NC(Q._def,{...B,currentPath:[...B.currentPath,"items",`${E}`]})).reduce((Q,E)=>E===void 0?Q:[...Q,E],[]),additionalItems:NC(A.rest._def,{...B,currentPath:[...B.currentPath,"additionalItems"]})};else return{type:"array",minItems:A.items.length,maxItems:A.items.length,items:A.items.map((Q,E)=>NC(Q._def,{...B,currentPath:[...B.currentPath,"items",`${E}`]})).reduce((Q,E)=>E===void 0?Q:[...Q,E],[])}}function QjQ(){return{not:xL()}}function EjQ(){return xL()}function NC(A,B,Q=!1){var E;let g=B.seen.get(A);if(B.override){let D=(E=B.override)==null?void 0:E.call(B,A,B,g,Q);if(D!==h3Q)return D}if(g&&!Q){let D=IjQ(g,B);if(D!==void 0)return D}let C={def:A,path:B.currentPath,jsonSchema:void 0};B.seen.set(A,C);let I=CjQ(A,A.typeName,B),w=typeof I==="function"?NC(I(),B):I;if(w)wjQ(A,B,w);if(B.postProcess){let D=B.postProcess(w,A,B);return C.jsonSchema=w,D}return C.jsonSchema=w,w}function FjQ(A,B){var Q;let E=(Q=B==null?void 0:B.useReferences)!=null?Q:!1;return JFA(HjQ(A,{$refStrategy:E?"root":"none"}),{validate:async(g)=>{let C=await A.safeParseAsync(g);return C.success?{success:!0,value:C.data}:{success:!1,error:C.error}}})}function LjQ(A,B){var Q;let E=(Q=B==null?void 0:B.useReferences)!=null?Q:!1,g=tP(A,{target:"draft-7",io:"output",reused:E?"ref":"inline"});return JFA(g,{validate:async(C)=>{let I=await h1(A,C);return I.success?{success:!0,value:I.data}:{success:!1,error:I.error}}})}function UjQ(A){return"_zod"in A}function GjQ(A,B){if(UjQ(A))return LjQ(A,B);else return FjQ(A,B)}function JFA(A,{validate:B}={}){return{[RFA]:!0,_type:void 0,[Bd]:!0,jsonSchema:A,validate:B}}function RjQ(A){return typeof A==="object"&&A!==null&&RFA in A&&A[RFA]===!0&&"jsonSchema"in A&&"validate"in A}function U4(A){return A==null?JFA({properties:{},additionalProperties:!1}):RjQ(A)?A:GjQ(A)}function Lx(A){let B=A.replace(/-/g,"+").replace(/_/g,"/"),Q=YjQ(B);return Uint8Array.from(Q,(E)=>E.codePointAt(0))}function HO(A){let B="";for(let Q=0;Q<A.length;Q++)B+=String.fromCodePoint(A[Q]);return KjQ(B)}function XF(A){return A instanceof Uint8Array?HO(A):A}function Ux(A){return A==null?void 0:A.replace(/\/$/,"")}function JjQ(A){return A!=null&&typeof A[Symbol.asyncIterator]==="function"}async function*SFA({execute:A,input:B,options:Q}){let E=A(B,Q);if(JjQ(E)){let g;for await(let C of E)g=C,yield{type:"preliminary",output:C};yield{type:"final",output:g}}else yield{type:"final",output:await E}}var kJ=({prefix:A,size:B=16,alphabet:Q="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:E="-"}={})=>{let g=()=>{let C=Q.length,I=Array(B);for(let w=0;w<B;w++)I[w]=Q[Math.random()*C|0];return I.join("")};if(A==null)return g;if(Q.includes(E))throw new sb({argument:"separator",message:`The separator "${E}" must not be part of the alphabet "${Q}".`});return()=>`${A}${E}${g()}`},iw,F3Q,OLB="3.0.9",L3Q=()=>globalThis.fetch,NLB=async({url:A,headers:B={},successfulResponseHandler:Q,failedResponseHandler:E,abortSignal:g,fetch:C=L3Q()})=>{try{let I=await C(A,{method:"GET",headers:DO(B,`ai-sdk/provider-utils/${OLB}`,Qd()),signal:g}),w=wO(I);if(!I.ok){let D;try{D=await E({response:I,url:A,requestBodyValues:{}})}catch(H){if(cJ(H)||cI.isInstance(H))throw H;throw new cI({message:"Failed to process error response",cause:H,statusCode:I.status,url:A,responseHeaders:w,requestBodyValues:{}})}throw D.value}try{return await Q({response:I,url:A,requestBodyValues:{}})}catch(D){if(D instanceof Error){if(cJ(D)||cI.isInstance(D))throw D}throw new cI({message:"Failed to process successful response",cause:D,statusCode:I.status,url:A,responseHeaders:w,requestBodyValues:{}})}}catch(I){throw PLB({error:I,url:A,requestBodyValues:{}})}},U3Q,G3Q,Bd,k3Q=()=>globalThis.fetch,IC=async({url:A,headers:B,body:Q,failedResponseHandler:E,successfulResponseHandler:g,abortSignal:C,fetch:I})=>ZLB({url:A,headers:{"Content-Type":"application/json",...B},body:{content:JSON.stringify(Q),values:Q},failedResponseHandler:E,successfulResponseHandler:g,abortSignal:C,fetch:I}),VLB=async({url:A,headers:B,formData:Q,failedResponseHandler:E,successfulResponseHandler:g,abortSignal:C,fetch:I})=>ZLB({url:A,headers:B,body:{content:Q,values:Object.fromEntries(Q.entries())},failedResponseHandler:E,successfulResponseHandler:g,abortSignal:C,fetch:I}),ZLB=async({url:A,headers:B={},body:Q,successfulResponseHandler:E,failedResponseHandler:g,abortSignal:C,fetch:I=k3Q()})=>{try{let w=await I(A,{method:"POST",headers:DO(B,`ai-sdk/provider-utils/${OLB}`,Qd()),body:Q.content,signal:C}),D=wO(w);if(!w.ok){let H;try{H=await g({response:w,url:A,requestBodyValues:Q.values})}catch(L){if(cJ(L)||cI.isInstance(L))throw L;throw new cI({message:"Failed to process error response",cause:L,statusCode:w.status,url:A,responseHeaders:D,requestBodyValues:Q.values})}throw H.value}try{return await E({response:w,url:A,requestBodyValues:Q.values})}catch(H){if(H instanceof Error){if(cJ(H)||cI.isInstance(H))throw H}throw new cI({message:"Failed to process successful response",cause:H,statusCode:w.status,url:A,responseHeaders:D,requestBodyValues:Q.values})}}catch(w){throw PLB({error:w,url:A,requestBodyValues:Q.values})}},fL=({errorSchema:A,errorToMessage:B,isRetryable:Q})=>async({response:E,url:g,requestBodyValues:C})=>{let I=await E.text(),w=wO(E);if(I.trim()==="")return{responseHeaders:w,value:new cI({message:E.statusText,url:g,requestBodyValues:C,statusCode:E.status,responseHeaders:w,responseBody:I,isRetryable:Q==null?void 0:Q(E)})};try{let D=await f3Q({text:I,schema:A});return{responseHeaders:w,value:new cI({message:B(D),url:g,requestBodyValues:C,statusCode:E.status,responseHeaders:w,responseBody:I,data:D,isRetryable:Q==null?void 0:Q(E,D)})}}catch(D){return{responseHeaders:w,value:new cI({message:E.statusText,url:g,requestBodyValues:C,statusCode:E.status,responseHeaders:w,responseBody:I,isRetryable:Q==null?void 0:Q(E)})}}},qU=(A)=>async({response:B})=>{let Q=wO(B);if(B.body==null)throw new WFB({});return{responseHeaders:Q,value:c3Q({stream:B.body,schema:A})}},AI=(A)=>async({response:B,url:Q,requestBodyValues:E})=>{let g=await B.text(),C=await jR({text:g,schema:A}),I=wO(B);if(!C.success)throw new cI({message:"Invalid JSON response",cause:C.error,statusCode:B.status,responseHeaders:I,responseBody:g,url:Q,requestBodyValues:E});return{responseHeaders:I,value:C.value,rawValue:C.rawValue}},WLB=()=>async({response:A,url:B,requestBodyValues:Q})=>{let E=wO(A);if(!A.body)throw new cI({message:"Response body is empty",url:B,requestBodyValues:Q,statusCode:A.status,responseHeaders:E,responseBody:void 0});try{let g=await A.arrayBuffer();return{responseHeaders:E,value:new Uint8Array(g)}}catch(g){throw new cI({message:"Failed to read response as array buffer",url:B,requestBodyValues:Q,statusCode:A.status,responseHeaders:E,responseBody:void 0,cause:g})}},o3Q=(A,B)=>{let Q=0;for(;Q<A.length&&Q<B.length;Q++)if(A[Q]!==B[Q])break;return[(A.length-Q).toString(),...B.slice(Q)].join("/")},h3Q,oLB,X3Q=(A)=>typeof A==="string"?{...oLB,name:A}:{...oLB,...A},T3Q=(A,B)=>{return NC(A.innerType._def,B)},y3Q=(A)=>{let B={type:"integer",format:"unix-time"};for(let Q of A.checks)switch(Q.kind){case"min":B.minimum=Q.value;break;case"max":B.maximum=Q.value;break}return B},W3Q=(A)=>{if("type"in A&&A.type==="string")return!1;return"allOf"in A},LFA=void 0,BG,v3Q,GFA,u3Q=(A,B)=>{let Q=(A.options instanceof Map?Array.from(A.options.values()):A.options).map((E,g)=>NC(E._def,{...B,currentPath:[...B.currentPath,"anyOf",`${g}`]})).filter((E)=>!!E&&(!B.strictUnions||typeof E==="object"&&Object.keys(E).length>0));return Q.length?{anyOf:Q}:void 0},p3Q=(A,B)=>{var Q;if(B.currentPath.toString()===((Q=B.propertyPath)==null?void 0:Q.toString()))return NC(A.innerType._def,B);let E=NC(A.innerType._def,{...B,currentPath:[...B.currentPath,"anyOf","1"]});return E?{anyOf:[{not:xL()},E]}:xL()},r3Q=(A,B)=>{if(B.pipeStrategy==="input")return NC(A.in._def,B);else if(B.pipeStrategy==="output")return NC(A.out._def,B);let Q=NC(A.in._def,{...B,currentPath:[...B.currentPath,"allOf","0"]}),E=NC(A.out._def,{...B,currentPath:[...B.currentPath,"allOf",Q?"1":"0"]});return{allOf:[Q,E].filter((g)=>g!==void 0)}},gjQ=(A,B)=>{return NC(A.innerType._def,B)},CjQ=(A,B,Q)=>{switch(B){case bB.ZodString:return vLB(A,Q);case bB.ZodNumber:return l3Q(A);case bB.ZodObject:return $3Q(A,Q);case bB.ZodBigInt:return O3Q(A);case bB.ZodBoolean:return N3Q();case bB.ZodDate:return jLB(A,Q);case bB.ZodUndefined:return QjQ();case bB.ZodNull:return _3Q();case bB.ZodArray:return P3Q(A,Q);case bB.ZodUnion:case bB.ZodDiscriminatedUnion:return t3Q(A,Q);case bB.ZodIntersection:return z3Q(A,Q);case bB.ZodTuple:return BjQ(A,Q);case bB.ZodRecord:return iLB(A,Q);case bB.ZodLiteral:return j3Q(A);case bB.ZodEnum:return q3Q(A);case bB.ZodNativeEnum:return b3Q(A);case bB.ZodNullable:return a3Q(A,Q);case bB.ZodOptional:return p3Q(A,Q);case bB.ZodMap:return s3Q(A,Q);case bB.ZodSet:return AjQ(A,Q);case bB.ZodLazy:return()=>A.getter()._def;case bB.ZodPromise:return e3Q(A,Q);case bB.ZodNaN:case bB.ZodNever:return d3Q();case bB.ZodEffects:return Z3Q(A,Q);case bB.ZodAny:return xL();case bB.ZodUnknown:return EjQ();case bB.ZodDefault:return V3Q(A,Q);case bB.ZodBranded:return zLB(A,Q);case bB.ZodReadonly:return gjQ(A,Q);case bB.ZodCatch:return T3Q(A,Q);case bB.ZodPipeline:return r3Q(A,Q);case bB.ZodFunction:case bB.ZodVoid:case bB.ZodSymbol:return;default:return((E)=>{return})(B)}},IjQ=(A,B)=>{switch(B.$refStrategy){case"root":return{$ref:A.path.join("/")};case"relative":return{$ref:o3Q(B.currentPath,A.path)};case"none":case"seen":{if(A.path.length<B.currentPath.length&&A.path.every((Q,E)=>B.currentPath[E]===Q))return console.warn(`Recursive reference detected at ${B.currentPath.join("/")}! Defaulting to any`),xL();return B.$refStrategy==="seen"?xL():void 0}}},wjQ=(A,B,Q)=>{if(A.description)Q.description=A.description;return Q},DjQ=(A)=>{let B=X3Q(A),Q=B.name!==void 0?[...B.basePath,B.definitionPath,B.name]:B.basePath;return{...B,currentPath:Q,propertyPath:void 0,seen:new Map(Object.entries(B.definitions).map(([E,g])=>[g._def,{def:g._def,path:[...B.basePath,B.definitionPath,E],jsonSchema:void 0}]))}},MjQ=(A,B)=>{var Q;let E=DjQ(B),g=typeof B==="object"&&B.definitions?Object.entries(B.definitions).reduce((H,[L,R])=>{var U;return{...H,[L]:(U=NC(R._def,{...E,currentPath:[...E.basePath,E.definitionPath,L]},!0))!=null?U:xL()}},{}):void 0,C=typeof B==="string"?B:(B==null?void 0:B.nameStrategy)==="title"?void 0:B==null?void 0:B.name,I=(Q=NC(A._def,C===void 0?E:{...E,currentPath:[...E.basePath,E.definitionPath,C]},!1))!=null?Q:xL(),w=typeof B==="object"&&B.name!==void 0&&B.nameStrategy==="title"?B.name:void 0;if(w!==void 0)I.title=w;let D=C===void 0?g?{...I,[E.definitionPath]:g}:I:{$ref:[...E.$refStrategy==="relative"?[]:E.basePath,E.definitionPath,C].join("/"),[E.definitionPath]:{...g,[C]:I}};return D.$schema="http://json-schema.org/draft-07/schema#",D},HjQ,RFA,KjQ,YjQ;

// === Module: wC (offset: 0xb79585, 2,813 chars) ===
var wC=z(()=>{RKB();NLA();JKB()});import{readdir as h_Q,stat as X_Q}from"fs/promises";import OO from"path";function SKB(A,B,Q){if(!Q.showHidden&&B.startsWith(".")){if(![".gitignore",".embedderignore",".env.example"].includes(B))return!0}for(let E of O_Q)if(E.includes("*")){if(new RegExp(E.replace(/\*/g,".*")).test(B))return!0}else if(B===E)return!0;return!1}async function N_Q(A,B){let E={name:OO.basename(A),path:A,files:[],subFolders:[],totalChildren:0,totalFiles:0},g=[{folderInfo:E,currentPath:A,depth:0}],C=0,I=new Set;while(g.length>0){let w=g.shift();if(!w)break;let{folderInfo:D,currentPath:H,depth:L}=w;if(I.has(H)||L>=B.maxDepth)continue;if(I.add(H),C>=B.maxItems)continue;let R;try{R=(await h_Q(H,{withFileTypes:!0})).sort((J,c)=>J.name.localeCompare(c.name))}catch{continue}let U=[],G=[];for(let Y of R)if(Y.isFile()){if(C>=B.maxItems){D.hasMoreFiles=!0;break}let J=Y.name,c=OO.join(H,J);if(SKB(c,J,B))continue;U.push(J),C++,D.totalFiles++,D.totalChildren++}D.files=U;for(let Y of R)if(Y.isDirectory()){if(C>=B.maxItems){D.hasMoreSubfolders=!0;break}let J=Y.name,c=OO.join(H,J);if(SKB(c,J,B)){let T={name:J,path:c,files:[],subFolders:[],totalChildren:0,totalFiles:0,isIgnored:!0};G.push(T),C++,D.totalChildren++;continue}let V={name:J,path:c,files:[],subFolders:[],totalChildren:0,totalFiles:0};G.push(V),C++,D.totalChildren++,g.push({folderInfo:V,currentPath:c,depth:L+1})}D.subFolders=G}return E}function xKB(A,B,Q,E,g){let C=Q?"\u2514\u2500":"\u251C\u2500";if(!E||A.isIgnored)g.push(`${B}${C}${A.name}${OO.sep}${A.isIgnored?ud:""}`);let I=E?"":B+(Q?"  ":"\u2502 "),w=A.files.length;for(let H=0;H<w;H++){let R=H===w-1&&A.subFolders.length===0&&!A.hasMoreSubfolders?"\u2514\u2500":"\u251C\u2500";g.push(`${I}${R}${A.files[H]}`)}if(A.hasMoreFiles){let L=A.subFolders.length===0&&!A.hasMoreSubfolders?"\u2514\u2500":"\u251C\u2500";g.push(`${I}${L}${ud}`)}let D=A.subFolders.length;for(let H=0;H<D;H++){let L=A.subFolders[H];if(!L)continue;let R=H===D-1&&!A.hasMoreSubfolders;xKB(L,I,R,!1,g)}if(A.hasMoreSubfolders)g.push(`${I}\u2514\u2500${ud}`)}function fKB(A){if(A.hasMoreFiles||A.hasMoreSubfolders||A.isIgnored)return!0;for(let B of A.subFolders)if(fKB(B))return!0;return!1}async function cKB(A=process.cwd(),B={}){let Q={...P_Q,...B};try{let E=OO.resolve(A);if(!(await X_Q(E)).isDirectory())return`Error: ${A} is not a directory`;let C=await N_Q(E,Q);if(!C)return`Error: Could not read directory "${E}". Check path and permissions.`;let I=[];xKB(C,"",!0,!0,I);let w=`Showing up to ${Q.maxItems} items (files + folders).`;if(fKB(C))w+=` Folders or files indicated with ${ud} contain more items not shown, were ignored, or the display limit (${Q.maxItems} items) was reached.`;return`${w}

${E}${OO.sep}
${I.join(`
`)}`}catch(E){return`Error reading directory ${A}: ${uQ(E)}`}}var P_Q,O_Q,ud="...";

// === Module: kKB (offset: 0xb7a082, 4,778 chars) ===
var kKB=z(()=>{wC();P_Q={maxDepth:3,maxItems:200,showHidden:!1,respectGitIgnore:!0,respectEmbedderIgnore:!0},O_Q=["node_modules",".git",".vscode",".idea","dist","build","out",".next",".cache","coverage",".nyc_output","logs","*.log",".DS_Store","Thumbs.db"]});import{stat as T_Q}from"fs/promises";import y_Q from"path";async function NO(A=process.cwd()){try{return(await T_Q(y_Q.join(A,".git"))).isDirectory()}catch{return!1}}var ad=()=>{};import{spawnSync as VLA}from"child_process";import V_Q from"os";import ZLA from"path";function oKB(){if(process.env.WT_SESSION||process.env.WT_PROFILE_ID)return"Windows Terminal";if(process.env.GHOSTTY)return"Ghostty";if(process.env.TERM_PROGRAM){if(process.env.TERM_PROGRAM==="vscode")return"VS Code Terminal";if(process.env.TERM_PROGRAM==="Apple_Terminal")return"Apple Terminal";if(process.env.TERM_PROGRAM==="iTerm.app")return"iTerm2";return process.env.TERM_PROGRAM}if(process.env.TERMINAL_EMULATOR==="JetBrains-JediTerm")return"JetBrains Terminal";if(process.env.ALACRITTY_LOG)return"Alacritty";if(process.env.WEZTERM_EXECUTABLE)return"WezTerm";if(process.env.TERM)return process.env.TERM;return"unknown"}function Z_Q(){let A=process.env.COLORFGBG;if(!A)return null;let B=A.split(";"),Q=B[B.length-1];if(!Q)return null;let E=Number.parseInt(Q,10);if(Number.isNaN(E))return null;if(E===0||E===8)return"dark";if(E===7||E===15)return"light";return E<8?"dark":"light"}function q_Q(){let A=process.env.VSCODE_THEME_KIND;if(!A)return null;if(A.includes("light"))return"light";if(A.includes("dark")||A.includes("high-contrast"))return"dark";return null}function W_Q(){if(!process.env.GHOSTTY_RESOURCES_DIR)return null;return hKB()}function hKB(){let A=process.env.GTK_THEME?.toLowerCase();if(A){if(A.includes("dark"))return"dark";if(A.includes("light"))return"light"}try{let B=VLA("gsettings",["get","org.gnome.desktop.interface","color-scheme"],{encoding:"utf-8",timeout:500});if(B.status===0&&B.stdout){let Q=B.stdout.trim().toLowerCase();if(Q.includes("dark"))return"dark";if(Q.includes("light")||Q.includes("default"))return"light"}}catch{}try{let B=VLA("kreadconfig6",["--file","kdeglobals","--group","General","--key","ColorScheme"],{encoding:"utf-8",timeout:500}),Q=B.status===0?B:VLA("kreadconfig5",["--file","kdeglobals","--group","General","--key","ColorScheme"],{encoding:"utf-8",timeout:500});if(Q.status===0&&Q.stdout){let E=Q.stdout.trim().toLowerCase();if(E.includes("dark"))return"dark";if(E.includes("light")||E.includes("breeze"))return"light"}}catch{}return null}function XKB(){let A=q_Q();if(A)return{scheme:A,method:"VSCODE_THEME_KIND"};let B=Z_Q();if(B)return{scheme:B,method:"COLORFGBG"};if(process.env.GHOSTTY){let Q=W_Q();if(Q)return{scheme:Q,method:"Ghostty+system"}}{let Q=hKB();if(Q)return{scheme:Q,method:"Linux-system"}}return{scheme:"unknown",method:"none"}}async function k4(){if(kx!==void 0)return kx;let A=process.cwd();try{let B=new Bun.Glob("*"),Q=[];for await(let C of B.scan({cwd:A,onlyFiles:!0}))Q.push(C);let E=Q.find((C)=>C.toLowerCase()==="embedder.md");if(!E)return kx=null,kx;let g=ZLA.join(A,E);return kx=await Bun.file(g).text(),kx}catch{return kx=null,kx}}function z_Q(){return{platform:"linux",arch:"x64",version:V_Q.release(),isWindows:!1,isMacOS:!1,isLinux:!0}}function j_Q(){let A=new Date,B=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{date:A.toLocaleDateString("en-US"),time:A.toLocaleTimeString("en-US"),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:A.getTime(),weekday:B[A.getDay()]||"Unknown",formatted:A.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}}async function v_Q(A=process.cwd()){let B=await NO(A),Q=await Bun.file(ZLA.join(A,"package.json")).exists(),E=await Bun.file(ZLA.join(A,"EMBEDDER.md")).exists(),g="generic";if(B)g="git";if(Q)g="npm";if(E)g="embedded";return{isGitRepository:B,hasPackageJson:Q,hasEmbedderMd:E,projectType:g,rootDirectory:A}}async function PKB(){let A=process.cwd(),B=z_Q(),Q=j_Q(),E=await v_Q(A),g=await cKB(A),C=await k4()||void 0;return{workingDirectory:A,platform:B,dateTime:Q,folderStructure:g,projectInfo:E,userPrompt:C,contextGenerated:Date.now()}}async function $R(A,B){try{return await B.get(`api/v1/projects/${A}/components`)||[]}catch(Q){return fA.warn("Failed to fetch project components:",Q),[]}}function OKB(A){if(A.length===0)return"";let B=[],Q=A.find((g)=>g.type==="platform");if(Q)B.push(`- **Platform**: ${Q.name} (${Q.manufacturer})${Q.function?` - ${Q.function}`:""}`);let E=A.filter((g)=>g.type==="peripheral");if(E.length>0){let g=E.map((C)=>`  - ${C.name} (${C.manufacturer})${C.function?` - ${C.function}`:""}`).join(`
`);B.push(`- **Peripherals**:
${g}`)}if(B.length===0)return"";return`

## Hardware Context
${B.join(`
`)}`}var kx;

// === Module: uKB (offset: 0xb80c0a, 2,473 chars) ===
var uKB=z(()=>{qLA={$schema:"https://embedder.dev/theme.json",defs:{background:"#1a1a1a",foreground:"#ffffff",cyan:"#00ffff",magenta:"#ff00ff",green:"#00ff00",red:"#ff0000",yellow:"#ffff00",blue:"#0088ff",gray:"#808080",darkGray:"#404040"},theme:{primary:{dark:"cyan",light:"cyan"},secondary:{dark:"magenta",light:"magenta"},accent:{dark:"cyan",light:"cyan"},error:{dark:"red",light:"red"},warning:{dark:"yellow",light:"yellow"},success:{dark:"green",light:"green"},info:{dark:"cyan",light:"cyan"},text:{dark:"foreground",light:"#1a1a1a"},textMuted:{dark:"gray",light:"#666666"},background:{dark:"background",light:"#f5f5f5"},backgroundPanel:{dark:"#0d0d0d",light:"#e8e8e8"},backgroundElement:{dark:"#262626",light:"#d8d8d8"},border:{dark:"gray",light:"#c8c8c8"},borderActive:{dark:"cyan",light:"cyan"},borderSubtle:{dark:"darkGray",light:"#e0e0e0"},diffAdded:{dark:"green",light:"green"},diffRemoved:{dark:"red",light:"red"},diffContext:{dark:"gray",light:"#666666"},diffHunkHeader:{dark:"gray",light:"#666666"},diffHighlightAdded:{dark:"green",light:"green"},diffHighlightRemoved:{dark:"red",light:"red"},diffAddedBg:{dark:"#1a3a1a",light:"#e0ffe0"},diffRemovedBg:{dark:"#3a1a1a",light:"#ffe0e0"},diffContextBg:{dark:"#0d0d0d",light:"#e8e8e8"},diffLineNumber:{dark:"darkGray",light:"#c8c8c8"},diffAddedLineNumberBg:{dark:"#1a3a1a",light:"#e0ffe0"},diffRemovedLineNumberBg:{dark:"#3a1a1a",light:"#ffe0e0"},markdownText:{dark:"foreground",light:"#1a1a1a"},markdownHeading:{dark:"cyan",light:"cyan"},markdownLink:{dark:"blue",light:"blue"},markdownLinkText:{dark:"cyan",light:"cyan"},markdownCode:{dark:"green",light:"green"},markdownBlockQuote:{dark:"gray",light:"#666666"},markdownEmph:{dark:"yellow",light:"yellow"},markdownStrong:{dark:"foreground",light:"#1a1a1a"},markdownHorizontalRule:{dark:"gray",light:"#c8c8c8"},markdownListItem:{dark:"cyan",light:"cyan"},markdownListEnumeration:{dark:"cyan",light:"cyan"},markdownImage:{dark:"blue",light:"blue"},markdownImageText:{dark:"cyan",light:"cyan"},markdownCodeBlock:{dark:"foreground",light:"#1a1a1a"},syntaxComment:{dark:"gray",light:"#666666"},syntaxKeyword:{dark:"magenta",light:"magenta"},syntaxFunction:{dark:"blue",light:"blue"},syntaxVariable:{dark:"foreground",light:"#1a1a1a"},syntaxString:{dark:"green",light:"green"},syntaxNumber:{dark:"yellow",light:"yellow"},syntaxType:{dark:"cyan",light:"cyan"},syntaxOperator:{dark:"cyan",light:"cyan"},syntaxPunctuation:{dark:"foreground",light:"#1a1a1a"}}}});var lKB;

// === Module: vLA (offset: 0xb9711f, 5,940 chars) ===
var vLA=z(()=>{ZE()});var iLA=()=>{};function mR(A,B,Q,E="info"){FI({category:A,message:B,level:E,data:Q})}class sLA{config=null;sessionContext=null;queue=null;getAuthToken=null;init(A){if(this.config){fA.warn("[BATTS] Client already initialized");return}if(this.config={...XtQ,...A},this.queue=new md({flushIntervalMs:this.config.flushIntervalMs,maxBatchSize:this.config.maxBatchSize,maxRetries:this.config.maxRetries,debug:this.config.debug,getContext:()=>this.sessionContext,sendBatch:(B)=>this.sendBatch(B)}),this.config.debug)fA.debug("[BATTS] Client initialized")}setAuthTokenGetter(A){this.getAuthToken=A}get isInitialized(){return this.config!==null}get hasSession(){return this.sessionContext!==null}get sessionId(){return this.sessionContext?.sessionId??null}session={start:(A)=>{if(!this.config||!this.queue){fA.warn("[BATTS] Cannot start session - client not initialized");return}if(this.sessionContext={sessionId:A.sessionId,userId:A.userId,teamId:A.teamId,projectId:A.projectId,user:A.user,environment:A.environment},this.queue.start(),this.config.debug)fA.debug("[BATTS] Session started",{sessionId:A.sessionId,userId:A.userId})},update:(A)=>{if(!this.sessionContext)return;if(A.teamId!==void 0)this.sessionContext.teamId=A.teamId;if(A.projectId!==void 0)this.sessionContext.projectId=A.projectId},getContext:()=>{return this.sessionContext}};track=Object.assign((A,B)=>{if(!this.sessionContext||!this.queue){if(this.config?.debug)fA.warn("[BATTS] Dropping event - no session",{type:A});return}if(this.config?.debug)fA.info("[BATTS] track",{type:A,payload:B});let Q={type:A,timestamp:new Date().toISOString(),payload:B};this.queue.enqueue(Q)},{sessionStarted:(A)=>{this.track("session_started",A),mR("session","Session started",{hasEmbedderMd:A.hasEmbedderMd,initialMode:A.initialMode,initialModel:A.initialModel,initialProvider:A.initialProvider})},sessionClosed:(A)=>{this.track("session_closed",A),mR("session","Session closed",{finalMode:A.finalMode,durationMs:A.durationMs,promptCount:A.promptCount})},prompt:(A)=>{this.track("user_prompt",A),mR("chat","User prompt",{contentLength:A.contentLength,isCommand:A.isCommand,commandName:A.commandName,model:A.model,provider:A.provider,agentMode:A.agentMode})},assistantResponse:(A)=>{this.track("assistant_response",A),mR("chat","Assistant response",{contentLength:A.contentLength,model:A.model,provider:A.provider,agentMode:A.agentMode,toolCallCount:A.toolCalls?.length??0,isContinuation:A.isContinuation,durationMs:A.durationMs})},toolCall:(A)=>{this.track("tool_call",A),mR("tool",`Tool: ${A.toolName}`,{toolCallId:A.toolCallId,toolName:A.toolName,status:A.status,durationMs:A.durationMs,success:A.result.success},A.status==="success"?"info":"warning")},llmRequest:(A)=>{this.track("llm_request",A),mR("llm","LLM request",{requestId:A.requestId,model:A.model,provider:A.provider,inputTokens:A.tokens.input,outputTokens:A.tokens.output,durationMs:A.durationMs})},error:(A)=>{this.track("error",{errorType:A.errorType,message:A.message,severity:A.severity??"error",stack:A.stack,context:A.context,toolName:A.toolName,toolCallId:A.toolCallId});let B=A.severity??"error";mR("error",`Error: ${A.errorType}`,{errorType:A.errorType,message:A.message,toolName:A.toolName,toolCallId:A.toolCallId},B==="fatal"||B==="error"?"error":"warning")},fileOperation:(A)=>{this.track("file_operation",{filePath:A.filePath,operationType:A.operationType,toolCallId:A.toolCallId,linesChanged:A.linesChanged,bytesChanged:A.bytesChanged,linesRead:A.linesRead,bytesRead:A.bytesRead,success:A.success??!0,errorMessage:A.errorMessage})},modeSwitch:(A)=>{this.track("mode_switch",{fromMode:A.fromMode,toMode:A.toMode,trigger:A.trigger}),mR("session",`Mode: ${A.fromMode} -> ${A.toMode}`,{fromMode:A.fromMode,toMode:A.toMode,trigger:A.trigger})},toolConfirmation:(A)=>{this.track("tool_confirmation",{toolCallId:A.toolCallId,toolName:A.toolName,displayName:A.displayName,question:A.question,toolInput:A.toolInput,decision:A.decision,modifiedInput:A.modifiedInput,toolOutput:A.toolOutput,model:A.model,provider:A.provider,agentMode:A.agentMode,decisionTimeMs:A.decisionTimeMs,executionTimeMs:A.executionTimeMs}),mR("tool",`Tool confirmation: ${A.toolName} - ${A.decision}`,{toolCallId:A.toolCallId,toolName:A.toolName,decision:A.decision,decisionTimeMs:A.decisionTimeMs},A.decision==="rejected"?"warning":"info")},conversationResume:(A)=>{this.track("conversation_resume",A)},commandUsed:(A)=>{this.track("command_used",A)},rewind:(A)=>{this.track("rewind",A),mR("session","Rewind",{messageId:A.messageId,filesReverted:A.filesReverted,messagesRemoved:A.messagesRemoved,trigger:A.trigger,agentMode:A.agentMode})},responseLatency:(A)=>{this.track("response_latency",A)},projectInit:(A)=>{this.track("project_init",A)}});async flush(){if(!this.queue)return;await this.queue.flush()}async shutdown(){if(!this.queue)return;if(this.sessionContext){if(this.track.sessionClosed({}),this.config?.debug)fA.debug("[BATTS] Session closed event sent")}if(await this.queue.shutdown(),this.sessionContext=null,this.config?.debug)fA.debug("[BATTS] Client shutdown complete")}async sendBatch(A){if(!this.config)return{success:!1,processed:0,failed:A.events.length};try{let B=this.getAuthToken?await this.getAuthToken():null,Q={"Content-Type":"application/json","User-Agent":`embedder-cli/${A.context.environment.appVersion}`};if(B)Q.Authorization=`Bearer ${B}`;if(A.context.sessionId)Q["x-session-id"]=A.context.sessionId;let E=await fetch(this.config.ingestUrl,{method:"POST",headers:Q,body:JSON.stringify(A),signal:AbortSignal.timeout(1e4)});if(!E.ok){if(this.config.debug){let g=await E.text().catch(()=>"");fA.debug("[BATTS] Ingest request failed",{status:E.status,error:g.slice(0,200)})}return{success:!1,processed:0,failed:A.events.length}}return await E.json()}catch(B){if(this.config.debug)fA.debug("[BATTS] Ingest request error",{error:uQ(B)});return{success:!1,processed:0,failed:A.events.length}}}}var XtQ,eg;

// === Module: nR (offset: 0xb988d1, 3,013 chars) ===
var nR=z(()=>{mYB();vLA()});function pYB({children:A}){let[B,Q]=IG.useState("act"),E=WB(),g=IG.useCallback(()=>{Q((w)=>{let D=w==="plan"?"act":"plan";return eg.track.modeSwitch({fromMode:w,toMode:D,trigger:"keyboard"}),TI("agent_mode",D),FI({category:"mode",message:`Mode switched: ${w} \u2192 ${D}`,level:"info",data:{fromMode:w,toMode:D,trigger:"keyboard"}}),D})},[]),C=IG.useCallback((w)=>{Q((D)=>{if(D!==w)eg.track.modeSwitch({fromMode:D,toMode:w,trigger:"command"}),TI("agent_mode",w),FI({category:"mode",message:`Mode set: ${D} \u2192 ${w}`,level:"info",data:{fromMode:D,toMode:w,trigger:"command"}});return w})},[]),I=IG.useMemo(()=>({mode:B,modeName:B==="plan"?"PLAN":"ACT",modeColor:B==="plan"?E.info:E.success,canExecuteTools:B==="act",switchMode:g,setMode:C}),[B,E.info,E.success,g,C]);return O.jsxDEV(nYB.Provider,{value:I,children:A},void 0,!1,void 0,this)}function bH(){let A=IG.useContext(nYB);if(!A)throw Error("useMode must be used within a ModeProvider");return A}var IG,nYB;var ZJ=z(async()=>{JM();nR();CB();await qE();IG=iA(AQ(),1),nYB=IG.createContext(null)});function nd(A){return A.id.startsWith("custom-")}function rYB(){return`custom-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function eYB(A){return`custom-${A}`}async function pd(A,B){let Q=new URLSearchParams({type:"platform",limit:"500"});if(B)Q.set("search",B);return(await A.get(`api/v1/catalog?${Q}`)).data}async function rd(A,B){let Q=new URLSearchParams({type:"peripheral",limit:"500"});if(B)Q.set("search",B);return(await A.get(`api/v1/catalog?${Q}`)).data}async function TO(A,B,Q){await A.post(`api/v1/projects/${B}/components`,{id:Q})}function AJB(A){return{id:A.id,type:A.type,name:A.name,manufacturer:A.manufacturer,description:A.function,addedAt:new Date(A.addedAt)}}async function bLA(A,B,Q){let E=await A.post(`api/v1/projects/${B}/components`,{id:Q});return AJB(E)}async function PtQ(A,B,Q,E,g){let C=await A.post(`api/v1/projects/${B}/components`,{type:Q,name:E,manufacturer:g});return AJB(C)}async function OtQ(A,B,Q){if(Q.id&&!nd(Q))return bLA(A,B,Q.id);return PtQ(A,B,"peripheral",Q.name,Q.manufacturer)}async function BJB(A,B,Q){let E=[],g=[];for(let C of Q)try{let I=await OtQ(A,B,C);E.push(I)}catch(I){if(I instanceof Error&&I.message.includes("409"))g.push(C);else throw I}return{added:E,conflicts:g}}var b9=()=>{};var QJB=(A)=>{let B,Q=new Set,E=(H,L)=>{let R=typeof H==="function"?H(B):H;if(!Object.is(R,B)){let U=B;B=(L!=null?L:typeof R!=="object"||R===null)?R:Object.assign({},B,R),Q.forEach((G)=>G(B,U))}},g=()=>B,w={setState:E,getState:g,getInitialState:()=>D,subscribe:(H)=>{return Q.add(H),()=>Q.delete(H)}},D=B=A(E,g,w);return w},yO=(A)=>A?QJB(A):QJB;var d9=()=>{};function t9(A,B=NtQ){let Q=_9.default.useSyncExternalStore(A.subscribe,_9.default.useCallback(()=>B(A.getState()),[A,B]),_9.default.useCallback(()=>B(A.getInitialState()),[A,B]));return _9.default.useDebugValue(Q),Q}var _9,NtQ=(A)=>A,EJB=(A)=>{let B=yO(A),Q=(E)=>t9(B,E);return Object.assign(Q,B),Q},VO=(A)=>A?EJB(A):EJB;

// === Module: zU (offset: 0xb99ece, 2,066 chars) ===
var zU=z(()=>{JM();rw();ZO();CB();lM=iA(AQ(),1),wJB=lM.createContext(null)});function HJB({children:A}){let[B,Q]=AD.useState([]),[E,g]=AD.useState(null),[C,I]=AD.useState(null),[w,D]=AD.useState(!0),[H,L]=AD.useState(null),{isAuthenticated:R,apiFetch:U}=Tg(),{selectedTeam:G}=ew();AD.useEffect(()=>{if(!R||!G){Q([]),g(null),I(null);return}D(!0),I(null),(async()=>{L(null);try{let k=await U.get(`api/v1/teams/${G.id}/projects`);Q(k);let q=await tRB(process.cwd());if(q&&q.teamId===G.id){let s=k.find((j)=>j.id===q.projectId);if(s){g(s);return}}if(k.length===1&&k[0])g(k[0])}catch(k){L(uQ(k))}finally{D(!1)}})()},[R,U,G]),AD.useEffect(()=>{if(E&&R)ed.getState().fetchDocuments(E.id,U)},[E,R,U]);let Y=AD.useCallback(async(T)=>{Q((s)=>{if(s.some((j)=>j.id===T.id))return s;return[...s,T]});let k=await uRB(T.id),q=process.cwd();if(k&&k!==q&&await Bun.file(k).exists())process.chdir(k);else if(G)await z9(q,G.id,T.id);await fLA(T.id),g(T),I(null)},[G]),J=AD.useCallback(()=>{I(E),g(null)},[E]),c=AD.useCallback(()=>{if(C)g(C),I(null)},[C]),h=AD.useCallback(async(T,k,q)=>{if(!G)return;D(!0),L(null);try{let s=await U.post("api/v1/projects",{name:T,teamId:G.id});if(k)await TO(U,s.id,k);if(q&&q.length>0)for(let j of q)await TO(U,s.id,j);Q((j)=>[...j,s]),g(s),await z9(process.cwd(),G.id,s.id),await fLA(s.id),eg.track.projectInit({projectId:s.id,projectName:T,platformId:k??null,platformName:null,peripheralIds:q??[],peripheralNames:[],peripheralCount:q?.length??0,skippedPeripherals:!q||q.length===0,hasCustomPeripherals:q?.some((j)=>j.startsWith("custom-"))??!1})}catch(s){if(s.code==="PROJECT_LIMIT_REACHED")L("PROJECT_LIMIT_REACHED");else L(uQ(s))}finally{D(!1)}},[U,G]),V=AD.useMemo(()=>({projects:B,selectedProject:E,previousProject:C,isLoading:w,error:H,selectProject:Y,clearProjectSelection:J,restoreProjectSelection:c,createProject:h}),[B,E,C,w,H,Y,J,c,h]);return O.jsxDEV(MJB.Provider,{value:V,children:A},void 0,!1,void 0,this)}function xw(){let A=AD.useContext(MJB);if(!A)throw Error("useProjects must be used within a ProjectsProvider");return A}var AD,MJB;

// === Module: fw (offset: 0xb9a839, 2,293 chars) ===
var fw=z(()=>{d9();FJB=["o_o","O_O","o_O"],LJB=["\u25D0","\u25D3","\u25D1","\u25D2"];yB=yO((A,B)=>({snapshotService:null,contextProvider:null,toolStatusUpdateHandler:null,stopStreamHandler:null,streamOutputHandler:null,nestedToolCallHandler:null,nestedToolUpdateHandler:null,initHandler:null,compressHandler:null,questionHandler:null,modeHandler:null,messageInjectionHandler:null,planExecutionHandler:null,redirectPromptHandler:null,initPromptHandler:null,autoApprovalHandler:null,initInProgress:!1,serialAutoConnectHandler:null,renderer:null,flushCallback:null,sessionCleanupCallback:null,todoStore:{},currentSessionId:`session_${Date.now()}`,mascotExpression:UJB(),setSnapshotService:(Q)=>A({snapshotService:Q}),setContextProvider:(Q)=>A({contextProvider:Q}),setToolStatusUpdateHandler:(Q)=>A({toolStatusUpdateHandler:Q}),setStopStreamHandler:(Q)=>A({stopStreamHandler:Q}),setStreamOutputHandler:(Q)=>A({streamOutputHandler:Q}),setNestedToolCallHandler:(Q)=>A({nestedToolCallHandler:Q}),setNestedToolUpdateHandler:(Q)=>A({nestedToolUpdateHandler:Q}),setInitHandler:(Q)=>A({initHandler:Q}),setCompressHandler:(Q)=>A({compressHandler:Q}),setQuestionHandler:(Q)=>A({questionHandler:Q}),setModeHandler:(Q)=>A({modeHandler:Q}),setMessageInjectionHandler:(Q)=>A({messageInjectionHandler:Q}),setPlanExecutionHandler:(Q)=>A({planExecutionHandler:Q}),setRedirectPromptHandler:(Q)=>A({redirectPromptHandler:Q}),setInitPromptHandler:(Q)=>A({initPromptHandler:Q}),setAutoApprovalHandler:(Q)=>A({autoApprovalHandler:Q}),setInitInProgress:(Q)=>A({initInProgress:Q}),setSerialAutoConnectHandler:(Q)=>A({serialAutoConnectHandler:Q}),setRenderer:(Q)=>A({renderer:Q}),setFlushCallback:(Q)=>A({flushCallback:Q}),setSessionCleanupCallback:(Q)=>A({sessionCleanupCallback:Q}),setCurrentSessionId:(Q)=>A({currentSessionId:Q}),getTodos:(Q)=>B().todoStore[Q]??[],setTodos:(Q,E)=>{A({todoStore:{...B().todoStore,[Q]:E}})},clearTodos:(Q)=>{let{[Q]:E,...g}=B().todoStore;A({todoStore:g})},setIdleExpression:()=>A({mascotExpression:UJB()}),setBlinkExpression:()=>A({mascotExpression:{face:TtQ,state:"idle"}}),setThinkingExpression:()=>A({mascotExpression:ZtQ()}),setSuccessExpression:()=>A({mascotExpression:{face:ytQ,state:"success"}}),setErrorExpression:()=>A({mascotExpression:{face:VtQ,state:"error"}})}))});var GJB;

// === Module: RJB (offset: 0xb9b12e, 559 chars) ===
var RJB=z(()=>{u9();CG();ZE();GJB=VO((A,B)=>({lastUploadedHash:null,syncRemoteContext:async(Q,E)=>{let g=await k4();if(!g)return;let C=Bun.hash(g).toString(16);if(B().lastUploadedHash===C)return;try{await E.put(`api/v1/projects/${Q}/context`,{content:g}),A({lastUploadedHash:C}),fA.debug("Synced EMBEDDER.md to backend")}catch(I){fA.warn("Failed to sync EMBEDDER.md",{error:I})}},clear:()=>A({lastUploadedHash:null})}))});function JJB(){let A=KJB[Math.floor(Math.random()*KJB.length)],B=YJB[Math.floor(Math.random()*YJB.length)];return`${A}-${B}`}var KJB,YJB;

// === Module: qJ (offset: 0xb9c040, 3,891 chars) ===
var qJ=z(()=>{JM();nR();oF();CG();ad();fw();ZE();f4();RJB();SJB();rw();oL();zU();ZO();CB();eI=iA(AQ(),1),xJB=eI.createContext(null)});function oJB({children:A}){let{isAuthenticated:B,apiFetch:Q,getToken:E}=Tg(),{mode:g}=bH(),{sessionId:C,folderType:I,sandboxType:w}=hL(),{selectedProject:D}=xw(),[H,L]=hg.useState([]),[R,U]=hg.useState(null),[G,Y]=hg.useState(null),[J,c]=hg.useState(!1),h=hg.useRef(!1),V=hg.useRef(null),T=hg.useRef(g),k=hg.useRef(C),q=hg.useRef(I),s=hg.useRef(w),j=hg.useRef(D?.id),i=hg.useRef(E);hg.useEffect(()=>{T.current=g},[g]),hg.useEffect(()=>{if(k.current=C,C)V.current=C},[C]),hg.useEffect(()=>{q.current=I},[I]),hg.useEffect(()=>{s.current=w},[w]),hg.useEffect(()=>{j.current=D?.id},[D?.id]),hg.useEffect(()=>{i.current=E},[E]);let d=hg.useCallback(async()=>{let u={"x-platform-type":"linux","x-client-type":"cli"};if(T.current)u["x-agent-mode"]=T.current;if(q.current)u["x-folder-type"]=q.current;if(s.current)u["x-sandbox-type"]=s.current;if(k.current)u["x-session-id"]=k.current;if(j.current)u["x-project-id"]=j.current;if(vH&&OC.stagingToken)u["x-staging-token"]=OC.stagingToken;try{let IA=await i.current();if(IA)u.Authorization=`Bearer ${IA}`}catch(IA){fA.error("Failed to get auth token for headers",{error:IA})}return u},[]);hg.useEffect(()=>{if(!B||h.current)return;(async()=>{try{let IA=await Q.get("api/v1/models");if(L(IA),h.current=!0,IA.length>0&&!R){let kA=IA[0]??null;if(U(kA),kA)TI("model",kA.name),TI("provider",kA.provider);c(!1)}else if(IA.length===0)c(!0)}catch(IA){fA.error("Failed to fetch models",{error:IA})}})()},[B,Q,R]);let l=hg.useCallback((u)=>{U(u),TI("model",u.name),TI("provider",u.provider)},[]),e=hg.useRef(d);hg.useEffect(()=>{e.current=d},[d]);let CA=hg.useMemo(()=>{return async(IA,kA)=>{let QA=await e.current(),WA=new Headers(kA?.headers);for(let[bA,FA]of Object.entries(QA))WA.set(bA,FA);return fetch(IA,{...kA,headers:WA})}},[]),SA=hg.useMemo(()=>QGB({anthropic:C9({baseURL:`${OC.apiUrl}/api/v1/proxy/anthropic/`,apiKey:tLA,fetch:CA}),openai:D9({baseURL:`${OC.apiUrl}/api/v1/proxy/openai/`,apiKey:tLA,fetch:CA}),google:w9({baseURL:`${OC.apiUrl}/api/v1/proxy/google/`,apiKey:tLA,fetch:CA})},{separator:" > "}),[CA]);hg.useEffect(()=>{if(!R){Y(null);return}try{let u=`${R.provider} > ${R.name}`,IA=SA.languageModel(u);Y(IA)}catch(u){fA.error("Failed to create language model",{error:u}),Y(null)}},[R,SA]);let XA=B&&!!C&&G!==null,KA=hg.useCallback(async(u,IA=5000)=>{let QA=0;while(QA<IA){if(V.current===u)return!0;await new Promise((WA)=>setTimeout(WA,50)),QA+=50}return V.current===u},[]),m=hg.useMemo(()=>({registry:SA,languageModel:G,availableModels:H,selectedModel:R,selectModel:l,getHeaders:d,isReady:XA,isUnavailable:J,waitForHeaders:KA}),[SA,G,H,R,l,d,XA,J,KA]);return O.jsxDEV(kJB.Provider,{value:m,children:A},void 0,!1,void 0,this)}function jU(){let A=hg.useContext(kJB);if(!A)throw Error("useAI must be used within an AIProvider");return A}var hg,tLA="embedder-proxy",kJB;var hx=z(async()=>{xFA();fFA();kFA();JM();R9();oF();ZE();rw();oL();qJ();CB();await ZJ();hg=iA(AQ(),1),kJB=hg.createContext(null)});function XJB({children:A}){let[B,Q]=NF.useState(null),[E,g]=NF.useState(!0),[C,I]=NF.useState(null),{isAuthenticated:w,apiFetch:D}=Tg();NF.useEffect(()=>{if(!w){Q(null);return}g(!0),(async()=>{I(null);try{let G=await D.get("api/v1/users/me/billing/status");Q(G)}catch(G){I(G instanceof Error?G.message:"Failed to load billing")}finally{g(!1)}})()},[w,D]);let H=B!==null&&B.accountStatus==="active",L=NF.useCallback(async()=>{if(!w)return;try{let U=await D.get("api/v1/users/me/billing/status");Q(U)}catch{}},[w,D]),R=NF.useMemo(()=>({billing:B,isLoading:E,error:C,hasPlan:H,refreshBilling:L}),[B,E,C,H,L]);return O.jsxDEV(hJB.Provider,{value:R,children:A},void 0,!1,void 0,this)}function A7(){let A=NF.useContext(hJB);if(!A)throw Error("useBilling must be used within a BillingProvider");return A}var NF,hJB;

// === Module: f7 (offset: 0xbaf442, 490 chars) ===
var f7=z(()=>{iUA=new Set,sUA=new Set,bUA=new Set,HG={publish(A,B){if(A==="permission.asked")for(let Q of iUA)try{Q(B)}catch{}else if(A==="permission.replied")for(let Q of sUA)try{Q(B)}catch{}else if(A==="lsp.diagnostics")for(let Q of bUA)try{Q(B)}catch{}},subscribe(A,B){if(A==="permission.asked")return iUA.add(B),()=>{iUA.delete(B)};if(A==="permission.replied")return sUA.add(B),()=>{sUA.delete(B)};if(A==="lsp.diagnostics")return bUA.add(B),()=>{bUA.delete(B)};return()=>{}}}});var CxB;

// === Module: N7 (offset: 0xc2e1e3, 6,945 chars) ===
var N7=z(()=>{f7();hM={pending:{},approved:{}};IW=class IW extends Error{sessionID;requestID;toolCallID;constructor(A,B,Q){super("The user rejected permission to use this specific tool call. You may try again with different parameters.");this.sessionID=A;this.requestID=B;this.toolCallID=Q;this.name="RejectedError"}};pO={async ask(A){let{sessionID:B,toolCallID:Q,request:E}=A;if(ZxB(B,E.patterns))return;let g=M$Q(),C={id:g,sessionID:B,toolCallID:Q,permission:E.permission,patterns:E.patterns,always:E.always??E.patterns,metadata:E.metadata,confirmationDetails:E.metadata.confirmationDetails,time:{created:Date.now()}};return new Promise((I,w)=>{hM.pending[g]={info:C,resolve:I,reject:w},HG.publish("permission.asked",C)})},reply(A){let{requestID:B,reply:Q,message:E}=A,g=hM.pending[B];if(!g)return;if(delete hM.pending[B],HG.publish("permission.replied",{requestID:B,sessionID:g.info.sessionID,reply:Q,toolCallID:g.info.toolCallID}),Q==="reject"){let C=E?Error(`The user rejected permission with feedback: ${E}`):new IW(g.info.sessionID,g.info.id,g.info.toolCallID);g.reject(C);for(let[I,w]of Object.entries(hM.pending))if(w.info.sessionID===g.info.sessionID)delete hM.pending[I],HG.publish("permission.replied",{requestID:I,sessionID:w.info.sessionID,reply:"reject",toolCallID:w.info.toolCallID}),w.reject(new IW(w.info.sessionID,w.info.id,w.info.toolCallID));return}if(Q==="once"){g.resolve();return}if(Q==="always"){let C=g.info.sessionID;if(!hM.approved[C])hM.approved[C]={};for(let I of g.info.always)hM.approved[C][I]=!0;g.resolve();for(let[I,w]of Object.entries(hM.pending)){if(w.info.sessionID!==C)continue;if(ZxB(C,w.info.patterns))delete hM.pending[I],HG.publish("permission.replied",{requestID:I,sessionID:w.info.sessionID,reply:"always",toolCallID:w.info.toolCallID}),w.resolve()}return}},list(){return Object.values(hM.pending).map((A)=>A.info).sort((A,B)=>A.id.localeCompare(B.id))},clearSession(A){for(let[B,Q]of Object.entries(hM.pending))if(Q.info.sessionID===A)delete hM.pending[B],Q.reject(Error("Session cleared"));delete hM.approved[A]},clearApprovals(A){delete hM.approved[A]},getApprovedPatterns(A){let B=hM.approved[A];if(!B)return[];return Object.keys(B)}}});function F$Q(A){if(A.length<=mUA)return A;let B=`

[Content truncated due to length...]`;return A.slice(0,mUA-B.length)+B}function y7(A){if(A===null||typeof A==="string"||typeof A==="number"||typeof A==="boolean")return A;if(A instanceof Error)return{name:A.name,message:A.message,stack:A.stack};try{return JSON.parse(JSON.stringify(A))}catch{try{return String(A)}catch{return"[unserializable]"}}}function qxB(A,B){let Q=B.result;if(FI({category:"tool",message:`Tool: ${B.toolName} - ${A}`,level:A==="success"?"info":"warning",data:{toolName:B.toolName,toolCallId:B.toolCallId,status:A,success:Q?.success,summary:Q?.summary}}),A!=="success")OI((E)=>{if(E.setTag("tool_name",B.toolName),E.setTag("tool_status",A),B.toolCallId)E.setTag("tool_call_id",B.toolCallId);E.setContext("tool",{args:y7(B.params),result:B.result!==void 0?y7(B.result):void 0,message:B.message});let g=A==="validationFailure"?`Tool ${B.toolName} validation failed`:`Tool ${B.toolName} failed`;lc(g,"error")})}function L$Q(A){switch(A){case"success":return"success";case"failure":return"failure";case"validationFailure":return"validation_failure";default:return"failure"}}function T7(A){eg.track.toolCall({toolCallId:A.toolCallId??"",toolName:A.toolName,displayName:A.displayName,status:L$Q(A.status),args:A.params,result:{success:A.result?.success??!1,summary:A.result?.summary??"",llmContent:A.result?.llmContent,returnDisplay:A.result?.returnDisplay,metadata:A.result?.metadata,locations:A.result?.locations?.map((B)=>({path:B.path,line:B.line,type:B.type}))},errorMessage:A.errorMessage,durationMs:A.endTime-A.startTime,startTime:A.startTime,endTime:A.endTime})}function U$Q(A,B){if(!A)return{success:!1,llmContent:"Error: Tool execution returned no result",returnDisplay:"Error: Tool execution returned no result",summary:"Tool execution failed"};if(typeof A.llmContent!=="string")return{success:!1,llmContent:"Error: Tool execution returned invalid content format",returnDisplay:"Error: Tool execution returned invalid content format",summary:"Tool execution failed"};if(!A.llmContent)return{success:!0,llmContent:A.summary||`Tool ${B} completed successfully`,returnDisplay:A.returnDisplay||A.summary||`Tool ${B} completed successfully`,summary:A.summary||"Tool completed successfully",metadata:A.metadata,locations:A.locations,diffData:A.diffData};let Q=A.llmContent;if(Q.length>mUA)Q=F$Q(Q);return{success:A.success,llmContent:Q,returnDisplay:A.returnDisplay||A.llmContent,summary:A.summary||"Tool completed successfully",metadata:A.metadata,locations:A.locations,diffData:A.diffData}}async function nUA(A,B,Q,E={}){let g=A.metadata.name,C=A.metadata.displayName,{toolCallId:I}=E,w=Date.now();try{if(A.validateParams){let R=A.validateParams(B);if(R){let U=`Validation Error: ${R}`,G=Date.now(),Y={success:!1,llmContent:U,returnDisplay:U,summary:"Validation failed"};return fA.warn(`Tool ${g} validation failed`,{toolCallId:I,params:y7(B),message:U}),qxB("validationFailure",{toolName:g,toolCallId:I,params:B,message:U}),T7({toolCallId:I,toolName:g,displayName:C,status:"validationFailure",params:B,result:Y,startTime:w,endTime:G}),Y}}if(A.metadata.canStream&&E.updateOutput)Q.updateOutput=E.updateOutput;let D=await sD({name:`tool.${g}`,op:"tool.execute",attributes:{"tool.name":g,"tool.call_id":I??"unknown","tool.category":A.metadata.category}},()=>A.execute(B,Q)),H=U$Q(D,g),L=Date.now();if(H.success)fA.info(`Tool ${g} succeeded`,{toolCallId:I,durationMs:L-w,summary:H.summary});else fA.warn(`Tool ${g} failed`,{toolCallId:I,durationMs:L-w,summary:H.summary,llmContent:H.llmContent?.slice(0,2000)});return qxB(H.success?"success":"failure",{toolName:g,toolCallId:I,params:B,result:H}),T7({toolCallId:I,toolName:g,displayName:C,status:H.success?"success":"failure",params:B,result:H,startTime:w,endTime:L}),H}catch(D){let H=uQ(D),L=Date.now();if(D instanceof IW){let U={success:!1,llmContent:`Tool execution was cancelled by the user. The user declined to approve the ${g} operation.`,returnDisplay:"Cancelled by user",summary:"Cancelled by user"};return fA.info(`Tool ${g} cancelled by user`,{toolCallId:I,durationMs:L-w}),eg.track.toolConfirmation({toolCallId:I??"",toolName:g,displayName:C,question:`Confirm ${g}?`,toolInput:B,decision:"rejected",decisionTimeMs:L-w}),T7({toolCallId:I,toolName:g,displayName:C,status:"failure",params:B,result:U,startTime:w,endTime:L}),U}fA.error(`Tool ${g} threw exception`,{toolCallId:I,durationMs:L-w,error:H,stack:D instanceof Error?D.stack:void 0}),zRB(D,{toolName:g,toolCallId:I,params:y7(B)});let R={success:!1,llmContent:`Error: ${H}`,returnDisplay:`Error: ${H}`,summary:"Tool execution failed"};return T7({toolCallId:I,toolName:g,displayName:C,status:"failure",params:B,result:R,errorMessage:H,startTime:w,endTime:L}),R}}var mUA=1e5;

// === Module: V7 (offset: 0xc302a2, 5,738 chars) ===
var V7=z(()=>{rC();fw();qI();wC();_xB=dE({metadata:{name:"compress_conversation",displayName:"Compact Conversation",description:`Compact the conversation history to reduce token usage while preserving important context for continuation.

Use this tool when:
- The conversation is getting long and you notice context limits approaching
- You want to consolidate earlier discussion before continuing
- The user explicitly asks to compress or summarize the conversation

The tool performs two operations:
1. Prunes old tool outputs (clearing content while preserving structure)
2. Generates a summary focused on continuation context (what was done, what's being worked on, what's next)

The summary is marked and used as the starting point for future context.`,category:"system",requiresConfirmation:!1},inputSchema:S.object({reason:S.string().optional().describe("Brief reason for compacting (e.g., 'context limit approaching', 'user requested')")}),getDescription:({reason:A})=>{return A?`Compacting conversation: ${A}`:"Compacting conversation history"},getLocations:()=>[],execute:async({reason:A})=>{try{let B=yB.getState().compressHandler;if(!B)return{success:!1,llmContent:"Compaction handler not available. Compaction requires UI integration.",summary:"Cannot compact conversation"};let Q=await B(A);if(Q.success){let E=Math.round(Q.newTokenCount/Q.originalTokenCount*100);return{success:!0,summary:`Compacted ${Q.originalTokenCount.toLocaleString()} \u2192 ${Q.newTokenCount.toLocaleString()} tokens`,llmContent:`Conversation compacted successfully.
- Original: ${Q.originalTokenCount.toLocaleString()} tokens
- After compaction: ${Q.newTokenCount.toLocaleString()} tokens
- Reduction: ${100-E}%

The conversation history has been compacted. Old tool outputs have been pruned and a continuation summary has been created. Future context will start from this summary point.`}}return{success:!1,llmContent:`Compaction failed: ${Q.error||"Unknown error"}`,summary:"Compaction failed"}}catch(B){return{success:!1,llmContent:`Error compacting conversation: ${uQ(B)}`,summary:"Compaction error"}}}})});function uxB(A){yB.getState().setInitHandler(A)}function axB(){yB.getState().setInitHandler(null)}async function lxB(){let A=yB.getState(),B=A.modeHandler;if(B)B("act");let Q=A.autoApprovalHandler;if(Q)Q(!0);let E=A.initPromptHandler;if(!E)return{success:!1,error:"Init prompt handler not available"};return A.setInitInProgress(!0),await E(txB,"/init"),{success:!0}}var txB=`Please analyze this codebase and create an EMBEDDER.md file that contains all information specified in the format below.

IMPORTANT: Before creating the file, use the askQuestion tool to ask the user about any information you cannot determine from the codebase. Ask multiple related questions at once (up to 4) for better UX. For example, ask about:
- Target MCU/chip family if unclear from code
- Development board being used
- Build system and toolchain preferences
- Debug interface (ST-Link, J-Link, serial)
- Serial port and baudrate for monitoring

Only proceed to create the EMBEDDER.md file after gathering the necessary information from the user.

The file you create will be given to agentic coding agents (such as yourself) that operate in this repository. Follow this format:
**EMBEDDER PROJECT CONTEXT**
<OVERVIEW>
Name = MyProject
Target MCU = <chip or family>
Board = <board>
Toolchain = <toolchain>
Debug Interface = <st-link|jlink|serial>
RTOS / SDK = <freertos|zephyr|sdk>
Project Summary = <one-line description>
</OVERVIEW>

<COMMANDS>
# --- Build / Compile --------------------------------------------------------
build_command = <shell command to build>

# --- Flash ------------------------------------------------------------------
flash_command = <shell command to flash>

# --- Debug ------------------------------------------------------------------
gdb_server_command = <optional, e.g., openocd ... or ST-LINK_gdbserver ...>
gdb_server_host = localhost
gdb_server_port = 61234
gdb_client_command = arm-none-eabi-gdb
target_connection = remote

# --- Serial Monitor ----------------------------------------------------------
# Option 1: For custom commands (waf, make, etc.)
# serial_monitor_command = source .venv/bin/activate && ./waf console --tty /dev/ttyACM0
# serial_monitor_interactive = true
# serial_startup_commands = [reset]

# Option 2: Direct port/baudrate (use {port} and {baud} placeholders)
serial_port = /dev/ttyACM0
serial_baudrate = 115200
serial_monitor_command = tio {port} -b {baud}
serial_monitor_interactive = false
serial_encoding = ascii
serial_startup_commands = []

# Project Overview 
Write a clear and concise summary of the project's purpose, main technologies, and architecture.

# Bash Commands 
Document all commands related to build and interactive with hardware, keep it short and concise.

# Code style
document all required formating and documentation conventions, keep it short and concise


If there are Cursor rules (in .cursor/rules/ or .cursorrules) or Copilot rules
(in .github/copilot-instructions.md), make sure to include them.

Keep all descriptions short and concise, never create any code or complete the project only create or edit embedder.md file.

After you have finished making embedder.md Provide a recommendation of documents necessary to support this project i.e. if
the project is based on a development board, suggest including the datasheet and
application references. For the MCU used in the project, suggest including the
relevant datasheet and erratas. For the peripherals found in the drivers,
suggest including datasheets and application notes. When possible, provide links
to these documents. 

If there's already an EMBEDDER.md, improve it if it's located in /
`,$xB;

// === Module: eO (offset: 0xc34309, 232 chars) ===
var eO=z(()=>{oO();hO();exB=kL("conversations"),AfB=kL("conversations","index.json")});function ZF(){return yB.getState().currentSessionId}function zJ(A){return yB.getState().getTodos(A)}function AN(A,B){yB.getState().setTodos(A,B)}

// === Module: o0A (offset: 0xc43819, 3,763 chars) ===
var o0A=_((nCg,lkB)=>{var k0A=DN(),ukB=FW(),MpQ=pM(),akB=F0A(),HpQ=s4(),FpQ=YcB(),LpQ=ScB(),UpQ=ccB(),GpQ=hcB(),RpQ=PcB(),KpQ=NcB(),YpQ=ycB(),JpQ=ZcB(),SpQ=sU(),xpQ=jcB(),fpQ=icB(),cpQ=$7(),kpQ=_cB(),opQ=ucB(),hpQ=UW(),XpQ=m7(),PpQ=U0A(),OpQ=G0A(),NpQ=n7(),TpQ=p7(),ypQ=R0A(),VpQ=AkB(),ZpQ=RW(),qpQ=bU(),WpQ=YW(),zpQ=KkB(),jpQ=JkB(),vpQ=xkB(),ipQ=kkB(),spQ=hkB(),bpQ=B_(),dpQ=ykB(),_pQ=ZkB(),tpQ=zkB(),upQ=vkB(),apQ=tkB();lkB.exports={parse:HpQ,valid:FpQ,clean:LpQ,inc:UpQ,diff:GpQ,major:RpQ,minor:KpQ,patch:YpQ,prerelease:JpQ,compare:SpQ,rcompare:xpQ,compareLoose:fpQ,compareBuild:cpQ,sort:kpQ,rsort:opQ,gt:hpQ,lt:XpQ,eq:PpQ,neq:OpQ,gte:NpQ,lte:TpQ,cmp:ypQ,coerce:VpQ,Comparator:ZpQ,Range:qpQ,satisfies:WpQ,toComparators:zpQ,maxSatisfying:jpQ,minSatisfying:vpQ,minVersion:ipQ,validRange:spQ,outside:bpQ,gtr:dpQ,ltr:_pQ,intersects:tpQ,simplifyRange:upQ,subset:apQ,SemVer:MpQ,re:k0A.re,src:k0A.src,tokens:k0A.t,SEMVER_SPEC_VERSION:ukB.SEMVER_SPEC_VERSION,RELEASE_TYPES:ukB.RELEASE_TYPES,compareIdentifiers:akB.compareIdentifiers,rcompareIdentifiers:akB.rcompareIdentifiers}});import Q_ from"fs";import $kB from"os";import SW from"path";var{$:mkB}=globalThis.Bun;function pkB(){return}function E_(){return"curl -fsSL https://embedder.com/install | bash"}async function lpQ(){if(process.env.GITHUB_TOKEN)return process.env.GITHUB_TOKEN;if(process.env.GH_TOKEN)return process.env.GH_TOKEN;let B=SW.join($kB.homedir(),".config","gh","hosts.yml");try{if(Q_.existsSync(B)){let E=Q_.readFileSync(B,"utf-8").match(/oauth_token:\s*(.+)/);if(E?.[1])return E[1].trim()}}catch{}return null}async function rkB(A){try{let B=await lpQ(),Q={"User-Agent":"embedder-cli"};if(B)Q.Authorization=`Bearer ${B}`;let E=await fetch("https://api.github.com/repos/embedder-dev/embedder-cli/releases/latest",{headers:Q});if(!E.ok)return fA.info("GitHub version check failed",{status:E.status,statusText:E.statusText,authenticated:!!B}),null;let C=((await E.json()).tag_name||"").replace(/^v/,"");if(!C||nkB.default.gte(A,C))return null;return{currentVersion:A,version:C}}catch(B){let Q=B instanceof Error?B.message:String(B);return fA.info("GitHub version check failed",{error:Q}),null}}function h0A(){let A=process.execPath,B=!1,Q=SW.join(".embedder","bin");if(A.includes(Q))return"curl";return"unknown"}async function ekB(A){let B=h0A(),Q=E_();if(B==="unknown")return fA.info("Upgrade skipped: unknown install method",{execPath:process.execPath}),{success:!1,error:"Unknown installation method",manualInstallCommand:Q};let E=!1;fA.info("Starting upgrade",{version:A,method:B,isWindows:E,execPath:process.execPath});try{let g="",C="",I=0;if(E){let D=Bun.spawn(["powershell.exe","-NoProfile","-NonInteractive","-Command","$ProgressPreference = 'SilentlyContinue'; irm https://embedder.com/install | iex"],{env:{...process.env,VERSION:A},stdio:["ignore","pipe","pipe"]}),[H,L]=await Promise.all([new Response(D.stdout).text(),new Response(D.stderr).text()]);g=H,C=L,I=await D.exited}else{let w=await mkB`curl -fsSL https://embedder.com/install | bash`.env({...process.env,VERSION:A}).quiet().nothrow();g=w.stdout.toString(),C=w.stderr.toString(),I=w.exitCode}if(fA.info("Upgrade command completed",{exitCode:I,stdoutLength:g.length,stderrLength:C.length,stdout:g.slice(0,2000),stderr:C.slice(0,2000)}),I!==0){let w=C||"Upgrade failed with non-zero exit code";return fA.info("Upgrade failed with exit code",{exitCode:I,error:w}),{success:!1,error:w,manualInstallCommand:Q}}return await mkB`${process.execPath} --version`.nothrow().quiet(),fA.info("Upgrade successful",{version:A}),{success:!0}}catch(g){let C=g instanceof Error?g.message:String(g);return fA.info("Upgrade exception caught",{error:C,stack:g instanceof Error?g.stack:void 0}),{success:!1,error:C,manualInstallCommand:Q}}}var nkB;

// === Module: O0A (offset: 0xc51376, 1,973 chars) ===
var O0A=z(()=>{ZE();ArQ=[{name:"Documentation Files",extensions:["pdf","md","txt","rst","doc","docx","html","htm","xml"]},{name:"All Files",extensions:["*"]}],I_=[{name:"PDF Documents",extensions:["pdf"]}]});import{basename as N0A}from"path";async function wrQ(A,B,Q,E=!1){fA.debug(`uploadDocument called with projectId: "${B}", file: ${N0A(Q)}`);try{let g=Buffer.from(await Bun.file(Q).arrayBuffer());if(g.length>IrQ)return{success:!1,error:`File is too large (${Math.round(g.length/1024/1024)}MB). Maximum size is 50MB.`};let C=N0A(Q),I=new FormData;if(I.append("projectId",B),I.append("name",C),I.append("file",new Blob([g],{type:"application/pdf"}),C),E)I.append("forceUpload","true");let w=await A();if(!w)return{success:!1,error:"Not authenticated"};let D={Authorization:`Bearer ${w}`,"User-Agent":`embedder-cli/${vD}`};if(vH&&OC.stagingToken)D["x-staging-token"]=OC.stagingToken;let H=await fetch(`${OC.apiUrl}/api/v1/documents`,{method:"POST",headers:D,body:I});if(!H.ok){let L=await H.text(),R;try{R=JSON.parse(L).error||L}catch{R=L}if(H.status===400)return{success:!1,error:R};if(H.status===404)return fA.error(`404 Not Found for projectId: "${B}", backend response: ${R}`),{success:!1,error:"Project not found"};if(H.status===409)return{success:!1,error:"Document with same content already exists"};return fA.error(`Document upload failed: ${H.status} - ${R}`),{success:!1,error:R}}return{success:!0}}catch(g){let C=g instanceof Error?g.message:"Unknown error";return fA.error(`Failed to upload document: ${C}`,g),{success:!1,error:C}}}async function D_(A,B,Q,E){let g=[],C=0,I=0;for(let[w,D]of Q.entries()){let H=N0A(D);E?.({current:w+1,total:Q.length,fileName:H,status:"uploading"});let L=await wrQ(A,B,D);if(L.success)C++,E?.({current:w+1,total:Q.length,fileName:H,status:"success"});else{I++;let R=`${H}: ${L.error}`;g.push(R),E?.({current:w+1,total:Q.length,fileName:H,status:"error",error:L.error})}}return{successful:C,failed:I,errors:g}}var IrQ=52428800;

// === Module: T0A (offset: 0xc51b2b, 27,654 chars) ===
var T0A=z(()=>{oF();ZE()});import{basename as DrQ}from"path";function M_({projectId:A,initialName:B="",onComplete:Q,onCancel:E}){let g=WB(),C=xD.useRef(null),[I,w]=xD.useState(B),[D,H]=xD.useState([]),[L,R]=xD.useState(B?"files":"name"),[U,G]=xD.useState(!1),[Y,J]=xD.useState(!1),[c,h]=xD.useState(null),[V,T]=xD.useState(null),{isAuthenticated:k,getToken:q}=Tg();xD.useEffect(()=>{if(B&&C.current)C.current.editBuffer.setText(B)},[B]);let s=xD.useCallback(async()=>{if(U)return;G(!0),h(null);try{let SA=await w_({title:"Select PDF Documentation Files",filters:I_});if(SA.length>0)H((XA)=>{let KA=new Set(XA),m=SA.filter((u)=>!KA.has(u));return[...XA,...m]})}catch{h("Failed to open file picker")}finally{G(!1)}},[U]),j=xD.useCallback((SA)=>{H((XA)=>XA.filter((KA,m)=>m!==SA))},[]),i=xD.useCallback(async()=>{let SA=I.trim();if(!SA){h("Please enter a peripheral name");return}if(D.length===0){h("Please select at least one PDF file");return}if(!k){h("Not authenticated");return}if(!A){h("No project selected");return}J(!0),h(null),T(null);try{let XA=await D_(q,A,D,(m)=>T(m));if(XA.failed>0){if(XA.successful===0){h(`All uploads failed: ${XA.errors[0]}`),J(!1);return}}let KA={id:rYB(),type:"peripheral",name:SA,manufacturer:"Custom",function:`Custom peripheral with ${XA.successful} document(s)`};Q(KA)}catch(XA){let KA=XA instanceof Error?XA.message:"Failed to upload documents";h(KA)}finally{J(!1),T(null)}},[I,D,k,q,A,Q]),d=xD.useCallback(()=>{let SA=C.current?.editBuffer.getText()??"";w(SA)},[]),l=xD.useCallback(()=>{if(I.trim())R("files")},[I]),e=xD.useCallback((SA)=>{if(L==="files"){let XA=Number.parseInt(SA.name??"",10);if(!Number.isNaN(XA)&&XA>=1&&XA<=9){let KA=XA-1;if(KA<D.length)j(KA)}}},[L,D.length,j]);ig({cancel:E,tab:()=>R((SA)=>SA==="name"?"files":"name"),select:L==="files"?()=>{if(D.length>0&&I.trim())i();else s()}:void 0,toggle:L==="files"?s:void 0},{onUnhandledKey:e,textInputActive:L==="name"});let CA=I.trim().length>0&&D.length>0&&!Y&&!U;if(Y)return O.jsxDEV(RC,{children:O.jsxDEV("box",{flexDirection:"column",alignItems:"center",children:[O.jsxDEV("text",{attributes:jA.BOLD,children:"Uploading Documents"},void 0,!1,void 0,this),O.jsxDEV("box",{marginTop:1,flexDirection:"row",alignItems:"center",children:[O.jsxDEV("spinner",{name:"dots"},void 0,!1,void 0,this),V?O.jsxDEV("text",{fg:g.text,children:[" ","Uploading ",V.current,"/",V.total,":"," ",V.fileName]},void 0,!0,void 0,this):O.jsxDEV("text",{fg:g.text,children:" Preparing upload..."},void 0,!1,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this);return O.jsxDEV(RC,{alignTop:!0,children:O.jsxDEV("box",{marginTop:2,flexDirection:"column",alignItems:"center",width:60,children:[O.jsxDEV("box",{flexDirection:"row",justifyContent:"space-between",width:"100%",children:[O.jsxDEV("text",{fg:g.textMuted,attributes:jA.DIM,children:[xg," cancel"]},void 0,!0,void 0,this),O.jsxDEV("text",{fg:g.textMuted,attributes:jA.DIM,children:[Tx," ",L==="name"?"\u2192 files":"\u2192 name"]},void 0,!0,void 0,this)]},void 0,!0,void 0,this),O.jsxDEV("box",{marginTop:1,children:O.jsxDEV("text",{attributes:jA.BOLD,children:"Add Custom Peripheral"},void 0,!1,void 0,this)},void 0,!1,void 0,this),O.jsxDEV("box",{marginTop:2,flexDirection:"column",width:"100%",borderStyle:"rounded",borderColor:L==="name"?g.borderActive:g.border,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1,children:[O.jsxDEV("text",{fg:L==="name"?g.primary:g.text,attributes:jA.BOLD,children:["Peripheral Name ",L==="name"&&"\u25B8"]},void 0,!0,void 0,this),O.jsxDEV("box",{marginTop:1,borderStyle:"rounded",borderColor:L==="name"?g.borderActive:g.border,paddingLeft:1,paddingRight:1,children:O.jsxDEV("textarea",{ref:C,onSubmit:l,onContentChange:d,placeholder:"e.g., BME280, W25Q128",flexGrow:1,height:1,focused:L==="name",textColor:g.text,focusedTextColor:g.text,backgroundColor:"transparent",keyBindings:[{name:"return",action:"submit"}]},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this),O.jsxDEV("box",{marginTop:1,flexDirection:"column",width:"100%",borderStyle:"rounded",borderColor:L==="files"?g.borderActive:g.border,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1,height:12,children:[O.jsxDEV("text",{fg:L==="files"?g.primary:g.text,attributes:jA.BOLD,children:["PDF Documentation ",L==="files"&&"\u25B8"]},void 0,!0,void 0,this),O.jsxDEV("box",{marginTop:1,flexDirection:"column",flexGrow:1,children:D.length===0?O.jsxDEV("box",{justifyContent:"center",alignItems:"center",flexGrow:1,children:U?O.jsxDEV("box",{flexDirection:"row",alignItems:"center",children:[O.jsxDEV("spinner",{name:"dots"},void 0,!1,void 0,this),O.jsxDEV("text",{fg:g.textMuted,children:" Opening file picker..."},void 0,!1,void 0,this)]},void 0,!0,void 0,this):O.jsxDEV("text",{fg:g.textMuted,children:"No files selected. Press SPACE or ENTER to browse."},void 0,!1,void 0,this)},void 0,!1,void 0,this):O.jsxDEV("box",{flexDirection:"column",children:[D.map((SA,XA)=>O.jsxDEV("box",{flexDirection:"row",children:[O.jsxDEV("text",{fg:g.textMuted,children:[XA+1,". "]},void 0,!0,void 0,this),O.jsxDEV("text",{fg:g.success,children:DrQ(SA)},void 0,!1,void 0,this),O.jsxDEV("text",{fg:g.textMuted,children:[" ","- Press ",XA+1," to remove"]},void 0,!0,void 0,this)]},SA,!0,void 0,this)),!U&&O.jsxDEV("box",{marginTop:1,children:O.jsxDEV("text",{fg:g.textMuted,children:"SPACE to add more, ENTER to continue"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this),c&&O.jsxDEV("box",{marginTop:1,children:O.jsxDEV("text",{fg:g.error,children:c},void 0,!1,void 0,this)},void 0,!1,void 0,this),O.jsxDEV("box",{marginTop:1,children:O.jsxDEV("text",{fg:CA?g.success:g.textMuted,children:D.length>0?CA?`Press ${vg} to upload and add peripheral \u2192`:"Enter a peripheral name to continue":"Upload PDF documentation to continue"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this)}var xD;var y0A=z(async()=>{rw();O0A();T0A();CB();await pQ([yE(),VL(),qE(),mD(),gK()]);xD=iA(AQ(),1)});import{basename as MrQ}from"path";function HrQ(A){let B=A.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),Q=Math.random().toString(36).substring(2,6);return`${B}-${Q}`}function w4B({initialName:A="",onComplete:B,onCancel:Q}){let E=WB(),g=IF(),C=BI.useRef(null),[I,w]=BI.useState(A),[D,H]=BI.useState([]),[L,R]=BI.useState(A?"files":"name"),[U,G]=BI.useState(!1),[Y,J]=BI.useState(!1),[c,h]=BI.useState(null),[V,T]=BI.useState(null),[k,q]=BI.useState(null),{isAuthenticated:s,getToken:j,apiFetch:i}=Tg(),{selectedTeam:d}=ew();BI.useEffect(()=>{if(A&&C.current)C.current.editBuffer.setText(A)},[A]);let l=BI.useCallback(async()=>{if(U)return;G(!0),h(null);try{let GA=await w_({title:"Select PDF Documentation Files",filters:I_});if(GA.length>0)H((MA)=>{let TA=new Set(MA),OA=GA.filter((oB)=>!TA.has(oB));return[...MA,...OA]})}catch{h("Failed to open file picker")}finally{G(!1)}},[U]),e=BI.useCallback((GA)=>{H((MA)=>MA.filter((TA,OA)=>OA!==GA))},[]),CA=BI.useCallback(async()=>{let GA=I.trim();if(!GA){h("Please enter a platform name");return}if(D.length===0){h("Please select at least one PDF file");return}if(!s){h("Not authenticated");return}if(!d){h("No team selected");return}J(!0),h(null),T(null),q("creating");try{let MA=HrQ(GA),TA=await i.post("api/v1/projects",{name:MA,teamId:d.id});q("uploading");let OA=await D_(j,TA.id,D,(aA)=>T(aA));if(OA.failed>0){if(OA.successful===0){h(`All uploads failed: ${OA.errors[0]}`),J(!1),q(null);return}}let oB={id:eYB(TA.id),type:"platform",name:GA,manufacturer:"Custom",function:`Custom platform with ${OA.successful} document(s)`};B(oB,TA)}catch(MA){let TA=MA instanceof Error?MA.message:"Failed to create project";h(TA)}finally{J(!1),T(null),q(null)}},[I,D,s,j,d,i,B]),SA=BI.useCallback(()=>{let GA=C.current?.editBuffer.getText()??"";w(GA)},[]),XA=BI.useCallback(()=>{let GA=C.current?.editBuffer.getText()??"";if(GA.trim())w(GA),h(null),R("files")},[]),KA=BI.useCallback(()=>{h(null),R("name")},[]),m=BI.useCallback((GA)=>{if(L==="files"){let MA=Number.parseInt(GA.name??"",10);if(!Number.isNaN(MA)&&MA>=1&&MA<=9){let TA=MA-1;if(TA<D.length)e(TA)}}},[L,D.length,e]);ig({cancel:L==="name"?Q:KA,select:L==="files"?()=>{if(D.length>0)CA();else l()}:void 0,toggle:L==="files"?l:void 0},{onUnhandledKey:m,textInputActive:L==="name"});let u=V0A-2,IA=u-4,kA=BI.useMemo(()=>{if(Y)return 8;if(L==="name")return 12;if(D.length===0)return 15;return 15+D.length+1},[Y,L,D.length]),QA=Math.max(0,Math.floor((g.width-V0A)/2)),WA=Math.max(0,Math.floor((g.height-kA)/2)),bA=BI.useCallback(()=>{let GA=[],MA=WA;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2554${"\u2550".repeat(u)}\u2557`},void 0,!1,void 0,this)},"top",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty1",!1,void 0,this)),MA++;let TA=k==="creating"?"CREATING PROJECT":"UPLOADING";GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,attributes:jA.BOLD,children:`\u2551${fW(Z0A(TA),u)}\u2551`},void 0,!1,void 0,this)},"title",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty2",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2560${"\u2550".repeat(u)}\u2563`},void 0,!1,void 0,this)},"div",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"spinner-border",!1,void 0,this));let OA=k==="creating"?"Creating project...":V?`Uploading ${V.current}/${V.total}: ${V.fileName}`:"Preparing upload...";return GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,flexDirection:"row",children:[O.jsxDEV("spinner",{name:"dots"},void 0,!1,void 0,this),O.jsxDEV("text",{fg:E.text,children:[" ",OA.slice(0,IA-4)]},void 0,!0,void 0,this)]},"spinner",!0,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty3",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u255A${"\u2550".repeat(u)}\u255D`},void 0,!1,void 0,this)},"bottom",!1,void 0,this)),GA},[QA,WA,u,IA,E,k,V]),FA=BI.useCallback(()=>{let GA=[],MA=WA;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2554${"\u2550".repeat(u)}\u2557`},void 0,!1,void 0,this)},"top",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty1",!1,void 0,this)),MA++;let TA=Z0A("ADD CUSTOM PLATFORM");GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,attributes:jA.BOLD,children:`\u2551${fW(TA,u)}\u2551`},void 0,!1,void 0,this)},"title",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${fW("Step 1 of 2",u)}\u2551`},void 0,!1,void 0,this)},"step",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty2",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2560${"\u2550".repeat(u)}\u2563`},void 0,!1,void 0,this)},"div",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"label-border",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,children:O.jsxDEV("text",{fg:E.text,children:"Enter a name for your platform:"},void 0,!1,void 0,this)},"label",!1,void 0,this)),MA++;let OA=IA-2;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551  \u250C${"\u2500".repeat(OA)}\u2510  \u2551`},void 0,!1,void 0,this)},"input-top",!1,void 0,this)),MA++;let oB=MA;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:oB,children:O.jsxDEV("text",{fg:E.primary,children:"\u2551  \u2502 "},void 0,!1,void 0,this)},"input-left",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+V0A-5,top:oB,children:O.jsxDEV("text",{fg:E.primary,children:" \u2502  \u2551"},void 0,!1,void 0,this)},"input-right",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+6,top:oB,width:OA-3,children:O.jsxDEV("textarea",{ref:C,onSubmit:XA,onContentChange:SA,placeholder:"e.g., STM32F103C8T6, ESP32-S3",width:OA-3,height:1,flexGrow:1,focused:!0,textColor:E.text,focusedTextColor:E.text,backgroundColor:"transparent",keyBindings:[{name:"return",action:"submit"}]},void 0,!1,void 0,this)},"input",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551  \u2514${"\u2500".repeat(OA)}\u2518  \u2551`},void 0,!1,void 0,this)},"input-bottom",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty3",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u255A${"\u2550".repeat(u)}\u255D`},void 0,!1,void 0,this)},"bottom",!1,void 0,this)),MA++;let BB=I.trim().length>0?"ENTER to continue \xB7 ESC to cancel":"ESC to cancel",wB=Math.floor((g.width-BB.length)/2);return GA.push(O.jsxDEV("box",{position:"absolute",left:wB,top:MA,children:O.jsxDEV("text",{fg:E.textMuted,attributes:jA.DIM,children:BB},void 0,!1,void 0,this)},"instructions",!1,void 0,this)),GA},[QA,WA,u,IA,E,g.width,I,XA,SA]),a=BI.useCallback(()=>{let GA=[],MA=WA;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2554${"\u2550".repeat(u)}\u2557`},void 0,!1,void 0,this)},"top",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty1",!1,void 0,this)),MA++;let TA=Z0A("ADD CUSTOM PLATFORM");if(GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,attributes:jA.BOLD,children:`\u2551${fW(TA,u)}\u2551`},void 0,!1,void 0,this)},"title",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${fW("Step 2 of 2",u)}\u2551`},void 0,!1,void 0,this)},"step",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty2",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2560${"\u2550".repeat(u)}\u2563`},void 0,!1,void 0,this)},"div",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"platform-border",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,flexDirection:"row",children:[O.jsxDEV("text",{fg:E.textMuted,children:"Platform: "},void 0,!1,void 0,this),O.jsxDEV("text",{fg:E.accent,attributes:jA.BOLD,children:I.slice(0,IA-12)},void 0,!1,void 0,this)]},"platform",!0,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty3",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"label-border",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,children:O.jsxDEV("text",{fg:E.textMuted,children:"PDF Documentation:"},void 0,!1,void 0,this)},"label",!1,void 0,this)),MA++,D.length===0){if(GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty4",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"no-files-border",!1,void 0,this)),U)GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,flexDirection:"row",children:[O.jsxDEV("spinner",{name:"dots"},void 0,!1,void 0,this),O.jsxDEV("text",{fg:E.textMuted,children:" Opening file picker..."},void 0,!1,void 0,this)]},"no-files",!0,void 0,this));else GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,children:O.jsxDEV("text",{fg:E.accent,children:"\u25B8 Press ENTER to select PDF files"},void 0,!1,void 0,this)},"no-files",!1,void 0,this));MA++}else{GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty4",!1,void 0,this)),MA++;for(let BB=0;BB<D.length;BB++){let wB=D[BB];if(!wB)continue;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},`file-${BB}-border`,!1,void 0,this));let EA=MrQ(wB),JA=IA-18,r=EA.length>JA?`${EA.slice(0,JA-3)}...`:EA;GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,flexDirection:"row",children:[O.jsxDEV("text",{fg:E.success,children:"\u2713 "},void 0,!1,void 0,this),O.jsxDEV("text",{fg:E.text,children:r},void 0,!1,void 0,this),O.jsxDEV("text",{fg:E.textMuted,children:[" (",BB+1,")"]},void 0,!0,void 0,this)]},`file-${BB}`,!0,void 0,this)),MA++}GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"hint-border",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,children:O.jsxDEV("text",{fg:E.textMuted,children:"Press number to remove file"},void 0,!1,void 0,this)},"hint",!1,void 0,this)),MA++}if(c)GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"error-border",!1,void 0,this)),GA.push(O.jsxDEV("box",{position:"absolute",left:QA+3,top:MA,children:O.jsxDEV("text",{fg:E.error,children:c.slice(0,IA)},void 0,!1,void 0,this)},"error",!1,void 0,this)),MA++;GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u2551${" ".repeat(u)}\u2551`},void 0,!1,void 0,this)},"empty5",!1,void 0,this)),MA++,GA.push(O.jsxDEV("box",{position:"absolute",left:QA,top:MA,children:O.jsxDEV("text",{fg:E.primary,children:`\u255A${"\u2550".repeat(u)}\u255D`},void 0,!1,void 0,this)},"bottom",!1,void 0,this)),MA++;let OA=D.length>0&&!U,oB;if(OA)oB="ENTER to create \xB7 SPACE to add more \xB7 ESC to go back";else oB="ENTER to browse files \xB7 ESC to go back";let aA=Math.floor((g.width-oB.length)/2);return GA.push(O.jsxDEV("box",{position:"absolute",left:aA,top:MA,children:O.jsxDEV("text",{fg:E.textMuted,attributes:jA.DIM,children:oB},void 0,!1,void 0,this)},"instructions",!1,void 0,this)),GA},[QA,WA,u,IA,E,g.width,I,D,U,c]),wA=BI.useMemo(()=>{if(Y)return bA();if(L==="name")return FA();return a()},[Y,L,bA,FA,a]);return O.jsxDEV("box",{width:"100%",height:"100%",position:"relative",children:wA},void 0,!1,void 0,this)}var BI,V0A=60,fW=(A,B)=>{if(A.length>=B)return A.slice(0,B);let Q=Math.floor((B-A.length)/2);return" ".repeat(Q)+A+" ".repeat(B-A.length-Q)},Z0A=(A)=>A.split("").join(" ");var D4B=z(async()=>{rw();zU();O0A();T0A();CB();await pQ([yE(),Tw(),qE(),mD(),gK()]);BI=iA(AQ(),1)});function LrQ(A,B){switch(B.type){case"SET_STEP":return{...A,step:B.step};case"SET_CREATING":return{...A,isCreating:B.isCreating};case"SET_PLATFORMS":return{...A,platforms:B.platforms};case"SET_PERIPHERALS":return{...A,peripherals:B.peripherals};case"SET_CATALOG_LOADING":return{...A,catalogLoading:B.loading};case"SET_CATALOG_ERROR":return{...A,catalogError:B.error};case"SELECT_PLATFORM":return{...A,selectedPlatform:B.platform,generatedName:B.generatedName,step:"peripheral"};case"SET_PENDING_PROJECT":return{...A,pendingProject:B.project};case"OPEN_ADD_PLATFORM":return{...A,isAddPlatformOpen:!0,pendingPlatformName:B.name};case"CLOSE_ADD_PLATFORM":return{...A,isAddPlatformOpen:!1,pendingPlatformName:""};case"ADD_CUSTOM_PLATFORM":return{...A,selectedPlatform:B.platform,pendingProject:B.project,generatedName:B.project.name,isAddPlatformOpen:!1,pendingPlatformName:"",step:"peripheral"};case"OPEN_ADD_PERIPHERAL":return{...A,isAddPeripheralOpen:!0,pendingPeripheralName:B.name};case"CLOSE_ADD_PERIPHERAL":return{...A,isAddPeripheralOpen:!1,pendingPeripheralName:""};case"ADD_CUSTOM_PERIPHERAL":return{...A,customPeripherals:[...A.customPeripherals,B.peripheral],isAddPeripheralOpen:!1,pendingPeripheralName:""};case"RESET_TO_PLATFORM":return{...A,step:"platform",selectedPlatform:null,generatedName:""};default:return A}}function UrQ(A){let B=A.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),Q=Math.random().toString(36).substring(2,6);return`${B}-${Q}`}function M4B(A){return{id:String(A.id),name:String(A.name),description:A.function,meta:String(A.manufacturer)}}function H4B(){let A=WB(),[B,Q]=kw.useReducer(LrQ,FrQ),{createProject:E,error:g,selectProject:C}=xw(),{selectedTeam:I}=ew(),{apiFetch:w}=Tg(),{setStatus:D}=pR();kw.useEffect(()=>{if(B.step==="platform"&&B.platforms.length===0)Q({type:"SET_CATALOG_LOADING",loading:!0}),Q({type:"SET_CATALOG_ERROR",error:null}),pd(w).then((i)=>Q({type:"SET_PLATFORMS",platforms:i})).catch(()=>Q({type:"SET_CATALOG_ERROR",error:"Failed to load platforms"})).finally(()=>Q({type:"SET_CATALOG_LOADING",loading:!1}))},[B.step,B.platforms.length,w]),kw.useEffect(()=>{if(B.step==="peripheral"&&B.peripherals.length===0)Q({type:"SET_CATALOG_LOADING",loading:!0}),Q({type:"SET_CATALOG_ERROR",error:null}),rd(w).then((i)=>Q({type:"SET_PERIPHERALS",peripherals:i})).catch(()=>Q({type:"SET_CATALOG_ERROR",error:"Failed to load peripherals"})).finally(()=>Q({type:"SET_CATALOG_LOADING",loading:!1}))},[B.step,B.peripherals.length,w]);let H=kw.useCallback((i)=>{let d=B.platforms.find((l)=>l.id===i.id);if(d)Q({type:"SELECT_PLATFORM",platform:d,generatedName:UrQ(d.name)})},[B.platforms]),L=kw.useCallback((i)=>{Q({type:"OPEN_ADD_PLATFORM",name:i.trim()})},[]),R=kw.useCallback((i,d)=>{Q({type:"ADD_CUSTOM_PLATFORM",platform:i,project:d})},[]),U=kw.useCallback(()=>{Q({type:"CLOSE_ADD_PLATFORM"})},[]),G=kw.useCallback(async()=>{if(B.pendingProject)return B.pendingProject;if(!I||!B.selectedPlatform||!B.generatedName)return null;try{let i=await w.post("api/v1/projects",{name:B.generatedName,teamId:I.id});return await TO(w,i.id,B.selectedPlatform.id),Q({type:"SET_PENDING_PROJECT",project:i}),i}catch{return null}},[B.pendingProject,B.selectedPlatform,B.generatedName,I,w]),Y=kw.useCallback(async(i)=>{Q({type:"SET_CREATING",isCreating:!0});let d=await G();if(Q({type:"SET_CREATING",isCreating:!1}),!d){Q({type:"SET_CATALOG_ERROR",error:"Failed to create project for custom peripheral"});return}Q({type:"OPEN_ADD_PERIPHERAL",name:i.trim()})},[G]),J=kw.useCallback((i)=>{Q({type:"ADD_CUSTOM_PERIPHERAL",peripheral:i})},[]),c=kw.useCallback(()=>{Q({type:"CLOSE_ADD_PERIPHERAL"})},[]),h=kw.useCallback(async(i)=>{if(B.isCreating||!B.selectedPlatform)return;Q({type:"SET_CREATING",isCreating:!0});let d=Array.isArray(i)?i:[],l=[...B.peripherals,...B.customPeripherals],CA=d.map((SA)=>l.find((XA)=>XA.id===SA.id)).filter(Boolean).filter((SA)=>!nd(SA));try{if(B.pendingProject&&I){for(let SA of CA)await TO(w,B.pendingProject.id,SA.id);z9(process.cwd(),I.id,B.pendingProject.id),C(B.pendingProject)}else if(!B.pendingProject)await E(B.generatedName,B.selectedPlatform.id,CA.map((SA)=>SA.id))}finally{Q({type:"SET_CREATING",isCreating:!1})}},[B.isCreating,B.selectedPlatform,B.peripherals,B.customPeripherals,B.pendingProject,B.generatedName,I,w,C,E]),V=kw.useMemo(()=>({id:"add-platform",name:"Add a platform",description:"Create a custom platform with documentation"}),[]),T=kw.useMemo(()=>({id:"add-peripheral",name:"Add a peripheral",description:"Create a custom peripheral with documentation"}),[]),k=kw.useMemo(()=>[...B.peripherals,...B.customPeripherals].map(M4B),[B.peripherals,B.customPeripherals]),q=kw.useMemo(()=>({name:"Platform",meta:"Manufacturer"}),[]),s=kw.useMemo(()=>({name:"Peripheral",meta:"Manufacturer"}),[]),j=kw.useCallback(()=>{if(B.step==="peripheral")Q({type:"RESET_TO_PLATFORM"});else if(B.step==="platform")D("select_project")},[B.step,D]);if(ig({cancel:B.step==="peripheral"||B.step==="platform"?j:void 0},{enabled:B.step==="peripheral"||B.step==="platform"}),B.isAddPlatformOpen)return O.jsxDEV(w4B,{initialName:B.pendingPlatformName,onComplete:R,onCancel:U},void 0,!1,void 0,this);if(B.isAddPeripheralOpen&&B.pendingProject)return O.jsxDEV(M_,{projectId:B.pendingProject.id,initialName:B.pendingPeripheralName,onComplete:J,onCancel:c},void 0,!1,void 0,this);if(B.step==="platform"||B.step==="peripheral"){let i=B.step==="platform",d=i?"Select Platform":"Select Peripherals",l=i?B.platforms.map(M4B):k,e=i?H:h,CA=i?q:s;if(B.isCreating)return O.jsxDEV(RC,{children:O.jsxDEV("box",{flexDirection:"row",alignItems:"center",children:[O.jsxDEV("spinner",{name:"dots"},void 0,!1,void 0,this),O.jsxDEV("text",{fg:A.text,children:" Creating project..."},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this);return O.jsxDEV(Wx,{items:l,onConfirm:e,onCancel:j,multiSelect:!i,placeholder:"Search...",isLoading:B.catalogLoading,error:B.catalogError||g,emptyActionItem:i?V:T,onEmptyAction:i?L:Y,header:CA,title:d,allowSpaces:i},B.step,!1,void 0,this)}return null}var kw,FrQ;var F4B=z(async()=>{qO();rw();oL();zU();b9();hO();CB();await pQ([VL(),xW(),qE(),mD(),y0A(),D4B(),gK()]);kw=iA(AQ(),1),FrQ={step:"platform",generatedName:"",isCreating:!1,selectedPlatform:null,platforms:[],peripherals:[],catalogLoading:!1,catalogError:null,isAddPlatformOpen:!1,pendingPlatformName:"",isAddPeripheralOpen:!1,pendingPeripheralName:"",customPeripherals:[],pendingProject:null}});function L4B({message:A}){let B=WB();return O.jsxDEV(RC,{children:[O.jsxDEV("text",{attributes:jA.BOLD,fg:B.error,children:"Error"},void 0,!1,void 0,this),O.jsxDEV("box",{marginTop:1,children:O.jsxDEV("text",{fg:B.text,children:A},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)}var U4B=z(async()=>{CB();await pQ([yE(),VL(),qE()])});function G4B({message:A}){let B=WB();return O.jsxDEV(RC,{children:O.jsxDEV("box",{flexDirection:"row",alignItems:"center",children:[O.jsxDEV("spinner",{name:"dots"},void 0,!1,void 0,this),O.jsxDEV("text",{fg:B.text,children:[" ",A]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this)}var R4B=z(async()=>{CB();await pQ([VL(),qE(),gK()])});var bwg,q0A=50000,W0A=30000,H_=120000;

// === Module: a4B (offset: 0xc61ad1, 5,305 chars) ===
var a4B=z(()=>{zI=iA(AQ(),1)});function zx({children:A,focused:B=!0,isStreaming:Q=!1,autoScroll:E=!0,height:g,width:C,flexGrow:I}){let w=l4B.useMemo(()=>new bS,[]),{pendingPermission:D}=BN(),H=WB(),{scrollBoxRef:L,userScrolled:R,handleScrollUp:U,handleScrollDown:G,forceScrollToBottom:Y}=u4B({working:Q});return tw((J)=>{if(!B||!L.current)return;let c=L.current;if(J.name==="up"&&!J.ctrl&&!J.meta)c.scrollBy(-3),U();else if(J.name==="down"&&!J.ctrl&&!J.meta)c.scrollBy(3),G();else if(J.name==="pageup"||J.name==="b"&&J.ctrl)c.scrollBy(-20),U();else if(J.name==="pagedown"||J.name==="f"&&J.ctrl&&!D)c.scrollBy(20),G();else if(J.name==="g"&&J.shift&&J.ctrl)c.scrollTo(c.scrollHeight),Y();else if(J.name==="g"&&J.ctrl)c.scrollTo(0),U()}),O.jsxDEV("scrollbox",{ref:L,scrollY:!0,stickyScroll:E&&!R,stickyStart:"bottom",height:g,width:C,flexGrow:I,scrollAcceleration:w,verticalScrollbarOptions:{trackOptions:{backgroundColor:"transparent",foregroundColor:H.border}},children:A},void 0,!1,void 0,this)}var l4B;var OW=z(async()=>{a4B();CB();await pQ([yE(),Tw(),qE(),wW()]);l4B=iA(AQ(),1)});function $4B(){let A=WB();return O.jsxDEV("box",{flexDirection:"row",justifyContent:"center",marginTop:1,marginBottom:1,children:O.jsxDEV("text",{fg:A.accent,children:"\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 conversation compressed \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501"},void 0,!1,void 0,this)},void 0,!1,void 0,this)}function m4B(A){return"displayOnly"in A&&A.displayOnly===!0}function trQ(){let A=WB(),{selectedProject:B}=xw(),{apiFetch:Q}=Tg(),[E,g]=RG.useState([]),C=RG.useMemo(()=>MN[Math.floor(Math.random()*MN.length)],[]);RG.useEffect(()=>{if(!B?.id||!Q)return;$R(B.id,Q).then(g)},[B?.id,Q]);let I=B?.name??"No project",w=E.find((G)=>G.type==="platform"),D=E.filter((G)=>G.type==="peripheral"),H=3,L=D.slice(0,H),R=D.length-H,U=D.length===0?"None":L.map((G)=>G.name).join(", ")+(R>0?` & ${R} more`:"");return O.jsxDEV("box",{flexDirection:"column",justifyContent:"center",alignItems:"center",flexGrow:1,children:O.jsxDEV("box",{flexDirection:"column",children:[O.jsxDEV("text",{fg:A.textMuted,attributes:jA.DIM,children:I},void 0,!1,void 0,this),O.jsxDEV("text",{fg:A.textMuted,attributes:jA.DIM,children:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"},void 0,!1,void 0,this),O.jsxDEV("text",{fg:A.textMuted,attributes:jA.DIM,children:["Platform: ",w?.name??"None"]},void 0,!0,void 0,this),O.jsxDEV("text",{fg:A.textMuted,attributes:jA.DIM,children:["Peripherals: ",U]},void 0,!0,void 0,this),O.jsxDEV("box",{marginTop:1,children:O.jsxDEV("text",{fg:A.textMuted,attributes:jA.DIM,children:["Try: ",C]},void 0,!0,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this)}function n4B({messages:A,isStreaming:B}){let{current:Q}=AK(),E=Q==="commands",[g,C]=RG.useState(!0);tw((R)=>{if(R.name==="o"&&(R.ctrl||R.meta))C((U)=>!U)});let I=RG.useMemo(()=>A.filter((R)=>!(("hidden"in R)&&R.hidden)&&!(("summary"in R)&&R.summary)),[A]),w=RG.useMemo(()=>{return I.some((R)=>R.role==="tool-group"&&R.toolGroup.tools.some((U)=>U.status==="confirming"))},[I]),D=RG.useMemo(()=>{for(let R=I.length-1;R>=0;R--)if(I[R]?.role==="tool-group")return R;return-1},[I]),H=RG.useMemo(()=>{let R=new Set;for(let U=0;U<I.length-1;U++){let G=I[U],Y=I[U+1];if(G&&Y&&m4B(G)&&!m4B(Y))R.add(U)}return R},[I]);if(I.length===0)return O.jsxDEV(trQ,{},void 0,!1,void 0,this);return O.jsxDEV(zx,{focused:!E&&!w,isStreaming:B,autoScroll:!0,flexGrow:1,children:O.jsxDEV("box",{flexDirection:"column",paddingLeft:2,paddingRight:2,children:I.map((R,U)=>{let Y=U===I.length-1&&B,J=H.has(U);if(R.role==="tool-group"){let c=R,V=!c.toolGroup.tools.some((k)=>k.status==="executing"||k.status==="pending"||k.status==="confirming")&&g,T=U===D;return O.jsxDEV("box",{flexDirection:"column",children:[O.jsxDEV("box",{alignSelf:"flex-start",children:O.jsxDEV(b0A,{toolGroup:c.toolGroup,collapsed:V,showHint:T},void 0,!1,void 0,this)},void 0,!1,void 0,this),J&&O.jsxDEV($4B,{},void 0,!1,void 0,this)]},R.id,!0,void 0,this)}return O.jsxDEV("box",{flexDirection:"column",children:[O.jsxDEV(_4B,{message:R,isStreaming:R.role==="assistant"?Y:!1,collapsed:g},void 0,!1,void 0,this),J&&O.jsxDEV($4B,{},void 0,!1,void 0,this)]},R.id,!0,void 0,this)})},void 0,!1,void 0,this)},void 0,!1,void 0,this)}var RG;var p4B=z(async()=>{rw();q4();oL();CG();CB();await pQ([yE(),Tw(),c4B(),qE(),U_(),t4B(),OW()]);RG=iA(AQ(),1)});function G_({onConfirm:A,onClose:B,textareaRef:Q}){let[E,g]=jx.useState(!1),C=jx.useCallback(()=>{if(E)return;g(!0),A({reply:"once"}),B?.()},[E,A,B]),I=jx.useCallback(()=>{if(E)return;g(!0),A({reply:"always"}),B?.()},[E,A,B]),w=jx.useCallback(()=>{if(E)return;g(!0),A({reply:"reject"}),B?.()},[E,A,B]),D=jx.useCallback(()=>{if(!Q.current||E)return;let L=Q.current.editBuffer.getText().trim();if(!L)return;g(!0),A({reply:"reject",alternativeMessage:L}),B?.()},[E,A,B,Q]),H=jx.useCallback((L,R)=>{if(L===0)C();else if(L===1)I();else if(L===2)R("text")},[C,I]);return{hasResponded:E,handleAllowOnce:C,handleAllowAlways:I,handleReject:w,handleAlternativeSubmit:D,handleSelectAction:H}}var jx;

// === Module: _yB (offset: 0xc8c3eb, 1,440 chars) ===
var _yB=z(()=>{go();MDE={async copy(A){try{await AH("termux-clipboard-set",A)}catch(B){Au(B)}},async paste(A){try{let{stdout:B}=await AH("termux-clipboard-get",A);return B}catch(B){Au(B)}},copySync(A){try{BH("termux-clipboard-set",A)}catch(B){Au(B)}},pasteSync(A){try{return BH("termux-clipboard-get",A).stdout}catch(B){Au(B)}}},dyB=MDE});import HDE from"fs";import $yB from"path";import{fileURLToPath as FDE}from"url";var LDE,myB="xsel",SKA,xKA,tyB,uyB,UDE=(A)=>/Can't open display|Inappropriate ioctl/i.test(A.stderr??""),Bu=(A,B)=>{let Q;if(A.code==="ENOENT"){if(Q="Couldn't find the `xsel` binary and fallback didn't work. On Debian/Ubuntu you can install xsel with: sudo apt install xsel",!xKA)Q+="\nThe bundled `xsel` fallback was not found. This can happen when running in a bundled environment (e.g. Node.js SEA)."}else if(UDE(A))Q="Clipboard access requires a display server (X11 or Wayland). This doesn't work in headless environments like CI servers, Docker containers, or SSH sessions without X11 forwarding.";else Q="Both xsel and fallback failed";let E=Error(Q);if(A.code!=="ENOENT")E.xselError=A;if(B)E.fallbackError=B;return E},ayB=async(A,B)=>{try{let{stdout:Q}=await AH(myB,A,B);return Q}catch(Q){if(!xKA)throw Bu(Q);try{let{stdout:E}=await AH(SKA,A,B);return E}catch(E){throw Bu(Q,E)}}},lyB=(A,B)=>{try{return BH(myB,A,B).stdout}catch(Q){if(!xKA)throw Bu(Q);try{return BH(SKA,A,B).stdout}catch(E){throw Bu(Q,E)}}},GDE,Co;

// === Module: FVB (offset: 0xc8d494, 1,007 chars) ===
var FVB=z(()=>{kDE=fDE(cDE.execFile),DVB=["-NoProfile","-NonInteractive","-ExecutionPolicy","Bypass","-EncodedCommand"];Io.argumentsPrefix=DVB;Io.encodeCommand=MVB;Io.escapeArgument=oDE;Io.createArguments=HVB});import hDE from"fs";import xVB from"path";import{fileURLToPath as XDE}from"url";var PDE,ODE,cKA,fVB,LVB,UVB,GVB=async(A,B)=>{try{return await A()}catch{if(!fVB)throw Error("PowerShell clipboard operation failed and the bundled fallback binary was not found. This can happen when running in a bundled environment (e.g. Node.js SEA).");return B()}},RVB=(A,B)=>{try{return A()}catch{if(!fVB)throw Error("PowerShell clipboard operation failed and the bundled fallback binary was not found. This can happen when running in a bundled environment (e.g. Node.js SEA).");return B()}},KVB=(A,B)=>AH(gu(),Io.createArguments(A),{windowsHide:!0,...B}),YVB=(A,B)=>BH(gu(),Io.createArguments(A),{windowsHide:!0,...B}),JVB=(A,B)=>AH(cKA,A,{windowsHide:!0,...B}),SVB=(A,B)=>BH(cKA,A,{windowsHide:!0,...B}),NDE,Qz;

// === Module: Mu (offset: 0xc9be98, 1,010 chars) ===
var Mu=z(()=>{ZN();FZB=new Set(["readFile","listDirectory","grep","glob","todoRead","documentSearch","codeSearch","webSearch","webFetch","submitPlan","askQuestion","writeFile","editFile","lsp","serialReadHistory","delegateSubagent"])});async function VKA(A){let B=Object.fromEntries(Object.entries(uJ).filter(([E])=>A.includes(E))),Q=await Promise.all(Object.entries(B).map(async([E,g])=>{if(g.metadata.isAvailable)return await g.metadata.isAvailable()?[E,g]:null;return[E,g]}));return Object.fromEntries(Q.filter(Boolean))}var UZB=z(async()=>{await gz()});async function Hu(A,B){let Q=Iz.get(A)??Promise.resolve(),E=Iz.has(A);if(E)fA.trace("File lock: waiting for lock",{filepath:A,hasActiveLock:!0});let g=Date.now(),C=()=>{},I=new Promise((D)=>{C=D}),w=Q.then(()=>I);if(Iz.set(A,w),await Q,E){let D=Date.now()-g;fA.trace("File lock: acquired lock after wait",{filepath:A,waitTimeMs:D})}try{return await B()}finally{if(C(),Iz.get(A)===w)Iz.delete(A),fA.trace("File lock: released lock",{filepath:A})}}var Iz;

// === Module: i6B (offset: 0xcb1959, 4,097 chars) ===
var i6B=z(()=>{EH=iA(AQ(),1)});import{exec as XHE}from"child_process";import{mkdir as PHE,readdir as OHE,rm as NHE,rmdir as THE,unlink as s6B,writeFile as yHE}from"fs/promises";import{homedir as VHE}from"os";import{dirname as nKA,join as ZHE,relative as Yu}from"path";import{promisify as qHE}from"util";async function b6B(A,B){let Q=nKA(A);while(Q!==B&&Q!==nKA(Q))try{if((await OHE(Q)).length===0)await THE(Q),Q=nKA(Q);else break}catch{break}}class pKA{gitDir;workTree;initialized=!1;trackedFiles=new Set;constructor(A=process.cwd()){this.workTree=A,this.gitDir=ZHE(VHE(),".embedder","snapshots",vRB(A))}registerFile(A){fA.debug("Registering file for tracking",{file:A}),this.trackedFiles.add(A)}isFileTracked(A){return this.trackedFiles.has(A)}getTrackedFiles(){return Array.from(this.trackedFiles)}setTrackedFiles(A){this.trackedFiles=new Set(A)}clearTrackedFiles(){this.trackedFiles.clear()}async initialize(){if(this.initialized)return;try{await PHE(this.gitDir,{recursive:!0});try{await GK(`git --git-dir="${this.gitDir}" rev-parse --git-dir`),this.initialized=!0;return}catch{}await GK("git init",{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}}),this.initialized=!0}catch(A){throw this.initialized=!1,fA.error("Failed to initialize snapshot service",{error:A}),A}}async track(){if(!this.initialized)await this.initialize();try{if(this.trackedFiles.size===0)return WHE;for(let Q of this.trackedFiles)try{let E=Yu(this.workTree,Q);await GK(`git add "${E}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}})}catch(E){fA.debug("Failed to track file",{file:Q,error:E})}let{stdout:A}=await GK("git write-tree",{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}});return A.trim()}catch(A){return fA.error("Failed to create snapshot",{error:A}),null}}async patch(A){if(!this.initialized)await this.initialize();try{for(let Q of this.trackedFiles)try{let E=Yu(this.workTree,Q);await GK(`git add "${E}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}})}catch(E){fA.debug("Failed to add file to index",{file:Q,error:E})}let B=[];for(let Q of this.trackedFiles)try{let E=Yu(this.workTree,Q),{stdout:g}=await GK(`git diff --name-only "${A}" -- "${E}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}});if(g.trim())B.push(Q)}catch(E){fA.debug("Failed to check diff for file",{file:Q,error:E})}return{hash:A,files:B}}catch(B){return fA.error("Failed to get patch",{error:B}),{hash:A,files:[]}}}async revert(A){if(!this.initialized)await this.initialize();let B=new Set;try{for(let Q of A)for(let E of Q.files){if(B.has(E))continue;let g=Yu(this.workTree,E);try{await GK(`git checkout "${Q.hash}" -- "${g}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}}),B.add(E)}catch{try{if(!(await GK(`git ls-tree "${Q.hash}" -- "${g}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}})).stdout?.trim())try{await s6B(E),await b6B(E,this.workTree)}catch{}else try{let{stdout:I}=await GK(`git show "${Q.hash}:${g}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}});await yHE(E,I)}catch(I){fA.warn("Failed to restore file",{file:E,error:I})}}catch{try{await s6B(E),await b6B(E,this.workTree)}catch{}}B.add(E)}}}catch(Q){throw fA.error("Failed to revert",{error:Q}),Q}}async diff(A,B){if(!this.initialized)await this.initialize();try{let Q=B||"HEAD",{stdout:E}=await GK(`git diff --stat "${A}" "${Q}"`,{cwd:this.workTree,env:{...process.env,GIT_DIR:this.gitDir,GIT_WORK_TREE:this.workTree}}),g=E.trim().split(`
`),C=g[g.length-1];if(!C)return{added:0,deleted:0};let I=C.match(/(\d+)\s+insertions?\(\+\)/),w=C.match(/(\d+)\s+deletions?\(-\)/);return{added:I?.[1]?parseInt(I[1],10):0,deleted:w?.[1]?parseInt(w[1],10):0}}catch{return{added:0,deleted:0}}}async cleanup(){try{await NHE(this.gitDir,{recursive:!0,force:!0}),this.initialized=!1}catch{}}}var GK,WHE="4b825dc642cb6eb9a060e54bf8d69288fbee4904";

// === Module: d6B (offset: 0xcb295a, 998 chars) ===
var d6B=z(()=>{ZE();oO();GK=qHE(XHE)});function _6B(){let A=SG.useRef(null),B=SG.useRef(null);SG.useEffect(()=>{return(async()=>{if(!A.current)try{let I=new pKA(process.cwd());await I.initialize(),A.current=I,yB.getState().setSnapshotService(I)}catch{fA.warn("Failed to initialize snapshot service")}})(),()=>{yB.getState().setSnapshotService(null)}},[]);let Q=SG.useCallback(async()=>{if(!A.current)return null;try{let C=await A.current.track();return B.current=C,C}catch{return fA.warn("Failed to create snapshot"),null}},[]),E=SG.useCallback(async(C)=>{if(!A.current)return null;try{let I=await A.current.patch(C);if(I.files.length>0){let w=await A.current.track();return B.current=w,{...I,afterHash:w||void 0}}return null}catch{return fA.warn("Failed to calculate patch"),null}},[]),g=SG.useCallback(()=>{A.current?.clearTrackedFiles(),B.current=null},[]);return SG.useMemo(()=>({snapshotServiceRef:A,currentSnapshotRef:B,createSnapshot:Q,calculatePatch:E,clearTrackedFiles:g}),[Q,E,g])}var SG;

// === Module: t6B (offset: 0xcb2d40, 18,387 chars) ===
var t6B=z(()=>{fw();ZE();d6B();SG=iA(AQ(),1)});function zHE(A){if(A&&typeof A==="object"){let B=A;if(B.name==="AI_APICallError"){if(B.statusCode===403)try{return JSON.parse(B.responseBody??"{}").error==="Session already ended"}catch{return!1}if(B.statusCode===401)return!0}}return!1}function jHE(A){if(A&&typeof A==="object"){let B=A;if(B.name==="AI_APICallError"){let E=B.statusCode??0;if(E===429)return!0;if(E>=500&&E<600)return!0}let Q=B.message?.toLowerCase()??"";if(Q.includes("timeout")||Q.includes("network"))return!0}return!1}function a6B(A={}){let{onError:B,maxSteps:Q=32}=A,{languageModel:E,selectedModel:g,isReady:C,waitForHeaders:I}=jU(),{mode:w}=bH(),{updateStream:D,clearAll:H,restoreStreams:L}=IN(),{selectedProject:R}=xw(),{selectedTeam:U}=ew(),{apiFetch:G}=Tg(),{refreshSession:Y,sessionId:J,sessionSlug:c,sessionCreatedAt:h}=hL(),{call:V}=Xx(),[T,k]=EE.useState([]),[q,s]=EE.useState(!1),[j,i]=EE.useState(null),d=EE.useRef(T),l=EE.useRef(!1),e=EE.useRef(C),CA=EE.useRef(E),SA=EE.useRef(g),XA=EE.useRef(J),KA=EE.useRef(w),m=EE.useRef(null),u=EE.useRef(null),IA=EE.useRef([]),kA=EE.useRef(null),QA=EE.useRef(""),WA=EE.useRef(null),bA=EE.useRef(null),FA=EE.useRef(0),a=EE.useRef(null),wA=EE.useRef([]),GA=EE.useRef(new Map),MA=EE.useRef(null),TA=EE.useRef(null),OA=EE.useRef(null),oB=EE.useRef(!1),aA=EE.useRef(!1),BB=EE.useRef(null),{snapshotServiceRef:wB,currentSnapshotRef:EA,createSnapshot:JA,calculatePatch:r,clearTrackedFiles:UA}=_6B(),{conversationId:LA,setConversationId:qA,conversationIdRef:mA,scheduleSave:LB,flushConversation:tB,resumeConversation:WQ,clearSaveTimeout:WE}=z6B({projectId:R?.id,teamId:U?.id,onConversationSaved:()=>V("refreshConversationCount")}),{queuedCount:Bw,enqueue:TC,clearQueue:Zg,processNext:hB,removeLast:YA}=v6B();EE.useEffect(()=>{e.current=C,CA.current=E,SA.current=g},[C,E,g]),EE.useEffect(()=>{XA.current=J},[J]),EE.useEffect(()=>{d.current=T},[T]),EE.useEffect(()=>{l.current=q},[q]),EE.useEffect(()=>{return()=>{if(kA.current)clearTimeout(kA.current);WE()}},[WE]),EE.useEffect(()=>{return yB.getState().setToolStatusUpdateHandler((JB,kB)=>{let OB=GA.current.get(JB);if(OB)k(($Q)=>$Q.map((xE)=>{if(xE.id===OB&&xE.role==="tool-group")return X6B(xE,JB,kB);return xE}))}),()=>{yB.getState().setToolStatusUpdateHandler(null)}},[]);let dA=EE.useCallback(()=>{i(null)},[]),IB=EE.useCallback(()=>{k([]),d.current=[],qA(null),mA.current=null,H(),UA()},[H,UA,qA,mA]),SB=EE.useCallback((JB)=>{let kB={id:$D(),role:"user",content:JB,timestamp:Date.now(),hidden:!0};k((OB)=>[...OB,kB])},[]);EE.useEffect(()=>{return yB.getState().setMessageInjectionHandler(SB),()=>{yB.getState().setMessageInjectionHandler(null)}},[SB]),EE.useEffect(()=>{if(w==="plan"&&KA.current==="act"&&c&&h&&R)(async()=>{let kB=process.cwd(),OB=aU(kB,c,h);await HZB(kB);let $Q=await Bun.file(OB).exists(),xE=sZB(OB,$Q);SB(xE)})();KA.current=w},[w,c,h,R,SB]),EE.useEffect(()=>{let JB=async(kB)=>{let OB=CA.current,$Q=mA.current;if(!OB||!$Q)return{success:!1,originalTokenCount:0,newTokenCount:0,error:"Language model or session not available"};fA.debug("Manual compaction triggered",{reason:kB});let xE=await vN(d.current,$Q,OB);if(xE.success)k(xE.compressedMessages);return xE};return yB.getState().setCompressHandler(JB),()=>{yB.getState().setCompressHandler(null)}},[]);let YQ=EE.useCallback(async(JB)=>{let kB=await WQ(JB);if(!kB)return!1;k(kB.messages);let OB=[];for(let $Q of kB.messages)if($Q.role==="tool-group"){for(let xE of $Q.toolGroup.tools)if(xE.result)OB.push({toolCallId:xE.toolCallId,toolName:xE.toolName,output:`${JSON.stringify(xE.args)}
${xE.result.llmContent||""}`})}return L(OB),eg.track.conversationResume({conversationId:JB,messageCount:kB.messages.length,agentMode:w}),!0},[WQ,L,w]),UQ=EE.useCallback(async()=>{await tB(d.current,CA.current)},[tB]),rB=EE.useCallback(()=>{let JB=u.current,kB=IA.current;if(m.current)m.current.abort(),m.current=null;if(kB.length>0)k((OB)=>OB.filter(($Q)=>!kB.includes($Q.id)));return Zg(),u.current=null,IA.current=[],s(!1),JB},[Zg]),n=EE.useCallback(()=>{if(m.current)m.current.abort(),m.current=null;if(kA.current)clearTimeout(kA.current),kA.current=null;if(WA.current&&QA.current){let JB=WA.current,kB=QA.current;k((OB)=>OB.map(($Q)=>$Q.id===JB?{...$Q,content:kB,isStreaming:!1}:$Q))}Zg(),u.current=null,IA.current=[],bA.current=null,QA.current="",WA.current=null,s(!1)},[Zg]),PA=EE.useCallback(async()=>{let JB=rB(),kB=EA.current;if(kB&&wB.current)try{let OB=await wB.current.patch(kB);if(OB.files.length>0){await wB.current.revert([OB]),fA.debug("Reverted partial changes from cancelled generation",{filesReverted:OB.files.length});let $Q=await wB.current.track();EA.current=$Q}}catch(OB){fA.error("Failed to revert partial changes",{error:OB})}return JB},[rB]);EE.useEffect(()=>{return yB.getState().setStopStreamHandler(n),()=>{yB.getState().setStopStreamHandler(null)}},[n]);let pA=EE.useCallback(async(JB,kB,OB=!1,$Q=0)=>{if(!OB)aA.current=!1,BB.current=null;let xE=e.current,Pg=CA.current;if(!xE||!Pg){let mE=Error("AI is not ready. Please wait for initialization.");fA.error("AI not ready"),i(mE),B?.(mE);return}if(OB){let mE=new Set(IA.current.filter((yC)=>yC!==bA.current));if(mE.size>0)k((yC)=>yC.filter((fE)=>!mE.has(fE.id)))}let iI=await bVB(JB),hQ=iI.expandedContent!==void 0&&iI.mentionedPaths.length>0,$E=kB?.displayContent??iI.displayMessage,bC=hQ?iI.processedMessage:JB,AC;if(OB){let mE=d.current.find((yC)=>yC.id===bA.current);if(!mE)throw Error("Cannot retry: original user message not found");AC=mE}else AC={id:$D(),role:"user",content:$E,timestamp:Date.now(),hidden:kB?.hidden,collapsedForm:kB?.collapsedForm,expandedContent:kB?.expandedContent};let dC=(hQ||kB?.displayContent!=null&&kB.displayContent!==JB)&&!OB?{id:$D(),role:"user",content:bC,timestamp:Date.now(),hidden:!0}:null,Qw=$D();if(u.current=bC,!OB){let mE=[AC.id,Qw];if(dC)mE.push(dC.id);IA.current=mE,bA.current=AC.id}else IA.current=[AC.id,Qw];if(QA.current="",WA.current=Qw,a.current=null,!OB)eg.track.prompt({content:$E,contentLength:$E.length,isCommand:$E.startsWith("/"),commandName:$E.startsWith("/")?$E.slice(1).split(/\s+/)[0]:void 0,model:SA.current?.name,provider:SA.current?.provider,hasEmbedderMd:k4()!==null,hasNoDocuments:!1,teamId:U?.id,projectId:R?.id,agentMode:w,fileMentions:iI.mentionedPaths});FA.current=Date.now(),wA.current=[],MA.current=null,TA.current=null,oB.current=!1;let _C=OB?null:await JA();k((mE)=>[...mE,...OB?[]:[AC],...dC?[dC]:[],{id:Qw,role:"assistant",content:"",timestamp:Date.now(),isStreaming:!0}]),s(!0),i(null),H();let QQ=new AbortController;m.current=QQ;let ow=()=>{if(WA.current&&QA.current){let mE=WA.current,yC=QA.current;k((fE)=>fE.map((EI)=>EI.id===mE?{...EI,content:yC}:EI))}},pD=()=>{if(!kA.current)kA.current=setTimeout(()=>{kA.current=null,ow()},16)},zL=()=>{if(kA.current)clearTimeout(kA.current),kA.current=null;if(ow(),WA.current){let mE=WA.current;k((yC)=>yC.map((fE)=>fE.id===mE?{...fE,isStreaming:!1}:fE))}WA.current=null,QA.current=""},sI="";try{let mE=d.current.some((sQ)=>!(("hidden"in sQ)&&sQ.hidden)),yC=[];if(!mE)yC=await wo({projectId:R?.id,apiFetch:G}),k((sQ)=>[...yC,...sQ]);let fE=dC?[AC,dC]:[AC],EI=mE?[...d.current,...fE]:[...yC,...d.current,...fE];if(SA.current&&mA.current&&Pg&&T6B(d.current,bC,SA.current,OA.current)){fA.info("Pre-flight compression triggered");let sQ=await vN(d.current,mA.current,Pg);if(sQ.success){let zE=await wo({projectId:R?.id,apiFetch:G});k([...zE,...sQ.compressedMessages,...fE]),EI=[...zE,...sQ.compressedMessages,...fE]}}let lg=fg.getState().tabs.filter((sQ)=>sQ.connectionState==="connected"&&sQ.activePort&&sQ.outputLines.length-sQ.lastRetrievedIndex>0);if(lg.length>0){let sQ="# Serial Output";for(let nE of lg){let MC=nE.outputLines.length-nE.lastRetrievedIndex,KC=nE.outputLines.slice(nE.lastRetrievedIndex),OE=KC.length>20?[...KC.slice(0,10),`... (${KC.length-20} more) ...`,...KC.slice(-10)]:KC;sQ+=`
## ${nE.activePort} (${MC} lines)
${OE.join(`
`)}`}let zE={id:`serial-status-${$D()}`,role:"user",content:sQ,hidden:!0,timestamp:Date.now()};EI=[...EI,zE]}let hw=V6B(EI),ED=x6B(hw),aH=await S6B(w),jL=Math.min(g?.limits?.output??16384,jN);fA.info("[LLM] Starting request",{model:SA.current?.name,provider:SA.current?.provider,messageCount:ED.length,toolCount:Object.keys(aH).length,maxOutputTokens:jL,mode:w,isRetry:OB});let gH=await sD({name:"llm.request",op:"ai.inference",attributes:{"ai.model":SA.current?.name??"unknown","ai.provider":SA.current?.provider??"unknown","ai.mode":w,"ai.message_count":ED.length,"ai.tool_count":Object.keys(aH).length}},()=>G4({model:Pg,messages:ED,tools:aH,maxOutputTokens:jL,stopWhen:G9(Q),abortSignal:QQ.signal,onError:({error:sQ})=>{if(fA.error("streamText error",{error:sQ}),zHE(sQ)&&!aA.current&&!OB)aA.current=!0,BB.current={content:JB,options:kB},QQ.abort()},providerOptions:{openai:{stream_options:{include_usage:!0}},anthropic:{include_usage:!0},google:{include_usage:!0}}}));for await(let sQ of gH.fullStream){if(sQ.type==="error"){let nE=sQ.error||Error("AI returned an error"),MC=nE instanceof Error?nE.message:nE.message||String(nE);throw Vd(nE,{model:SA.current?.name,provider:SA.current?.provider,sessionId:XA.current??void 0,errorType:"chunk"}),Error(MC)}if(sQ.type==="text-delta"){if(a.current===null)a.current=Date.now();if(QA.current+=sQ.text,!WA.current){let zE=$D();WA.current=zE,IA.current.push(zE),k((nE)=>[...nE,{id:zE,role:"assistant",content:QA.current,timestamp:Date.now(),isStreaming:!0}])}else pD()}else if(sQ.type==="tool-call"){if(!QA.current&&WA.current){let KC=WA.current;k((OE)=>OE.filter((hD)=>hD.id!==KC)),IA.current=IA.current.filter((OE)=>OE!==KC),WA.current=null}zL();let zE="input"in sQ?sQ.input:{};D(sQ.toolCallId,sQ.toolName,JSON.stringify(zE)),wA.current.push({toolCallId:sQ.toolCallId,toolName:sQ.toolName});let nE=c6B({toolCallId:sQ.toolCallId,toolName:sQ.toolName,args:zE}),MC=$D();GA.current.set(sQ.toolCallId,MC),IA.current.push(MC),k((KC)=>[...KC,{id:MC,role:"tool-group",toolGroup:nE,timestamp:Date.now()}])}else if(sQ.type==="tool-result"){let zE="input"in sQ?sQ.input:{},nE="output"in sQ?sQ.output:sQ,MC={toolCallId:sQ.toolCallId,toolName:sQ.toolName,args:zE,result:nE},KC=JSON.stringify(MC.args),OE=typeof MC.result==="object"?MC.result.llmContent||"":String(MC.result);D(MC.toolCallId,MC.toolName,`${KC}
${OE}`);let hD=GA.current.get(sQ.toolCallId);if(hD)k((Ew)=>Ew.map((gw)=>{if(gw.id===hD&&gw.role==="tool-group")return k6B(gw,MC);return gw})),GA.current.delete(sQ.toolCallId);else{let Ew=f6B(MC),gw=$D(),CH={id:gw,role:"tool-group",toolGroup:Ew,timestamp:Date.now()};IA.current.push(gw),k((AA)=>[...AA,CH])}}else if(sQ.type==="tool-error"){let zE=sQ;Vd(zE.error,{model:SA.current?.name,provider:SA.current?.provider,sessionId:XA.current??void 0,errorType:"tool"});let nE=GA.current.get(zE.toolCallId);if(nE){let MC=zE.error instanceof Error?zE.error.message:String(zE.error);k((KC)=>KC.map((OE)=>{if(OE.id===nE&&OE.role==="tool-group")return o6B(OE,zE.toolCallId,MC);return OE})),GA.current.delete(zE.toolCallId)}}else if(sQ.type==="finish-step"){let zE=sQ,nE=zE.usage;if(nE){let MC=nE.cachedInputTokens??nE.inputTokenDetails?.cacheReadTokens??zE.providerMetadata?.anthropic?.cacheReadInputTokens??0,KC=nE.inputTokenDetails?.cacheWriteTokens??zE.providerMetadata?.anthropic?.cacheCreationInputTokens??0,OE=nE.inputTokens??0,hD=nE.outputTokens??0,Ew={input:OE,output:hD,reasoning:nE.outputTokenDetails?.reasoningTokens??0,cache:{read:MC,write:KC}};if(OA.current=Ew,SA.current){let gw=N6B({tokens:Ew,model:SA.current});if(gw.exceedsThreshold||gw.overflow)oB.current=!0}}}else if(sQ.type==="finish"){let zE=sQ;if(fA.info("Stream finished",{finishReason:zE.finishReason,toolCallsInResponse:wA.current.length,hasContent:!!QA.current.trim()}),MA.current=zE.finishReason,OA.current)TA.current=OA.current;else if(zE.totalUsage)TA.current={input:zE.totalUsage.inputTokens??0,output:zE.totalUsage.outputTokens??0,reasoning:zE.totalUsage.reasoningTokens??0,cache:{read:zE.totalUsage.cachedInputTokens??0,write:0}}}}sI=QA.current;let oD=!!sI.trim()||wA.current.length>0;if(fA.info("Stream processing complete",{finishReason:MA.current,hadContent:oD,toolCallCount:wA.current.length,contentLength:sI.length,needsCompaction:oB.current}),zL(),MA.current==="length"&&wA.current.length===0)fA.error("Response cut off due to output token limit",{finishReason:MA.current,maxOutputTokens:Math.min(g?.limits?.output??16384,jN)});if(MA.current==="content_filter"||MA.current==="refusal")throw Error("The AI declined to respond to this request due to content policy.");if(!oD){if(QQ.signal.aborted)return;throw Error("The AI returned an empty response. This may be due to content policy restrictions.")}}catch(mE){if(BB.current&&!OB){let qg=BB.current;BB.current=null;try{fA.info("Session ended, refreshing session and retrying");let lg=await Y();if(lg){if(!await I(lg,5000))throw Error("Timeout waiting for session headers to update");await pA(qg.content,qg.options,!0);return}}catch(lg){fA.error("Failed to refresh session",{error:lg})}}if(mE instanceof Error&&mE.name==="AbortError")return;let yC=mE instanceof Error?mE.message:String(mE);if((yC.includes("prompt is too long")||yC.includes("maximum context length"))&&!aA.current&&mA.current&&CA.current){fA.warn("Prompt too long, compressing and retrying"),aA.current=!0;let qg=await vN(d.current,mA.current,CA.current);if(qg.success){let lg=await wo({projectId:R?.id,apiFetch:G});k([...lg,...qg.compressedMessages]),await pA(JB,kB,!0);return}}let fE=mE instanceof Error?mE:Error(String(mE));if(jHE(mE)&&$Q<3){let qg=1000*2**$Q;if(WA.current){let lg=WA.current;k((hw)=>hw.map((ED)=>ED.id===lg?{...ED,content:"Thinking...",isStreaming:!0}:ED))}await new Promise((lg)=>setTimeout(lg,qg)),await pA(JB,kB,!0,$Q+1);return}i(fE),B?.(fE),Vd(fE,{model:SA.current?.name,provider:SA.current?.provider,sessionId:XA.current??void 0,errorType:"stream"});let EI=WA.current||Qw;k((qg)=>qg.map((lg)=>lg.id===EI?{...lg,content:fE.message,isStreaming:!1}:lg))}finally{if(fA.info("Turn cleanup started",{finishReason:MA.current,pendingToolCalls:GA.current.size,hasTokenUsage:!!TA.current,needsCompaction:oB.current,wasAborted:m.current?.signal.aborted??!1}),kA.current)clearTimeout(kA.current),kA.current=null;if(GA.current.size>0){let fE=new Set(GA.current.values());k((EI)=>EI.map((qg)=>{if(fE.has(qg.id)&&qg.role==="tool-group")return h6B(qg);return qg})),GA.current.clear()}let mE=Date.now()-FA.current;if(TA.current&&Qw){let fE=TA.current;k((EI)=>EI.map((qg)=>{if(qg.id===Qw&&qg.role==="assistant")return{...qg,tokens:fE};return qg}))}if(sI||wA.current.length>0){if(eg.track.assistantResponse({content:sI,contentLength:sI.length,model:SA.current?.name??"unknown",provider:SA.current?.provider??"unknown",agentMode:w,toolCalls:wA.current.length>0?wA.current:void 0,isContinuation:!1,durationMs:mE,tokens:TA.current?{input:TA.current.input,output:TA.current.output}:void 0}),a.current!==null)eg.track.responseLatency({timeToFirstTokenMs:a.current-FA.current,totalResponseMs:mE,model:SA.current?.name??"unknown",provider:SA.current?.provider??"unknown",agentMode:w})}if(_C&&EA.current&&bA.current){let fE=await r(_C);if(fE){let EI=bA.current;k((qg)=>qg.map((lg)=>{if(lg.id===EI&&lg.role==="user"){let hw=lg.patch,ED=hw?Array.isArray(hw)?[...hw,fE]:[hw,fE]:fE;return{...lg,patch:ED}}return lg}))}}if(oB.current&&CA.current&&mA.current){fA.info("Auto-compaction triggered (post-stream)");let fE=await vN(d.current,mA.current,CA.current);if(fE.success){fA.info("Compaction complete",{before:fE.originalTokenCount,after:fE.newTokenCount});let EI=await wo({projectId:R?.id,apiFetch:G});k([...EI,...fE.compressedMessages])}else fA.warn("Compaction failed",{error:fE.error})}if(u.current=null,IA.current=[],bA.current=null,QA.current="",WA.current=null,s(!1),m.current=null,LB(d.current),yB.getState().initInProgress)yB.getState().setInitInProgress(!1),yB.getState().autoApprovalHandler?.(!1);fA.info("Turn completed",{finishReason:MA.current,compactionRan:oB.current});let yC=hB();if(yC)fA.info("Processing queued message"),setTimeout(()=>{pA(yC.content,yC.options)},0)}},[w,Q,D,H,B,LB,R,U,G,JA,r,EA,hB,g?.limits?.output]),DB=EE.useCallback(async(JB,kB)=>{if(l.current){TC(JB,kB);return}await pA(JB,kB)},[pA,TC]),TB=EE.useCallback((JB)=>{return async(kB)=>{n(),await new Promise((xE)=>setTimeout(xE,u6B));let{content:OB,options:$Q}=JB(kB);await pA(OB,$Q)}},[n,pA]);EE.useEffect(()=>{let JB=TB(($Q)=>({content:`You can now edit files, Execute this plan:

${$Q}`,options:{hidden:!0}}));yB.getState().setPlanExecutionHandler(JB);let kB=TB(($Q)=>({content:$Q}));yB.getState().setRedirectPromptHandler(kB);let OB=async($Q,xE)=>{n(),await new Promise((Pg)=>setTimeout(Pg,u6B)),await pA($Q,{displayContent:xE})};return yB.getState().setInitPromptHandler(OB),()=>{yB.getState().setPlanExecutionHandler(null),yB.getState().setRedirectPromptHandler(null),yB.getState().setInitPromptHandler(null)}},[TB,n,pA]);let eB=EE.useCallback((JB,kB)=>{let OB=JB==="bash"?"Shell":"Serial",$Q=JB==="bash"?`! ${kB.command}`:`~ ${kB.command}`,xE={id:$D(),role:"user",content:$Q,timestamp:Date.now()},Pg;if(kB.success){if(Pg=`${OB} command executed:
\`\`\`
${kB.output}
\`\`\``,kB.exitCode!==void 0&&kB.exitCode!==0)Pg+=`

Exit code: ${kB.exitCode}`}else if(Pg=`${OB} command failed: ${kB.error??"Unknown error"}`,kB.output)Pg+=`
\`\`\`
${kB.output}
\`\`\``;let iI={id:$D(),role:"assistant",content:Pg,timestamp:Date.now(),bashExecution:JB==="bash"?{command:kB.command,exitCode:kB.exitCode,success:kB.success}:void 0};k((hQ)=>[...hQ,xE,iI])},[]);return{messages:T,isStreaming:q,error:j,queuedCount:Bw,conversationId:LA,sendMessage:DB,cancelStream:rB,stopStream:n,cancelAndRevertStream:PA,clearMessages:IB,setMessages:k,clearError:dA,clearQueue:Zg,removeLast:YA,resumeConversation:YQ,flushConversation:UQ,logDirectExecution:eB}}var EE,u6B=50;var l6B=z(async()=>{JM();R9();rw();WO();oL();qJ();zU();HW();nR();CG();dVB();fw();ZE();ZN();f4();Ku();bKA();wC();j6B();i6B();t6B();await pQ([hx(),ZJ(),OKA(),P6B(),v4(),gz()]);EE=iA(AQ(),1)});function $6B({initialWidth:A,minWidth:B,maxWidth:Q}){let[E,g]=$x.useState(A),[C,I]=$x.useState(!1),[w,D]=$x.useState(!1),H=$x.useCallback(()=>{I(!0)},[]),L=$x.useCallback(()=>{I(!1)},[]),R=$x.useCallback((G,Y)=>{let J=Math.max(B,Math.min(Q,Y-G));g(J)},[B,Q]);return{width:Math.max(B,Math.min(Q,E)),isResizing:C,isHovered:w,setWidth:g,handleResizeStart:H,handleResizeEnd:L,handleResizeDrag:R,setIsHovered:D}}var $x;

// === Module: m6B (offset: 0xcb7513, 1,737 chars) ===
var m6B=z(()=>{$x=iA(AQ(),1)});function n6B({messages:A,setMessages:B,clearMessages:Q}){let E=Ho.useMemo(()=>{let w=[],D=0;for(let H of A)if(H.role==="user"){let L=H;if(L.hidden)continue;let R=L.content,U=R.length>80?`${R.substring(0,77)}...`:R,G=L.patch,Y=0;if(G){let J=Array.isArray(G)?G:[G],c=new Set;for(let h of J)for(let V of h.files)c.add(V);Y=c.size}w.push({messageId:`msg-${D}`,userPrompt:U,fullContent:R,collapsedForm:L.collapsedForm,expandedContent:L.expandedContent,timestamp:L.timestamp,filesChanged:Y,patch:G}),D++}return w.reverse()},[A]),g=Ho.useMemo(()=>{return E.some((w)=>w.filesChanged>0)},[E]),C=Ho.useCallback(async(w)=>{let D=yB.getState().snapshotService;if(!D)return fA.error("Snapshot service not initialized"),null;try{let H=parseInt(w.messageId.replace("msg-",""),10),L=[],R=0;for(let c of A)if(c.role==="user"){let h=c;if(h.hidden)continue;if(R>=H){if(h.patch){let V=Array.isArray(h.patch)?h.patch:[h.patch];L.push(...V)}}R++}if(L.length>0)await D.revert(L);let U=0,G=0;for(let c=0;c<A.length;c++){let h=A[c];if(h?.role==="user"){if(h.hidden)continue;if(G===H){U=c;break}G++}}let Y=H===0?A.length:A.length-U;if(U===0&&H>0)return fA.warn("Failed to find message index for rewind",{messageIndex:H}),null;if(H===0)Q();else B(A.slice(0,U));if(await D.track())fA.debug("Created new snapshot after revert");return eg.track.rewind({messageId:w.messageId,filesReverted:w.filesChanged,messagesRemoved:Y,trigger:"ui"}),w.expandedContent??w.fullContent}catch(H){return fA.error("Failed to revert",{error:H}),null}},[A,B,Q]),I=Ho.useCallback(async()=>{if(E.length===0)return null;let w=E[0];if(!w)return null;return C(w)},[E,C]);return Ho.useMemo(()=>({rewindEntries:E,hasChanges:g,revertTo:C,undo:I}),[E,g,C,I])}var Ho;

// === Module: lqB (offset: 0xcb9b98, 4,368 chars) ===
var lqB=_((gYA)=>{Object.defineProperty(gYA,"__esModule",{value:!0});Object.defineProperty(gYA,"LoremIpsum",{enumerable:!0,get:function(){return uqB.default}});gYA.loremIpsum=void 0;var TFE=rKA(),Fo=HqB(),yFE=eKA(),uqB=VFE(tqB());function VFE(A){return A&&A.__esModule?A:{default:A}}var ZFE=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Q=B.count,E=Q===void 0?1:Q,g=B.format,C=g===void 0?TFE.FORMAT_PLAIN:g,I=B.paragraphLowerBound,w=I===void 0?3:I,D=B.paragraphUpperBound,H=D===void 0?7:D,L=B.random,R=B.sentenceLowerBound,U=R===void 0?5:R,G=B.sentenceUpperBound,Y=G===void 0?15:G,J=B.units,c=J===void 0?Fo.UNIT_SENTENCES:J,h=B.words,V=h===void 0?yFE.WORDS:h,T=B.suffix,k=T===void 0?"":T,q={random:L,sentencesPerParagraph:{max:H,min:w},words:V,wordsPerSentence:{max:Y,min:U}},s=new uqB.default(q,C,k);switch(c){case Fo.UNIT_PARAGRAPHS:case Fo.UNIT_PARAGRAPH:return s.generateParagraphs(E);case Fo.UNIT_SENTENCES:case Fo.UNIT_SENTENCE:return s.generateSentences(E);case Fo.UNIT_WORDS:case Fo.UNIT_WORD:return s.generateWords(E);default:return""}};gYA.loremIpsum=ZFE});function zF(A,B){return Math.floor(Math.random()*(B-A+1))+A}function $J(A){return A[Math.floor(Math.random()*A.length)]}function vFE(){let A=zF(3,5),B=[];for(let Q=0;Q<A;Q++)if(B.push(`- ${OM.generateSentences(1)}`),Math.random()>0.7){if(B.push(`  - ${OM.generateSentences(1)}`),Math.random()>0.5)B.push(`  - ${OM.generateSentences(1)}`)}return B.join(`
`)}function iFE(){let A=zF(3,5),B=[];for(let Q=0;Q<A;Q++)B.push(`${Q+1}. ${OM.generateSentences(1)}`);return B.join(`
`)}function nqB(){let A=OM.generateWords(zF(10,25)).split(" "),B=[];for(let Q=0;Q<A.length;Q++){let E=A[Q],g=Math.random();if(g>0.95&&E)B.push(`**${E}**`);else if(g>0.9&&E)B.push(`*${E}*`);else if(g>0.85&&E)B.push(`\`${E}\``);else if(g>0.8&&E)B.push(`[${E}](https://embedder.com)`);else B.push(E??"")}return`${B.join(" ")}.`}function sFE(){let A=[],B=zF(2,4);for(let Q=0;Q<B;Q++){let E=Math.random();if(E>0.85){let g=$J(rqB);A.push(`\`\`\`${g.lang}
${g.code}
\`\`\``)}else if(E>0.75)A.push($J(jFE));else if(E>0.6)A.push(vFE());else if(E>0.5)A.push(iFE());else if(E>0.35){let g=`## ${OM.generateWords(zF(2,4))}`;A.push(`${g}

${nqB()}`)}else A.push(nqB())}return A.join(`

`)}function bFE(A,B,Q,E="success"){let g=eqB++;return{id:`tool-${g}`,toolCallId:`call-${g}`,toolName:A,displayName:B,status:E,args:{path:`src/${OM.generateWords(1)}.c`},result:{success:E==="success",llmContent:Q,returnDisplay:Q,summary:Q},startTime:Date.now()-1000,endTime:Date.now()}}function dFE(A){return{id:`group-${eqB++}`,status:"completed",tools:A,startTime:Date.now()-2000,endTime:Date.now()}}function _FE(){let A=$J(zFE),B=Math.random()>0.85,Q=B?"error":"success",E=B?`Error: ${OM.generateSentences(1)}`:OM.generateSentences(1);return dFE([bFE(A.name,A.display,E,Q)])}function tFE(){let A=Math.random();if(A>0.9)return OM.generateWords(zF(1,3));else if(A>0.8){let B=$J(rqB);return`${OM.generateSentences(1)}

\`\`\`${B.lang}
${B.code}
\`\`\``}else if(A>0.6)return OM.generateSentences(zF(2,4));else return OM.generateSentences(1)}function uFE(){let A=Math.random();if(A>0.9)return`${OM.generateWords(zF(2,5))}.`;else if(A>0.7)return sFE();else if(A>0.4)return OM.generateParagraphs(zF(1,2));else return OM.generateSentences(zF(2,4))}function A1B(){let A=Date.now(),B=[],Q=zF(5,10),E=A-Q*1e4;for(let g=0;g<Q;g++){if(B.push({id:`msg-${E}`,role:"user",content:tFE(),timestamp:E}),E+=1000,Math.random()>0.4){let C=Math.random()>0.7?zF(2,8):1;for(let I=0;I<C;I++)B.push({id:`msg-${E}`,role:"tool-group",toolGroup:_FE(),timestamp:E}),E+=100}B.push({id:`msg-${E}`,role:"assistant",content:uFE(),timestamp:E}),E+=1000}return B}function B1B(){let A=[],B=zF(50,150);A.push("--- Serial Monitor Started ---"),A.push("Connected to /dev/ttyUSB0 at 115200 baud"),A.push("");for(let Q of mqB.slice(0,zF(3,6)))A.push(`[INFO] ${Q}`);A.push("");for(let Q=0;Q<B;Q++){let E=Math.random();if(E>0.95)A.push($J(WFE));else if(E>0.7){let g=$J($qB);A.push(g())}else if(E>0.5){let g=$J(qFE);A.push(`${g} ${OM.generateSentences(1)}`)}else if(E>0.3){let g=$J($qB);A.push(g())}else if(E>0.1)A.push(`[DEBUG] 0x${Math.floor(Math.random()*65535).toString(16).padStart(4,"0")}: ${Array.from({length:8},()=>Math.floor(Math.random()*256).toString(16).padStart(2,"0")).join(" ")}`);else A.push($J(mqB))}return A}var pqB,OM,qFE,$qB,mqB,WFE,zFE,rqB,jFE,eqB=0;
