// Category: context
// Modules: 5
// Total size: 17,517 chars


// === Module: PBB (offset: 0x1db6a6, 3,385 chars) ===
var PBB=z(()=>{wJ=iA(_B(),1),DJ=iA(XE(),1),PU=iA(yg(),1)});function OBB(A,B,Q,E,g){let C=()=>{},I=()=>{},w=g.functions?.errorHook,D=g.functions?.requestHook,H=g.functions?.responseHook;if(typeof H==="function")I=(U,G)=>{MJ.safeExecuteInTheMiddle(()=>H(U,G),(Y)=>{if(!Y)return;xR.diag.error(Y?.message)},!0)};if(typeof D==="function")C=(U)=>{MJ.safeExecuteInTheMiddle(()=>D(U),(G)=>{if(!G)return;xR.diag.error(G?.message)},!0)};let L=new MJ.InstrumentationNodeModuleDefinition("firebase-functions",B);return[{name:"firebase-functions/lib/v2/providers/https.js",triggerType:"function"},{name:"firebase-functions/lib/v2/providers/firestore.js",triggerType:"firestore"},{name:"firebase-functions/lib/v2/providers/scheduler.js",triggerType:"scheduler"},{name:"firebase-functions/lib/v2/storage.js",triggerType:"storage"}].forEach(({name:U,triggerType:G})=>{L.files.push(new MJ.InstrumentationNodeModuleFile(U,B,(Y)=>OhQ(Y,Q,E,A,{requestHook:C,responseHook:I,errorHook:w},G),(Y)=>NBB(Y,E)))}),L}function ZH(A,B,Q){return function(g){return function(...C){let I=typeof C[0]==="function"?C[0]:C[1],w=typeof C[0]==="function"?void 0:C[0];if(!I)return g.call(this,...C);let D=async function(...H){let L=process.env.FUNCTION_TARGET||process.env.K_SERVICE||"unknown",R=A.startSpan(`firebase.function.${Q}`,{kind:xR.SpanKind.SERVER}),U={"faas.name":L,"faas.trigger":Q,"faas.provider":"firebase"};if(process.env.GCLOUD_PROJECT)U["cloud.project_id"]=process.env.GCLOUD_PROJECT;if(process.env.EVENTARC_CLOUD_EVENT_SOURCE)U["cloud.event_source"]=process.env.EVENTARC_CLOUD_EVENT_SOURCE;return R.setAttributes(U),B?.requestHook?.(R),xR.context.with(xR.trace.setSpan(xR.context.active(),R),async()=>{let G,Y;try{Y=await I.apply(this,H)}catch(J){G=J}if(B?.responseHook?.(R,G),G)R.recordException(G);if(R.end(),G)throw await B?.errorHook?.(R,G),G;return Y})};if(w)return g.call(this,w,D);else return g.call(this,D)}}}function OhQ(A,B,Q,E,g,C){switch(NBB(A,Q),C){case"function":B(A,"onRequest",ZH(E,g,"http.request")),B(A,"onCall",ZH(E,g,"http.call"));break;case"firestore":B(A,"onDocumentCreated",ZH(E,g,"firestore.document.created")),B(A,"onDocumentUpdated",ZH(E,g,"firestore.document.updated")),B(A,"onDocumentDeleted",ZH(E,g,"firestore.document.deleted")),B(A,"onDocumentWritten",ZH(E,g,"firestore.document.written")),B(A,"onDocumentCreatedWithAuthContext",ZH(E,g,"firestore.document.created")),B(A,"onDocumentUpdatedWithAuthContext",ZH(E,g,"firestore.document.updated")),B(A,"onDocumentDeletedWithAuthContext",ZH(E,g,"firestore.document.deleted")),B(A,"onDocumentWrittenWithAuthContext",ZH(E,g,"firestore.document.written"));break;case"scheduler":B(A,"onSchedule",ZH(E,g,"scheduler.scheduled"));break;case"storage":B(A,"onObjectFinalized",ZH(E,g,"storage.object.finalized")),B(A,"onObjectArchived",ZH(E,g,"storage.object.archived")),B(A,"onObjectDeleted",ZH(E,g,"storage.object.deleted")),B(A,"onObjectMetadataUpdated",ZH(E,g,"storage.object.metadataUpdated"));break}return A}function NBB(A,B){let Q=["onSchedule","onRequest","onCall","onObjectFinalized","onObjectArchived","onObjectDeleted","onObjectMetadataUpdated","onDocumentCreated","onDocumentUpdated","onDocumentDeleted","onDocumentWritten","onDocumentCreatedWithAuthContext","onDocumentUpdatedWithAuthContext","onDocumentDeletedWithAuthContext","onDocumentWrittenWithAuthContext"];for(let E of Q)if(MJ.isWrapped(A[E]))B(A,E);return A}var xR,MJ;

// === Module: SJB (offset: 0xb9b35d, 3,299 chars) ===
var SJB=z(()=>{KJB=["brave","calm","clever","cosmic","crisp","curious","eager","gentle","glowing","happy","hidden","jolly","kind","lucky","mighty","misty","neon","nimble","playful","proud","quick","quiet","shiny","silent","stellar","sunny","swift","tidy","witty"],YJB=["cabin","cactus","canyon","circuit","comet","eagle","engine","falcon","forest","garden","harbor","island","knight","lagoon","meadow","moon","mountain","nebula","orchid","otter","panda","pixel","planet","river","rocket","sailor","squid","star","tiger","wizard","wolf"]});function fJB(){return yB.getState().sessionCleanupCallback}async function qtQ(){return await NO()?"versioned":"unversioned"}function WtQ(){if(process.env.SANDBOX==="sandbox-exec")return"exec";if(process.env.SANDBOX!=null)return"generic";return"none"}function cJB({children:A}){let[B,Q]=eI.useState(null),[E,g]=eI.useState(null),[C,I]=eI.useState(null),[w,D]=eI.useState(!1),{isAuthenticated:H,apiFetch:L,getToken:R}=Tg(),{user:U}=ox(),{selectedTeam:G}=ew(),{selectedProject:Y}=xw(),[J,c]=eI.useState("unversioned"),[h]=eI.useState(WtQ);eI.useEffect(()=>{qtQ().then(c)},[]);let V=eI.useCallback(async(j=!1)=>{if(!H||!Y)return null;if(!j)D(!0);try{let i=B;if(i)try{await L.delete(`api/v1/sessions/${i}`)}catch(SA){fA.warn("Failed to cleanup old session",{error:SA,sessionId:i})}I(null),g(null);let l=(await L.post("api/v1/sessions")).id,e=Date.now(),CA=JJB();return Q(l),g(CA),I(e),TI("session_id",l),await GJB.getState().syncRemoteContext(Y.id,L),l}catch(i){return fA.error("Failed to create session",{error:i}),cO(i,{operation:"session_create",component:"SessionContext",metadata:{projectId:Y?.id}}),null}finally{if(!j)D(!1)}},[H,Y,B,L]),[T,k]=eI.useState(null);eI.useEffect(()=>{if(!B||!U||!Y||T===B)return;if(eg.session.start({sessionId:B,userId:U.id,teamId:G?.id,projectId:Y.id,user:{id:U.id,email:U.email,name:U.name},environment:{appVersion:vD,platform:"linux",arch:"x64",nodeVersion:process.version,terminal:SFB(),cwd:process.cwd()}}),w8({id:U.id,email:U.email,username:U.name}),TI("user_id",U.id),TI("project_id",Y.id),TI("agent_mode","act"),G?.id)TI("team_id",G.id);vZ("session",{sessionId:B,projectId:Y.id,projectName:Y.name,teamId:G?.id,folderType:J,sandboxType:h,cwd:process.cwd()}),k4().then((j)=>{eg.track.sessionStarted({hasEmbedderMd:j!==null,initialMode:"act",initialModel:void 0,initialProvider:void 0})}),eg.setAuthTokenGetter(R),k(B)},[B,U,G,Y,R,T,J,h]);let q=eI.useCallback(async()=>{return V(!0)},[V]);eI.useEffect(()=>{if(!H||!Y||B)return;V()},[H,Y,B,V]),eI.useEffect(()=>{eg.session.update({teamId:G?.id,projectId:Y?.id})},[G,Y]),eI.useEffect(()=>{if(!B){yB.getState().setSessionCleanupCallback(null);return}return yB.getState().setSessionCleanupCallback(async()=>{try{eg.track.sessionClosed({}),await eg.flush(),await L.delete(`api/v1/sessions/${B}`)}catch(j){fA.warn("Failed to cleanup session on exit",{error:j,sessionId:B})}}),()=>{yB.getState().setSessionCleanupCallback(null)}},[B,L]);let s=eI.useMemo(()=>({sessionId:B,sessionSlug:E,sessionCreatedAt:C,isCreating:w,folderType:J,sandboxType:h,refreshSession:q}),[B,E,C,w,J,h,q]);return O.jsxDEV(xJB.Provider,{value:s,children:A},void 0,!1,void 0,this)}function hL(){let A=eI.useContext(xJB);if(!A)throw Error("useSession must be used within a SessionProvider");return A}var eI,xJB;

// === Module: qO (offset: 0xb9d527, 667 chars) ===
var qO=z(()=>{JM();rw();B7();oL();qJ();zU();ZO();CB();kM=iA(AQ(),1),PJB=kM.createContext(null)});function TJB({children:A}){let B=XL.useRef(new Map),Q=XL.useCallback((w,D)=>{B.current.set(w,D)},[]),E=XL.useCallback((w)=>{B.current.delete(w)},[]),g=XL.useCallback(async(w,...D)=>{let H=B.current.get(w);if(H)await H(...D)},[]),C=XL.useCallback((w)=>{return B.current.has(w)},[]),I=XL.useMemo(()=>({register:Q,unregister:E,call:g,has:C}),[Q,E,g,C]);return O.jsxDEV(NJB.Provider,{value:I,children:A},void 0,!1,void 0,this)}function Xx(){let A=XL.useContext(NJB);if(!A)throw Error("useCallbackRegistry must be used within a CallbackRegistryProvider");return A}var XL,NJB;

// === Module: W4 (offset: 0xc3492d, 7,955 chars) ===
var W4=z(()=>{CB();qF=iA(AQ(),1),MfB=qF.createContext(null)});function BN(){let A=WI.useContext(LfB);if(!A)throw Error("useToolConfirmation must be used within a ToolContextProvider");return A}function FfB(A){return{id:A.id,permission:A.permission,patterns:A.patterns,toolCallID:A.toolCallID,confirmationDetails:A.confirmationDetails,metadata:A.metadata}}function UfB({children:A}){let{apiFetch:B}=Tg(),{sessionId:Q}=hL(),{selectedProject:E}=xw(),{selectedTeam:g}=ew(),{registry:C,getHeaders:I}=jU(),{mode:w,setMode:D}=bH(),[H,L]=WI.useState(null),[R,U]=WI.useState(!1),G=WI.useRef(!1);WI.useEffect(()=>{G.current=R},[R]),WI.useEffect(()=>{return yB.getState().setModeHandler(D),()=>{yB.getState().setModeHandler(null)}},[D]);let[Y,J]=WI.useState(!1);WI.useEffect(()=>{NO().then(J)},[]);let{sessionSlug:c,sessionCreatedAt:h}=hL();WI.useEffect(()=>{return vxB(()=>({workingDirectory:process.cwd(),projectRoot:process.cwd(),sessionId:Q??void 0,sessionSlug:c??void 0,sessionCreatedAt:h??void 0,teamId:g?.id,projectId:E?.id,apiFetch:B,aiRegistry:C,getAiHeaders:I,mode:w,environmentContext:{platform:"linux",projectType:"unknown",isGitRepository:Y,dateTime:new Date().toISOString()}})),()=>{ixB()}},[Q,c,h,g?.id,E?.id,B,C,Y,I,w]),WI.useEffect(()=>{return HG.subscribe("permission.asked",(j)=>{if(G.current){pO.reply({requestID:j.id,reply:"once"});return}if(j.toolCallID){let i=yB.getState().toolStatusUpdateHandler;i?.(j.toolCallID,"confirming")}L((i)=>{if(i)return i;return FfB(j)})})},[]),WI.useEffect(()=>{return HG.subscribe("permission.replied",(j)=>{if(j.reply==="reject"){if(j.toolCallID){let l=yB.getState().toolStatusUpdateHandler;l?.(j.toolCallID,"cancelled")}yB.getState().stopStreamHandler?.()}let d=pO.list()[0];if(d)L(FfB(d));else L(null)})},[]);let V=WI.useCallback((s,j)=>{pO.reply({requestID:s,reply:j})},[]),T=WI.useCallback(()=>{U((s)=>!s)},[]),k=WI.useCallback((s)=>{U(s)},[]);WI.useEffect(()=>{return yB.getState().setAutoApprovalHandler(k),()=>{yB.getState().setAutoApprovalHandler(null)}},[k]);let q=WI.useMemo(()=>({pendingPermission:H,respondToPermission:V,autoApprovalEnabled:R,toggleAutoApproval:T,setAutoApproval:k}),[H,V,R,T,k]);return O.jsxDEV(LfB.Provider,{value:q,children:A},void 0,!1,void 0,this)}var WI,LfB;var wW=z(async()=>{f7();ad();fw();N7();qI();rw();oL();qJ();zU();CB();await pQ([hx(),ZJ()]);WI=iA(AQ(),1),LfB=WI.createContext(null)});function RfB({children:A}){let{switchMode:B,setMode:Q}=bH(),{setStatus:E}=pR(),{logout:g,apiFetch:C}=Tg(),{availableModels:I,selectedModel:w}=jU(),{current:D}=AK(),{call:H,register:L,unregister:R}=Xx(),{teams:U,selectedTeam:G,clearTeamSelection:Y}=ew(),{selectedProject:J,clearProjectSelection:c}=xw(),{sessionId:h}=hL(),{user:V}=ox(),{toggleAutoApproval:T}=BN(),{themeName:k,availableThemes:q,setTheme:s}=VJ(),{show:j}=BK(),[i,d]=cw.useState(0),[l,e]=cw.useState(0),[CA,SA]=cw.useState(0),[XA,KA]=cw.useState(!0),m=cw.useCallback(()=>{let a=zJ(ZF());SA(a.length)},[]),u=cw.useCallback(()=>{if(!G||!J){d(0);return}W7(J.id,G.id).then((a)=>{d(a.length)})},[G,J]);cw.useEffect(()=>{u(),m()},[u,m]),cw.useEffect(()=>{if(!J){KA(!0);return}$R(J.id,C).then((a)=>{let wA=a.find((GA)=>GA.type==="platform");KA(!!wA)})},[J,C]),cw.useEffect(()=>{return L("refreshConversationCount",u),L("refreshTodoCount",m),L("updateMessageCount",(a)=>e(typeof a==="number"?a:0)),()=>{R("refreshConversationCount"),R("refreshTodoCount"),R("updateMessageCount")}},[L,R,u,m]);let IA=cw.useMemo(()=>mxB({switchMode:B,setMode:Q,setAppStatus:E,logout:g,availableModels:I,selectedModel:w,callCallback:H,teams:U,clearTeamSelection:Y,clearProjectSelection:c,conversationCount:i,messageCount:l,todoCount:CA,toggleAutoApproval:T,selectedProject:J,selectedTeam:G,apiFetch:C,themeName:k,availableThemes:q,setTheme:s,hasPlatform:XA,showToast:j,sessionId:h,userId:V?.id??null}),[B,Q,E,g,I,w,H,U,Y,c,i,l,CA,T,J,G,C,k,q,s,XA,j,h,V?.id]),kA=cw.useCallback((a)=>{let wA=a.toLowerCase();return IA.filter((MA)=>!MA.hidden&&(MA.name.startsWith(wA)||MA.aliases?.some((TA)=>TA.startsWith(wA)))).sort((MA,TA)=>{let OA=MA.name.startsWith(wA),oB=TA.name.startsWith(wA);if(OA&&!oB)return-1;if(!OA&&oB)return 1;return MA.name.localeCompare(TA.name)}).map((MA)=>({label:`/${MA.name}`,value:MA.name,description:MA.argsHint?`<${MA.argsHint}> - ${MA.description}`:MA.description}))},[IA]),QA=cw.useCallback((a)=>{let wA=a.toLowerCase();return IA.find((GA)=>GA.name===wA||GA.aliases?.includes(wA))},[IA]),{mode:WA}=bH(),bA=cw.useCallback(async(a,wA)=>{let GA=QA(a);if(GA)eg.track.commandUsed({commandName:GA.name,args:wA,trigger:"slash",agentMode:WA}),await GA.action(wA)},[QA,WA]);tw((a)=>{let wA=a;for(let GA of IA){if(!GA.shortcut)continue;if(GA.shortcut.requireNoFocus&&D)continue;let MA=wA.name===GA.shortcut.key,TA=!!wA.shift===!!GA.shortcut.shift,OA=!!wA.alt===!!GA.shortcut.alt,oB=GA.shortcut.ctrl||GA.shortcut.meta,aA=wA.ctrl||wA.meta,BB=oB?aA:!wA.ctrl&&!wA.meta;if(MA&&BB&&TA&&OA){eg.track.commandUsed({commandName:GA.name,trigger:"shortcut",agentMode:WA}),GA.action();break}}});let FA=cw.useMemo(()=>({commands:IA,findMatchingCommands:kA,findExactCommand:QA,executeCommand:bA}),[IA,kA,QA,bA]);return O.jsxDEV(GfB.Provider,{value:FA,children:A},void 0,!1,void 0,this)}function z7(){let A=cw.useContext(GfB);if(!A)throw Error("useCommands must be used within a CommandsProvider");return A}var cw,GfB;var j7=z(async()=>{nR();eO();CG();Z4();qO();rw();WO();q4();oL();qJ();zU();W4();ZO();CB();await pQ([Tw(),nxB(),hx(),ZJ(),qE(),wW()]);cw=iA(AQ(),1),GfB=cw.createContext(null)});import{readdir as f$Q}from"fs/promises";import*as YfB from"os";import*as QK from"path";function X$Q(A){let B=YfB.homedir();return QK.resolve(A)===B}function P$Q(A,B,Q=!1){if(A.startsWith(".")&&!A.startsWith(".env"))return!0;if(B){if(Q&&o$Q.has(A))return!0;return k$Q.has(A)}return h$Q.some((E)=>E.test(A))}async function KfB(A,B=eUA){let Q=[],E=[A],g=X$Q(A);while(E.length>0&&Q.length<B){let C=E.shift();if(!C)continue;let I=g&&C===A;try{let w=await f$Q(C,{withFileTypes:!0});w.sort((D,H)=>{if(D.isDirectory()!==H.isDirectory())return D.isDirectory()?-1:1;return D.name.localeCompare(H.name)});for(let D of w){if(Q.length>=B)break;let H=D.isDirectory();if(P$Q(D.name,H,I))continue;let L=QK.join(C,D.name),R=QK.relative(A,L);if(Q.push({path:L,relativePath:R,isDirectory:H}),H)E.push(L)}}catch{}}return Q}function O$Q(A,B){let Q=B.toLowerCase(),E=A.relativePath.toLowerCase();if(QK.basename(A.relativePath).toLowerCase().includes(Q))return!0;if(E.includes(Q))return!0;return!1}function N$Q(A,B){let Q=B.toLowerCase();return A.sort((E,g)=>{let C=QK.basename(E.relativePath).toLowerCase(),I=QK.basename(g.relativePath).toLowerCase(),w=C.startsWith(Q),D=I.startsWith(Q);if(w!==D)return w?-1:1;let H=C===Q;if(H!==(I===Q))return H?-1:1;let R=(E.relativePath.match(/[/\\]/g)||[]).length,U=(g.relativePath.match(/[/\\]/g)||[]).length;if(R!==U)return R-U;if(E.isDirectory!==g.isDirectory)return E.isDirectory?-1:1;return E.relativePath.localeCompare(g.relativePath)})}function SfB({children:A}){let[B,Q]=BD.useState([]),[E,g]=BD.useState(!1),C=BD.useRef(0),I=BD.useRef(process.cwd()),w=BD.useRef(0);BD.useEffect(()=>{w.current=B.length},[B.length]);let D=BD.useCallback(async()=>{let U=Date.now(),G=process.cwd();if(I.current===G&&U-C.current<c$Q&&w.current>0)return;g(!0),I.current=G;try{let Y=await KfB(G,eUA);Q(Y),C.current=Date.now()}catch{Q([])}finally{g(!1)}},[]);BD.useEffect(()=>{D()},[D]);let H=BD.useCallback(async(U)=>{if(B.length===0)await D();let G=B.length>0?B:await KfB(process.cwd(),eUA);if(!U.trim())return G.slice(0,50);let Y=G.filter((c)=>O$Q(c,U));return N$Q(Y,U).slice(0,50)},[B,D]),L=BD.useCallback(async()=>{C.current=0,await D()},[D]),R=BD.useMemo(()=>({files:B,isLoading:E,searchFiles:H,refreshFiles:L}),[B,E,H,L]);return O.jsxDEV(JfB.Provider,{value:R,children:A},void 0,!1,void 0,this)}function xfB(){let A=BD.useContext(JfB);if(!A)throw Error("useFiles must be used within a FilesProvider");return A}var BD,eUA=2000,c$Q=5000,k$Q,o$Q,h$Q,JfB;

// === Module: pfB (offset: 0xc3c4ac, 2,211 chars) ===
var pfB=z(()=>{CB();kI=iA(AQ(),1),e$Q=kI.createContext(null)});function efB(A){if(!A)return 0;let B=4,Q=Math.ceil(A.length/B),E=Math.ceil(Q*0.1);return Q+E}function AcB(A,B){if(!A)return 0;let Q=1,E=0;while(Q<B){let g=A.indexOf(`
`,E);if(g===-1)break;Q++,E=g+1}return Q}function QcB({children:A}){let[B,Q]=QD.useState({}),[E,g]=QD.useState(0),[C,I]=QD.useState(0),w=QD.useCallback((J,c,h)=>{Q((V)=>{let T=AcB(h,rfB),k=efB(h),q=V[J],s=q?.lineCount||0,j=q?.tokenCount||0;if(q&&T===s&&k===j&&q.output===h)return V;let i=T-s,d=k-j;return g((l)=>l+i),I((l)=>l+d),{...V,[J]:{toolCallId:J,toolName:c,output:h,timestamp:Date.now(),lineCount:T,tokenCount:k}}})},[]),D=QD.useCallback((J)=>{Q((c)=>{let h=c[J];if(!h)return c;let{lineCount:V,tokenCount:T}=h;g((s)=>s-V),I((s)=>s-T);let{[J]:k,...q}=c;return q})},[]),H=QD.useCallback(()=>{Q({}),g(0),I(0)},[]),L=QD.useCallback((J)=>{return B[J]},[B]),R=QD.useCallback((J)=>{let c={},h=0,V=0;for(let T of J){let k=AcB(T.output,rfB),q=efB(T.output);c[T.toolCallId]={toolCallId:T.toolCallId,toolName:T.toolName,output:T.output,timestamp:Date.now(),lineCount:k,tokenCount:q},h+=k,V+=q}Q(c),g(h),I(V)},[]),U=QD.useCallback((J,c)=>{Q((h)=>{let V=h[J];if(!V)return h;let k=[...V.nestedToolCalls||[],c].slice(-5);return{...h,[J]:{...V,nestedToolCalls:k}}})},[]),G=QD.useCallback((J,c,h)=>{Q((V)=>{let T=V[J];if(!T?.nestedToolCalls)return V;let k=T.nestedToolCalls.map((q)=>q.toolCallId===c?{...q,...h}:q);return{...V,[J]:{...T,nestedToolCalls:k}}})},[]);QD.useEffect(()=>{return yB.getState().setStreamOutputHandler(w),yB.getState().setNestedToolCallHandler(U),yB.getState().setNestedToolUpdateHandler(G),()=>{yB.getState().setStreamOutputHandler(null),yB.getState().setNestedToolCallHandler(null),yB.getState().setNestedToolUpdateHandler(null)}},[w,U,G]);let Y=QD.useMemo(()=>({streams:B,totalLineCount:E,totalTokenCount:C,updateStream:w,clearStream:D,clearAll:H,getStream:L,restoreStreams:R,addNestedToolCall:U,updateNestedToolCall:G}),[B,E,C,w,D,H,L,R,U,G]);return O.jsxDEV(BcB.Provider,{value:Y,children:A},void 0,!1,void 0,this)}function IN(){let A=QD.useContext(BcB);if(!A)throw Error("useToolStreaming must be used within a ToolStreamingProvider");return A}var QD,rfB=50,BcB;
