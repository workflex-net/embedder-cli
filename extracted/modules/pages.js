// Category: pages
// Modules: 2
// Total size: 67,503 chars


// === Module: XFA (offset: 0xb49f84, 66,043 chars) ===
var XFA=z(()=>{PE();iQ();PE();lQ();lQ();lQ();iQ();lQ();iQ();lQ();iQ();lQ();oFA=Symbol.for(TvQ),cL=class A extends(oUB=Error,kUB=oFA,oUB){constructor({message:B,statusCode:Q=500,cause:E}){super(B);this[kUB]=!0,this.statusCode=Q,this.cause=E}static isInstance(B){return A.hasMarker(B)}static hasMarker(B){return typeof B==="object"&&B!==null&&oFA in B&&B[oFA]===!0}},yvQ=`vercel.ai.gateway.error.${uUB}`,hUB=Symbol.for(yvQ),H9=class A extends(PUB=cL,XUB=hUB,PUB){constructor({message:B="Authentication failed",statusCode:Q=401,cause:E}={}){super({message:B,statusCode:Q,cause:E});this[XUB]=!0,this.name=uUB,this.type="authentication_error"}static isInstance(B){return cL.hasMarker(B)&&hUB in B}static createContextualError({apiKeyProvided:B,oidcTokenProvided:Q,message:E="Authentication failed",statusCode:g=401,cause:C}){let I;if(B)I=`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`;else if(Q)I=`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`;else I=`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`;return new A({message:I,statusCode:g,cause:C})}},VvQ=`vercel.ai.gateway.error.${aUB}`,OUB=Symbol.for(VvQ),ZvQ=class extends(TUB=cL,NUB=OUB,TUB){constructor({message:A="Invalid request",statusCode:B=400,cause:Q}={}){super({message:A,statusCode:B,cause:Q});this[NUB]=!0,this.name=aUB,this.type="invalid_request_error"}static isInstance(A){return cL.hasMarker(A)&&OUB in A}},qvQ=`vercel.ai.gateway.error.${lUB}`,yUB=Symbol.for(qvQ),WvQ=class extends(ZUB=cL,VUB=yUB,ZUB){constructor({message:A="Rate limit exceeded",statusCode:B=429,cause:Q}={}){super({message:A,statusCode:B,cause:Q});this[VUB]=!0,this.name=lUB,this.type="rate_limit_exceeded"}static isInstance(A){return cL.hasMarker(A)&&yUB in A}},zvQ=`vercel.ai.gateway.error.${$UB}`,qUB=Symbol.for(zvQ),jvQ=S.object({modelId:S.string()}),hFA=class extends(zUB=cL,WUB=qUB,zUB){constructor({message:A="Model not found",statusCode:B=404,modelId:Q,cause:E}={}){super({message:A,statusCode:B,cause:E});this[WUB]=!0,this.name=$UB,this.type="model_not_found",this.modelId=Q}static isInstance(A){return cL.hasMarker(A)&&qUB in A}},vvQ=`vercel.ai.gateway.error.${mUB}`,jUB=Symbol.for(vvQ),sUB=class extends(iUB=cL,vUB=jUB,iUB){constructor({message:A="Internal server error",statusCode:B=500,cause:Q}={}){super({message:A,statusCode:B,cause:Q});this[vUB]=!0,this.name=mUB,this.type="internal_server_error"}static isInstance(A){return cL.hasMarker(A)&&jUB in A}},ivQ=`vercel.ai.gateway.error.${nUB}`,bUB=Symbol.for(ivQ),svQ=class extends(_UB=cL,dUB=bUB,_UB){constructor({message:A="Invalid response from Gateway",statusCode:B=502,response:Q,validationError:E,cause:g}={}){super({message:A,statusCode:B,cause:g});this[dUB]=!0,this.name=nUB,this.type="response_error",this.response=Q,this.validationError=E}static isInstance(A){return cL.hasMarker(A)&&bUB in A}};bvQ=S.object({error:S.object({message:S.string(),type:S.string().nullish(),param:S.unknown().nullish(),code:S.union([S.string(),S.number()]).nullish()})});_vQ=S.union([S.literal("api-key"),S.literal("oidc")]),uvQ=S.object({specificationVersion:S.literal("v2"),provider:S.string(),modelId:S.string()}),avQ=S.object({input:S.string(),output:S.string(),input_cache_read:S.string().nullish(),input_cache_write:S.string().nullish()}).transform(({input:A,output:B,input_cache_read:Q,input_cache_write:E})=>({input:A,output:B,...Q?{cachedInputTokens:Q}:{},...E?{cacheCreationInputTokens:E}:{}})),lvQ=S.object({id:S.string(),name:S.string(),description:S.string().nullish(),pricing:avQ.nullish(),specification:uvQ,modelType:S.enum(["language","embedding","image"]).nullish()}),$vQ=S.object({models:S.array(lvQ)}),pvQ=S.object({embeddings:S.array(S.array(S.number())),usage:S.object({tokens:S.number()}).nullish(),providerMetadata:S.record(S.string(),S.record(S.string(),S.unknown())).optional()});AiQ=Symbol.for("@vercel/request-context");eUB=QiQ()});function DiQ(A){switch(A.type){case"unsupported-setting":{let Q=`AI SDK Warning: The "${A.setting}" setting is not supported by this model`;if(A.details)Q+=` - ${A.details}`;return Q}case"unsupported-tool":{let E=`AI SDK Warning: The tool "${"name"in A.tool?A.tool.name:"unknown tool"}" is not supported by this model`;if(A.details)E+=` - ${A.details}`;return E}case"other":return`AI SDK Warning: ${A.message}`;default:return`AI SDK Warning: ${JSON.stringify(A,null,2)}`}}function i0B(A){if(typeof A!=="string"){if(A.specificationVersion!=="v2")throw new yiQ({version:A.specificationVersion,provider:A.provider,modelId:A.modelId});return A}return tiQ().languageModel(A)}function tiQ(){var A;return(A=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?A:eUB}function liQ(A){return typeof A==="string"&&A.startsWith("SUQz")||typeof A!=="string"&&A.length>10&&A[0]===73&&A[1]===68&&A[2]===51?aiQ(A):A}function $iQ({data:A,signatures:B}){let Q=liQ(A),E=typeof Q==="string"?Lx(Q.substring(0,Math.min(Q.length,24))):Q;for(let g of B)if(E.length>=g.bytesPrefix.length&&g.bytesPrefix.every((C,I)=>C===null||E[I]===C))return g.mediaType;return}function riQ(A){try{let[B,Q]=A.split(",");return{mediaType:B.split(";")[0].split(":")[1],base64Content:Q}}catch(B){return{mediaType:void 0,base64Content:void 0}}}function b0B(A){if(A instanceof Uint8Array)return{data:A,mediaType:void 0};if(A instanceof ArrayBuffer)return{data:new Uint8Array(A),mediaType:void 0};if(typeof A==="string")try{A=new URL(A)}catch(B){}if(A instanceof URL&&A.protocol==="data:"){let{mediaType:B,base64Content:Q}=riQ(A.toString());if(B==null||Q==null)throw new vQ({name:"InvalidDataContentError",message:`Invalid data URL format in content ${A.toString()}`});return{data:Q,mediaType:B}}return{data:A,mediaType:void 0}}function eiQ(A){if(typeof A==="string")return A;if(A instanceof ArrayBuffer)return HO(new Uint8Array(A));return HO(A)}async function A5Q({prompt:A,supportedUrls:B,download:Q=piQ()}){let E=await Q5Q(A.messages,Q,B);return[...A.system!=null?[{role:"system",content:A.system}]:[],...A.messages.map((g)=>B5Q({message:g,downloadedAssets:E}))]}function B5Q({message:A,downloadedAssets:B}){let Q=A.role;switch(Q){case"system":return{role:"system",content:A.content,providerOptions:A.providerOptions};case"user":{if(typeof A.content==="string")return{role:"user",content:[{type:"text",text:A.content}],providerOptions:A.providerOptions};return{role:"user",content:A.content.map((E)=>E5Q(E,B)).filter((E)=>E.type!=="text"||E.text!==""),providerOptions:A.providerOptions}}case"assistant":{if(typeof A.content==="string")return{role:"assistant",content:[{type:"text",text:A.content}],providerOptions:A.providerOptions};return{role:"assistant",content:A.content.filter((E)=>E.type!=="text"||E.text!==""||E.providerOptions!=null).map((E)=>{let g=E.providerOptions;switch(E.type){case"file":{let{data:C,mediaType:I}=b0B(E.data);return{type:"file",data:C,filename:E.filename,mediaType:I!=null?I:E.mediaType,providerOptions:g}}case"reasoning":return{type:"reasoning",text:E.text,providerOptions:g};case"text":return{type:"text",text:E.text,providerOptions:g};case"tool-call":return{type:"tool-call",toolCallId:E.toolCallId,toolName:E.toolName,input:E.input,providerExecuted:E.providerExecuted,providerOptions:g};case"tool-result":return{type:"tool-result",toolCallId:E.toolCallId,toolName:E.toolName,output:E.output,providerOptions:g}}}),providerOptions:A.providerOptions}}case"tool":return{role:"tool",content:A.content.map((E)=>({type:"tool-result",toolCallId:E.toolCallId,toolName:E.toolName,output:E.output,providerOptions:E.providerOptions})),providerOptions:A.providerOptions};default:throw new jiQ({role:Q})}}async function Q5Q(A,B,Q){let E=A.filter((C)=>C.role==="user").map((C)=>C.content).filter((C)=>Array.isArray(C)).flat().filter((C)=>C.type==="image"||C.type==="file").map((C)=>{var I;let w=(I=C.mediaType)!=null?I:C.type==="image"?"image/*":void 0,D=C.type==="image"?C.image:C.data;if(typeof D==="string")try{D=new URL(D)}catch(H){}return{mediaType:w,data:D}}).filter((C)=>C.data instanceof URL).map((C)=>({url:C.data,isUrlSupportedByModel:C.mediaType!=null&&TLB({url:C.data.toString(),mediaType:C.mediaType,supportedUrls:Q})})),g=await B(E);return Object.fromEntries(g.filter((C)=>(C==null?void 0:C.data)!=null).map(({data:C,mediaType:I},w)=>[E[w].url.toString(),{data:C,mediaType:I}]))}function E5Q(A,B){var Q;if(A.type==="text")return{type:"text",text:A.text,providerOptions:A.providerOptions};let E,g=A.type;switch(g){case"image":E=A.image;break;case"file":E=A.data;break;default:throw Error(`Unsupported part type: ${g}`)}let{data:C,mediaType:I}=b0B(E),w=I!=null?I:A.mediaType,D=C;if(D instanceof URL){let H=B[D.toString()];if(H)D=H.data,w!=null||(w=H.mediaType)}switch(g){case"image":{if(D instanceof Uint8Array||typeof D==="string")w=(Q=$iQ({data:D,signatures:uiQ}))!=null?Q:w;return{type:"file",mediaType:w!=null?w:"image/*",filename:void 0,data:D,providerOptions:A.providerOptions}}case"file":{if(w==null)throw Error("Media type is missing for file part");return{type:"file",mediaType:w,filename:A.filename,data:D,providerOptions:A.providerOptions}}}}function g5Q({maxOutputTokens:A,temperature:B,topP:Q,topK:E,presencePenalty:g,frequencyPenalty:C,seed:I,stopSequences:w}){if(A!=null){if(!Number.isInteger(A))throw new sR({parameter:"maxOutputTokens",value:A,message:"maxOutputTokens must be an integer"});if(A<1)throw new sR({parameter:"maxOutputTokens",value:A,message:"maxOutputTokens must be >= 1"})}if(B!=null){if(typeof B!=="number")throw new sR({parameter:"temperature",value:B,message:"temperature must be a number"})}if(Q!=null){if(typeof Q!=="number")throw new sR({parameter:"topP",value:Q,message:"topP must be a number"})}if(E!=null){if(typeof E!=="number")throw new sR({parameter:"topK",value:E,message:"topK must be a number"})}if(g!=null){if(typeof g!=="number")throw new sR({parameter:"presencePenalty",value:g,message:"presencePenalty must be a number"})}if(C!=null){if(typeof C!=="number")throw new sR({parameter:"frequencyPenalty",value:C,message:"frequencyPenalty must be a number"})}if(I!=null){if(!Number.isInteger(I))throw new sR({parameter:"seed",value:I,message:"seed must be an integer"})}return{maxOutputTokens:A,temperature:B,topP:Q,topK:E,presencePenalty:g,frequencyPenalty:C,stopSequences:w,seed:I}}function C5Q(A){return A!=null&&Object.keys(A).length>0}function I5Q({tools:A,toolChoice:B,activeTools:Q}){if(!C5Q(A))return{tools:void 0,toolChoice:void 0};return{tools:(Q!=null?Object.entries(A).filter(([g])=>Q.includes(g)):Object.entries(A)).map(([g,C])=>{let I=C.type;switch(I){case void 0:case"dynamic":case"function":return{type:"function",name:g,description:C.description,inputSchema:U4(C.inputSchema).jsonSchema,providerOptions:C.providerOptions};case"provider-defined":return{type:"provider-defined",name:g,id:C.id,args:C.args};default:throw Error(`Unsupported tool type: ${I}`)}}),toolChoice:B==null?{type:"auto"}:typeof B==="string"?{type:B}:{type:"tool",toolName:B.toolName}}}async function K5Q(A){if(A.prompt==null&&A.messages==null)throw new KJ({prompt:A,message:"prompt or messages must be defined"});if(A.prompt!=null&&A.messages!=null)throw new KJ({prompt:A,message:"prompt and messages cannot be defined at the same time"});if(A.system!=null&&typeof A.system!=="string")throw new KJ({prompt:A,message:"system must be a string"});let B;if(A.prompt!=null&&typeof A.prompt==="string")B=[{role:"user",content:A.prompt}];else if(A.prompt!=null&&Array.isArray(A.prompt))B=A.prompt;else if(A.messages!=null)B=A.messages;else throw new KJ({prompt:A,message:"prompt or messages must be defined"});if(B.length===0)throw new KJ({prompt:A,message:"messages must not be empty"});let Q=await oJ({value:B,schema:S.array(R5Q)});if(!Q.success)throw new KJ({prompt:A,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:Q.error});return{messages:B,system:A.system}}function Y5Q(A){if(H9.isInstance(A)||hFA.isInstance(A))return new vQ({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:A});return A}function yFA({operationId:A,telemetry:B}){return{"operation.name":`${A}${(B==null?void 0:B.functionId)!=null?` ${B.functionId}`:""}`,"resource.name":B==null?void 0:B.functionId,"ai.operationId":A,"ai.telemetry.functionId":B==null?void 0:B.functionId}}function J5Q({model:A,settings:B,telemetry:Q,headers:E}){var g;return{"ai.model.provider":A.provider,"ai.model.id":A.modelId,...Object.entries(B).reduce((C,[I,w])=>{return C[`ai.settings.${I}`]=w,C},{}),...Object.entries((g=Q==null?void 0:Q.metadata)!=null?g:{}).reduce((C,[I,w])=>{return C[`ai.telemetry.metadata.${I}`]=w,C},{}),...Object.entries(E!=null?E:{}).reduce((C,[I,w])=>{if(w!==void 0)C[`ai.request.headers.${I}`]=w;return C},{})}}function f5Q({isEnabled:A=!1,tracer:B}={}){if(!A)return S5Q;if(B)return B;return u0B.trace.getTracer("ai")}function ZFA({name:A,tracer:B,attributes:Q,fn:E,endWhenDone:g=!0}){return B.startActiveSpan(A,{attributes:Q},async(C)=>{try{let I=await E(C);if(g)C.end();return I}catch(I){try{a0B(C,I)}finally{C.end()}throw I}})}function a0B(A,B){if(B instanceof Error)A.recordException({name:B.name,message:B.message,stack:B.stack}),A.setStatus({code:VFA.SpanStatusCode.ERROR,message:B.message});else A.setStatus({code:VFA.SpanStatusCode.ERROR})}function FO({telemetry:A,attributes:B}){if((A==null?void 0:A.isEnabled)!==!0)return{};return Object.entries(B).reduce((Q,[E,g])=>{if(g==null)return Q;if(typeof g==="object"&&"input"in g&&typeof g.input==="function"){if((A==null?void 0:A.recordInputs)===!1)return Q;let C=g.input();return C==null?Q:{...Q,[E]:C}}if(typeof g==="object"&&"output"in g&&typeof g.output==="function"){if((A==null?void 0:A.recordOutputs)===!1)return Q;let C=g.output();return C==null?Q:{...Q,[E]:C}}return{...Q,[E]:g}},{})}function c5Q(A){return JSON.stringify(A.map((B)=>({...B,content:typeof B.content==="string"?B.content:B.content.map((Q)=>Q.type==="file"?{...Q,data:Q.data instanceof Uint8Array?eiQ(Q.data):Q.data}:Q)})))}function k5Q(A,B){return{inputTokens:F9(A.inputTokens,B.inputTokens),outputTokens:F9(A.outputTokens,B.outputTokens),totalTokens:F9(A.totalTokens,B.totalTokens),reasoningTokens:F9(A.reasoningTokens,B.reasoningTokens),cachedInputTokens:F9(A.cachedInputTokens,B.cachedInputTokens)}}function F9(A,B){return A==null&&B==null?void 0:(A!=null?A:0)+(B!=null?B:0)}function qFA(A){return A===void 0?[]:Array.isArray(A)?A:[A]}function o5Q({error:A,exponentialBackoffDelay:B}){let Q=A.responseHeaders;if(!Q)return B;let E,g=Q["retry-after-ms"];if(g){let I=parseFloat(g);if(!Number.isNaN(I))E=I}let C=Q["retry-after"];if(C&&E===void 0){let I=parseFloat(C);if(!Number.isNaN(I))E=I*1000;else E=Date.parse(C)-Date.now()}if(E!=null&&!Number.isNaN(E)&&0<=E&&(E<60000||E<B))return E;return B}async function l0B(A,{maxRetries:B,delayInMs:Q,backoffFactor:E,abortSignal:g},C=[]){try{return await A()}catch(I){if(cJ(I))throw I;if(B===0)throw I;let w=Q9(I),D=[...C,I],H=D.length;if(H>B)throw new Q0B({message:`Failed after ${H} attempts. Last error: ${w}`,reason:"maxRetriesExceeded",errors:D});if(I instanceof Error&&cI.isInstance(I)&&I.isRetryable===!0&&H<=B)return await XLB(o5Q({error:I,exponentialBackoffDelay:Q}),{abortSignal:g}),l0B(A,{maxRetries:B,delayInMs:E*Q,backoffFactor:E,abortSignal:g},D);if(H===1)throw I;throw new Q0B({message:`Failed after ${H} attempts with non-retryable error: '${w}'`,reason:"errorNotRetryable",errors:D})}}function X5Q({maxRetries:A,abortSignal:B}){if(A!=null){if(!Number.isInteger(A))throw new sR({parameter:"maxRetries",value:A,message:"maxRetries must be an integer"});if(A<0)throw new sR({parameter:"maxRetries",value:A,message:"maxRetries must be >= 0"})}let Q=A!=null?A:2;return{maxRetries:Q,retry:h5Q({maxRetries:Q,abortSignal:B})}}async function N5Q({toolCall:A,tools:B,repairToolCall:Q,system:E,messages:g}){try{if(B==null)throw new TFA({toolName:A.toolName});try{return await E0B({toolCall:A,tools:B})}catch(C){if(Q==null||!(TFA.isInstance(C)||Y0B.isInstance(C)))throw C;let I=null;try{I=await Q({toolCall:A,tools:B,inputSchema:({toolName:w})=>{let{inputSchema:D}=B[w];return U4(D).jsonSchema},system:E,messages:g,error:C})}catch(w){throw new TiQ({cause:w,originalError:C})}if(I==null)throw C;return await E0B({toolCall:I,tools:B})}}catch(C){let I=await jR({text:A.input}),w=I.success?I.value:A.input;return{type:"tool-call",toolCallId:A.toolCallId,toolName:A.toolName,input:w,dynamic:!0,invalid:!0,error:C}}}async function E0B({toolCall:A,tools:B}){let Q=A.toolName,E=B[Q];if(E==null)throw new TFA({toolName:A.toolName,availableTools:Object.keys(B)});let g=U4(E.inputSchema),C=A.input.trim()===""?await oJ({value:{},schema:g}):await jR({text:A.input,schema:g});if(C.success===!1)throw new Y0B({toolName:Q,toolInput:A.input,cause:C.error});return E.type==="dynamic"?{type:"tool-call",toolCallId:A.toolCallId,toolName:A.toolName,input:C.value,providerExecuted:A.providerExecuted,providerMetadata:A.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:A.toolCallId,toolName:Q,input:C.value,providerExecuted:A.providerExecuted,providerMetadata:A.providerMetadata}}function G9(A){return({steps:B})=>B.length===A}async function y5Q({stopConditions:A,steps:B}){return(await Promise.all(A.map((Q)=>Q({steps:B})))).some((Q)=>Q)}function OFA({output:A,tool:B,errorMode:Q}){if(Q==="text")return{type:"error-text",value:ZR(A)};else if(Q==="json")return{type:"error-json",value:g0B(A)};if(B==null?void 0:B.toModelOutput)return B.toModelOutput(A);return typeof A==="string"?{type:"text",value:A}:{type:"json",value:g0B(A)}}function g0B(A){return A===void 0?null:A}function C0B({content:A,tools:B}){let Q=[],E=A.filter((C)=>C.type!=="source").filter((C)=>(C.type!=="tool-result"||C.providerExecuted)&&(C.type!=="tool-error"||C.providerExecuted)).filter((C)=>C.type!=="text"||C.text.length>0).map((C)=>{switch(C.type){case"text":return{type:"text",text:C.text,providerOptions:C.providerMetadata};case"reasoning":return{type:"reasoning",text:C.text,providerOptions:C.providerMetadata};case"file":return{type:"file",data:C.file.base64,mediaType:C.file.mediaType,providerOptions:C.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:C.toolCallId,toolName:C.toolName,input:C.input,providerExecuted:C.providerExecuted,providerOptions:C.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:C.toolCallId,toolName:C.toolName,output:OFA({tool:B==null?void 0:B[C.toolName],output:C.output,errorMode:"none"}),providerExecuted:!0,providerOptions:C.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:C.toolCallId,toolName:C.toolName,output:OFA({tool:B==null?void 0:B[C.toolName],output:C.error,errorMode:"json"}),providerOptions:C.providerMetadata}}});if(E.length>0)Q.push({role:"assistant",content:E});let g=A.filter((C)=>C.type==="tool-result"||C.type==="tool-error").filter((C)=>!C.providerExecuted).map((C)=>({type:"tool-result",toolCallId:C.toolCallId,toolName:C.toolName,output:OFA({tool:B==null?void 0:B[C.toolName],output:C.type==="tool-result"?C.output:C.error,errorMode:C.type==="tool-error"?"text":"none"})}));if(g.length>0)Q.push({role:"tool",content:g});return Q}function Dd(A,B){let Q=new Headers(A!=null?A:{});for(let[E,g]of Object.entries(B))if(!Q.has(E))Q.set(E,g);return Q}function V5Q({status:A,statusText:B,headers:Q,textStream:E}){return new Response(E.pipeThrough(new TextEncoderStream),{status:A!=null?A:200,statusText:B,headers:Dd(Q,{"content-type":"text/plain; charset=utf-8"})})}function $0B({response:A,status:B,statusText:Q,headers:E,stream:g}){A.writeHead(B!=null?B:200,Q,E);let C=g.getReader();(async()=>{try{while(!0){let{done:w,value:D}=await C.read();if(w)break;A.write(D)}}catch(w){throw w}finally{A.end()}})()}function Z5Q({response:A,status:B,statusText:Q,headers:E,textStream:g}){$0B({response:A,status:B,statusText:Q,headers:Object.fromEntries(Dd(E,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:g.pipeThrough(new TextEncoderStream)})}function q5Q({status:A,statusText:B,headers:Q,stream:E,consumeSseStream:g}){let C=E.pipeThrough(new m0B);if(g){let[I,w]=C.tee();C=I,g({stream:w})}return new Response(C.pipeThrough(new TextEncoderStream),{status:A,statusText:B,headers:Dd(Q,n0B)})}function W5Q({originalMessages:A,responseMessageId:B}){if(A==null)return;let Q=A[A.length-1];return(Q==null?void 0:Q.role)==="assistant"?Q.id:typeof B==="function"?B():B}function z5Q(A){return A.type.startsWith("data-")}function p0B(A,B){if(A===void 0&&B===void 0)return;if(A===void 0)return B;if(B===void 0)return A;let Q={...A};for(let E in B)if(Object.prototype.hasOwnProperty.call(B,E)){let g=B[E];if(g===void 0)continue;let C=E in A?A[E]:void 0,I=g!==null&&typeof g==="object"&&!Array.isArray(g)&&!(g instanceof Date)&&!(g instanceof RegExp),w=C!==null&&C!==void 0&&typeof C==="object"&&!Array.isArray(C)&&!(C instanceof Date)&&!(C instanceof RegExp);if(I&&w)Q[E]=p0B(C,g);else Q[E]=g}return Q}function j5Q(A){let B=["ROOT"],Q=-1,E=null;function g(D,H,L){switch(D){case'"':{Q=H,B.pop(),B.push(L),B.push("INSIDE_STRING");break}case"f":case"t":case"n":{Q=H,E=H,B.pop(),B.push(L),B.push("INSIDE_LITERAL");break}case"-":{B.pop(),B.push(L),B.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{Q=H,B.pop(),B.push(L),B.push("INSIDE_NUMBER");break}case"{":{Q=H,B.pop(),B.push(L),B.push("INSIDE_OBJECT_START");break}case"[":{Q=H,B.pop(),B.push(L),B.push("INSIDE_ARRAY_START");break}}}function C(D,H){switch(D){case",":{B.pop(),B.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{Q=H,B.pop();break}}}function I(D,H){switch(D){case",":{B.pop(),B.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{Q=H,B.pop();break}}}for(let D=0;D<A.length;D++){let H=A[D];switch(B[B.length-1]){case"ROOT":g(H,D,"FINISH");break;case"INSIDE_OBJECT_START":{switch(H){case'"':{B.pop(),B.push("INSIDE_OBJECT_KEY");break}case"}":{Q=D,B.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(H){case'"':{B.pop(),B.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(H){case'"':{B.pop(),B.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(H){case":":{B.pop(),B.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{g(H,D,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{C(H,D);break}case"INSIDE_STRING":{switch(H){case'"':{B.pop(),Q=D;break}case"\\":{B.push("INSIDE_STRING_ESCAPE");break}default:Q=D}break}case"INSIDE_ARRAY_START":{switch(H){case"]":{Q=D,B.pop();break}default:{Q=D,g(H,D,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(H){case",":{B.pop(),B.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{Q=D,B.pop();break}default:{Q=D;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{g(H,D,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{B.pop(),Q=D;break}case"INSIDE_NUMBER":{switch(H){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{Q=D;break}case"e":case"E":case"-":case".":break;case",":{if(B.pop(),B[B.length-1]==="INSIDE_ARRAY_AFTER_VALUE")I(H,D);if(B[B.length-1]==="INSIDE_OBJECT_AFTER_VALUE")C(H,D);break}case"}":{if(B.pop(),B[B.length-1]==="INSIDE_OBJECT_AFTER_VALUE")C(H,D);break}case"]":{if(B.pop(),B[B.length-1]==="INSIDE_ARRAY_AFTER_VALUE")I(H,D);break}default:{B.pop();break}}break}case"INSIDE_LITERAL":{let R=A.substring(E,D+1);if(!"false".startsWith(R)&&!"true".startsWith(R)&&!"null".startsWith(R)){if(B.pop(),B[B.length-1]==="INSIDE_OBJECT_AFTER_VALUE")C(H,D);else if(B[B.length-1]==="INSIDE_ARRAY_AFTER_VALUE")I(H,D)}else Q=D;break}}}let w=A.slice(0,Q+1);for(let D=B.length-1;D>=0;D--)switch(B[D]){case"INSIDE_STRING":{w+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{w+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{w+="]";break}case"INSIDE_LITERAL":{let L=A.substring(E,A.length);if("true".startsWith(L))w+="true".slice(L.length);else if("false".startsWith(L))w+="false".slice(L.length);else if("null".startsWith(L))w+="null".slice(L.length)}}return w}async function r0B(A){if(A===void 0)return{value:void 0,state:"undefined-input"};let B=await jR({text:A});if(B.success)return{value:B.value,state:"successful-parse"};if(B=await jR({text:j5Q(A)}),B.success)return{value:B.value,state:"repaired-parse"};return{value:void 0,state:"failed-parse"}}function NFA(A){return A.type.startsWith("tool-")}function I0B(A){return A.type.split("-").slice(1).join("-")}function v5Q({lastMessage:A,messageId:B}){return{message:(A==null?void 0:A.role)==="assistant"?A:{id:B,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function i5Q({stream:A,messageMetadataSchema:B,dataPartSchemas:Q,runUpdateMessageJob:E,onError:g,onToolCall:C,onData:I}){return A.pipeThrough(new TransformStream({async transform(w,D){await E(async({state:H,write:L})=>{var R,U,G,Y;function J(k){let s=H.message.parts.filter(NFA).find((j)=>j.toolCallId===k);if(s==null)throw Error("tool-output-error must be preceded by a tool-input-available");return s}function c(k){let s=H.message.parts.filter((j)=>j.type==="dynamic-tool").find((j)=>j.toolCallId===k);if(s==null)throw Error("tool-output-error must be preceded by a tool-input-available");return s}function h(k){var q;let s=H.message.parts.find((d)=>NFA(d)&&d.toolCallId===k.toolCallId),j=k,i=s;if(s!=null){if(s.state=k.state,i.input=j.input,i.output=j.output,i.errorText=j.errorText,i.rawInput=j.rawInput,i.preliminary=j.preliminary,i.providerExecuted=(q=j.providerExecuted)!=null?q:s.providerExecuted,j.providerMetadata!=null&&s.state==="input-available")s.callProviderMetadata=j.providerMetadata}else H.message.parts.push({type:`tool-${k.toolName}`,toolCallId:k.toolCallId,state:k.state,input:j.input,output:j.output,rawInput:j.rawInput,errorText:j.errorText,providerExecuted:j.providerExecuted,preliminary:j.preliminary,...j.providerMetadata!=null?{callProviderMetadata:j.providerMetadata}:{}})}function V(k){var q;let s=H.message.parts.find((d)=>d.type==="dynamic-tool"&&d.toolCallId===k.toolCallId),j=k,i=s;if(s!=null){if(s.state=k.state,i.toolName=k.toolName,i.input=j.input,i.output=j.output,i.errorText=j.errorText,i.rawInput=(q=j.rawInput)!=null?q:i.rawInput,i.preliminary=j.preliminary,j.providerMetadata!=null&&s.state==="input-available")s.callProviderMetadata=j.providerMetadata}else H.message.parts.push({type:"dynamic-tool",toolName:k.toolName,toolCallId:k.toolCallId,state:k.state,input:j.input,output:j.output,errorText:j.errorText,preliminary:j.preliminary,...j.providerMetadata!=null?{callProviderMetadata:j.providerMetadata}:{}})}async function T(k){if(k!=null){let q=H.message.metadata!=null?p0B(H.message.metadata,k):k;if(B!=null)await Ed({value:q,schema:B});H.message.metadata=q}}switch(w.type){case"text-start":{let k={type:"text",text:"",providerMetadata:w.providerMetadata,state:"streaming"};H.activeTextParts[w.id]=k,H.message.parts.push(k),L();break}case"text-delta":{let k=H.activeTextParts[w.id];k.text+=w.delta,k.providerMetadata=(R=w.providerMetadata)!=null?R:k.providerMetadata,L();break}case"text-end":{let k=H.activeTextParts[w.id];k.state="done",k.providerMetadata=(U=w.providerMetadata)!=null?U:k.providerMetadata,delete H.activeTextParts[w.id],L();break}case"reasoning-start":{let k={type:"reasoning",text:"",providerMetadata:w.providerMetadata,state:"streaming"};H.activeReasoningParts[w.id]=k,H.message.parts.push(k),L();break}case"reasoning-delta":{let k=H.activeReasoningParts[w.id];k.text+=w.delta,k.providerMetadata=(G=w.providerMetadata)!=null?G:k.providerMetadata,L();break}case"reasoning-end":{let k=H.activeReasoningParts[w.id];k.providerMetadata=(Y=w.providerMetadata)!=null?Y:k.providerMetadata,k.state="done",delete H.activeReasoningParts[w.id],L();break}case"file":{H.message.parts.push({type:"file",mediaType:w.mediaType,url:w.url}),L();break}case"source-url":{H.message.parts.push({type:"source-url",sourceId:w.sourceId,url:w.url,title:w.title,providerMetadata:w.providerMetadata}),L();break}case"source-document":{H.message.parts.push({type:"source-document",sourceId:w.sourceId,mediaType:w.mediaType,title:w.title,filename:w.filename,providerMetadata:w.providerMetadata}),L();break}case"tool-input-start":{let k=H.message.parts.filter(NFA);if(H.partialToolCalls[w.toolCallId]={text:"",toolName:w.toolName,index:k.length,dynamic:w.dynamic},w.dynamic)V({toolCallId:w.toolCallId,toolName:w.toolName,state:"input-streaming",input:void 0});else h({toolCallId:w.toolCallId,toolName:w.toolName,state:"input-streaming",input:void 0,providerExecuted:w.providerExecuted});L();break}case"tool-input-delta":{let k=H.partialToolCalls[w.toolCallId];k.text+=w.inputTextDelta;let{value:q}=await r0B(k.text);if(k.dynamic)V({toolCallId:w.toolCallId,toolName:k.toolName,state:"input-streaming",input:q});else h({toolCallId:w.toolCallId,toolName:k.toolName,state:"input-streaming",input:q});L();break}case"tool-input-available":{if(w.dynamic)V({toolCallId:w.toolCallId,toolName:w.toolName,state:"input-available",input:w.input,providerMetadata:w.providerMetadata});else h({toolCallId:w.toolCallId,toolName:w.toolName,state:"input-available",input:w.input,providerExecuted:w.providerExecuted,providerMetadata:w.providerMetadata});if(L(),C&&!w.providerExecuted)await C({toolCall:w});break}case"tool-input-error":{if(w.dynamic)V({toolCallId:w.toolCallId,toolName:w.toolName,state:"output-error",input:w.input,errorText:w.errorText,providerMetadata:w.providerMetadata});else h({toolCallId:w.toolCallId,toolName:w.toolName,state:"output-error",input:void 0,rawInput:w.input,errorText:w.errorText,providerExecuted:w.providerExecuted,providerMetadata:w.providerMetadata});L();break}case"tool-output-available":{if(w.dynamic){let k=c(w.toolCallId);V({toolCallId:w.toolCallId,toolName:k.toolName,state:"output-available",input:k.input,output:w.output,preliminary:w.preliminary})}else{let k=J(w.toolCallId);h({toolCallId:w.toolCallId,toolName:I0B(k),state:"output-available",input:k.input,output:w.output,providerExecuted:w.providerExecuted,preliminary:w.preliminary})}L();break}case"tool-output-error":{if(w.dynamic){let k=c(w.toolCallId);V({toolCallId:w.toolCallId,toolName:k.toolName,state:"output-error",input:k.input,errorText:w.errorText})}else{let k=J(w.toolCallId);h({toolCallId:w.toolCallId,toolName:I0B(k),state:"output-error",input:k.input,rawInput:k.rawInput,errorText:w.errorText})}L();break}case"start-step":{H.message.parts.push({type:"step-start"});break}case"finish-step":{H.activeTextParts={},H.activeReasoningParts={};break}case"start":{if(w.messageId!=null)H.message.id=w.messageId;if(await T(w.messageMetadata),w.messageId!=null||w.messageMetadata!=null)L();break}case"finish":{if(await T(w.messageMetadata),w.messageMetadata!=null)L();break}case"message-metadata":{if(await T(w.messageMetadata),w.messageMetadata!=null)L();break}case"error":{g==null||g(Error(w.errorText));break}default:if(z5Q(w)){if((Q==null?void 0:Q[w.type])!=null)await Ed({value:w.data,schema:Q[w.type]});let k=w;if(k.transient){I==null||I(k);break}let q=k.id!=null?H.message.parts.find((s)=>k.type===s.type&&k.id===s.id):void 0;if(q!=null)q.data=k.data;else H.message.parts.push(k);I==null||I(k),L()}}D.enqueue(w)})}}))}function s5Q({messageId:A,originalMessages:B=[],onFinish:Q,onError:E,stream:g}){let C=B==null?void 0:B[B.length-1];if((C==null?void 0:C.role)!=="assistant")C=void 0;else A=C.id;let I=!1,w=g.pipeThrough(new TransformStream({transform(U,G){if(U.type==="start"){let Y=U;if(Y.messageId==null&&A!=null)Y.messageId=A}if(U.type==="abort")I=!0;G.enqueue(U)}}));if(Q==null)return w;let D=v5Q({lastMessage:C?structuredClone(C):void 0,messageId:A!=null?A:""}),H=async(U)=>{await U({state:D,write:()=>{}})},L=!1,R=async()=>{if(L||!Q)return;L=!0;let U=D.message.id===(C==null?void 0:C.id);await Q({isAborted:I,isContinuation:U,responseMessage:D.message,messages:[...U?B.slice(0,-1):B,D.message]})};return i5Q({stream:w,runUpdateMessageJob:H,onError:E}).pipeThrough(new TransformStream({transform(U,G){G.enqueue(U)},async cancel(){await R()},async flush(){await R()}}))}function b5Q({response:A,status:B,statusText:Q,headers:E,stream:g,consumeSseStream:C}){let I=g.pipeThrough(new m0B);if(C){let[w,D]=I.tee();I=w,C({stream:D})}$0B({response:A,status:B,statusText:Q,headers:Object.fromEntries(Dd(E,n0B).entries()),stream:I.pipeThrough(new TextEncoderStream)})}function Id(A){let B=A.pipeThrough(new TransformStream);return B[Symbol.asyncIterator]=function(){let Q=this.getReader(),E=!1;async function g(C){var I;E=!0;try{if(C)await((I=Q.cancel)==null?void 0:I.call(Q))}finally{try{Q.releaseLock()}catch(w){}}}return{async next(){if(E)return{done:!0,value:void 0};let{done:C,value:I}=await Q.read();if(C)return await g(!0),{done:!0,value:void 0};return{done:!1,value:I}},async return(){return await g(!0),{done:!0,value:void 0}},async throw(C){throw await g(!0),C}}},B}async function d5Q({stream:A,onError:B}){let Q=A.getReader();try{while(!0){let{done:E}=await Q.read();if(E)break}}catch(E){B==null||B(E)}finally{Q.releaseLock()}}function w0B(){let A,B;return{promise:new Promise((E,g)=>{A=E,B=g}),resolve:A,reject:B}}function _5Q(){let A=[],B=null,Q=!1,E=w0B(),g=()=>{Q=!0,E.resolve(),A.forEach((I)=>I.cancel()),A=[],B==null||B.close()},C=async()=>{if(Q&&A.length===0){B==null||B.close();return}if(A.length===0)return E=w0B(),await E.promise,C();try{let{value:I,done:w}=await A[0].read();if(w){if(A.shift(),A.length>0)await C();else if(Q)B==null||B.close()}else B==null||B.enqueue(I)}catch(I){B==null||B.error(I),A.shift(),g()}};return{stream:new ReadableStream({start(I){B=I},pull:C,async cancel(){for(let I of A)await I.cancel();A=[],Q=!0}}),addStream:(I)=>{if(Q)throw Error("Cannot add inner stream: outer stream is closed");A.push(I.getReader()),E.resolve()},close:()=>{if(Q=!0,E.resolve(),A.length===0)B==null||B.close()},terminate:g}}function t5Q(){var A,B;return(B=(A=globalThis==null?void 0:globalThis.performance)==null?void 0:A.now())!=null?B:Date.now()}function u5Q({tools:A,generatorStream:B,tracer:Q,telemetry:E,system:g,messages:C,abortSignal:I,repairToolCall:w,experimental_context:D}){let H=null,L=new ReadableStream({start(h){H=h}}),R=new Set,U=new Map,G=!1,Y=void 0;function J(){if(G&&R.size===0){if(Y!=null)H.enqueue(Y);H.close()}}let c=new TransformStream({async transform(h,V){let T=h.type;switch(T){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{V.enqueue(h);break}case"file":{V.enqueue({type:"file",file:new O5Q({data:h.data,mediaType:h.mediaType})});break}case"finish":{Y={type:"finish",finishReason:h.finishReason,usage:h.usage,providerMetadata:h.providerMetadata};break}case"tool-call":{try{let k=await N5Q({toolCall:h,tools:A,repairToolCall:w,system:g,messages:C});if(V.enqueue(k),k.invalid){H.enqueue({type:"tool-error",toolCallId:k.toolCallId,toolName:k.toolName,input:k.input,error:Q9(k.error),dynamic:!0});break}let q=A[k.toolName];if(U.set(k.toolCallId,k.input),q.onInputAvailable!=null)await q.onInputAvailable({input:k.input,toolCallId:k.toolCallId,messages:C,abortSignal:I,experimental_context:D});if(q.execute!=null&&k.providerExecuted!==!0){let s=iw();R.add(s),ZFA({name:"ai.toolCall",attributes:FO({telemetry:E,attributes:{...yFA({operationId:"ai.toolCall",telemetry:E}),"ai.toolCall.name":k.toolName,"ai.toolCall.id":k.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(k.input)}}}),tracer:Q,fn:async(j)=>{let i;try{let d=SFA({execute:q.execute.bind(q),input:k.input,options:{toolCallId:k.toolCallId,messages:C,abortSignal:I,experimental_context:D}});for await(let l of d)if(H.enqueue({...k,type:"tool-result",output:l.output,...l.type==="preliminary"&&{preliminary:!0}}),l.type==="final")i=l.output}catch(d){a0B(j,d),H.enqueue({...k,type:"tool-error",error:d}),R.delete(s),J();return}R.delete(s),J();try{j.setAttributes(FO({telemetry:E,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(i)}}}))}catch(d){}}})}}catch(k){H.enqueue({type:"error",error:k})}break}case"tool-result":{let k=h.toolName;if(h.isError)H.enqueue({type:"tool-error",toolCallId:h.toolCallId,toolName:k,input:U.get(h.toolCallId),providerExecuted:h.providerExecuted,error:h.result});else V.enqueue({type:"tool-result",toolCallId:h.toolCallId,toolName:k,input:U.get(h.toolCallId),output:h.result,providerExecuted:h.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${T}`)}},flush(){G=!0,J()}});return new ReadableStream({async start(h){return Promise.all([B.pipeThrough(c).pipeTo(new WritableStream({write(V){h.enqueue(V)},close(){}})),L.pipeTo(new WritableStream({write(V){h.enqueue(V)},close(){h.close()}}))])}})}function G4({model:A,tools:B,toolChoice:Q,system:E,prompt:g,messages:C,maxRetries:I,abortSignal:w,headers:D,stopWhen:H=G9(1),experimental_output:L,experimental_telemetry:R,prepareStep:U,providerOptions:G,experimental_activeTools:Y,activeTools:J=Y,experimental_repairToolCall:c,experimental_transform:h,experimental_download:V,includeRawChunks:T=!1,onChunk:k,onError:q=({error:XA})=>{console.error(XA)},onFinish:s,onAbort:j,onStepFinish:i,experimental_context:d,_internal:{now:l=t5Q,generateId:e=a5Q,currentDate:CA=()=>new Date}={},...SA}){return new $5Q({model:i0B(A),telemetry:R,headers:D,settings:SA,maxRetries:I,abortSignal:w,system:E,prompt:g,messages:C,tools:B,toolChoice:Q,transforms:qFA(h),activeTools:J,repairToolCall:c,stopConditions:qFA(H),output:L,providerOptions:G,prepareStep:U,includeRawChunks:T,onChunk:k,onError:q,onFinish:s,onAbort:j,onStepFinish:i,now:l,currentDate:CA,generateId:e,experimental_context:d,download:V})}function l5Q(A){if(!A)return new TransformStream({transform(I,w){w.enqueue({part:I,partialOutput:void 0})}});let B=void 0,Q="",E="",g="";function C({controller:I,partialOutput:w=void 0}){I.enqueue({part:{type:"text-delta",id:B,text:E},partialOutput:w}),E=""}return new TransformStream({async transform(I,w){if(I.type==="finish-step"&&E.length>0)C({controller:w});if(I.type!=="text-delta"&&I.type!=="text-start"&&I.type!=="text-end"){w.enqueue({part:I,partialOutput:void 0});return}if(B==null)B=I.id;else if(I.id!==B){w.enqueue({part:I,partialOutput:void 0});return}if(I.type==="text-start"){w.enqueue({part:I,partialOutput:void 0});return}if(I.type==="text-end"){if(E.length>0)C({controller:w});w.enqueue({part:I,partialOutput:void 0});return}Q+=I.text,E+=I.text;let D=await A.parsePartial({text:Q});if(D!=null){let H=JSON.stringify(D.partial);if(H!==g)C({controller:w,partialOutput:D.partial}),g=H}}})}function QGB(A,{separator:B=":",languageModelMiddleware:Q}={}){let E=new QsQ({separator:B,languageModelMiddleware:Q});for(let[g,C]of Object.entries(A))E.registerProvider({id:g,provider:C});return E}var u0B,VFA,giQ,CiQ=(A,B)=>{for(var Q in B)giQ(A,Q,{get:B[Q],enumerable:!0})},D0B="AI_NoOutputSpecifiedError",M0B,IiQ,H0B,wiQ,MiQ="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",A0B=!1,HiQ=(A)=>{if(A.length===0)return;let B=globalThis.AI_SDK_LOG_WARNINGS;if(B===!1)return;if(typeof B==="function"){B(A);return}if(!A0B)A0B=!0,console.info(MiQ);for(let Q of A)console.warn(DiQ(Q))},F0B="AI_InvalidArgumentError",L0B,FiQ,U0B,sR,LiQ="AI_InvalidStreamPartError",UiQ,GiQ,RiQ,G0B="AI_InvalidToolInputError",R0B,KiQ,K0B,Y0B,YiQ="AI_MCPClientError",JiQ,SiQ,xiQ,fiQ="AI_NoImageGeneratedError",ciQ,kiQ,oiQ,J0B="AI_NoObjectGeneratedError",S0B,hiQ,x0B,B0B,f0B="AI_NoOutputGeneratedError",c0B,XiQ,k0B,PiQ,o0B="AI_NoSuchToolError",h0B,OiQ,X0B,TFA,P0B="AI_ToolCallRepairError",O0B,NiQ,N0B,TiQ,yiQ,ViQ="AI_InvalidDataContentError",ZiQ,qiQ,WiQ,T0B="AI_InvalidMessageRoleError",y0B,ziQ,V0B,jiQ,viQ="AI_MessageConversionError",iiQ,siQ,biQ,Z0B="AI_DownloadError",q0B,diQ,W0B,PFA,z0B="AI_RetryError",j0B,_iQ,v0B,Q0B,uiQ,aiQ=(A)=>{let B=typeof A==="string"?Lx(A):A,Q=(B[6]&127)<<21|(B[7]&127)<<14|(B[8]&127)<<7|B[9]&127;return B.slice(Q+10)},miQ="5.0.46",niQ=async({url:A})=>{var B;let Q=A.toString();try{let E=await fetch(Q,{headers:DO({},`ai-sdk/${miQ}`,Qd())});if(!E.ok)throw new PFA({url:Q,statusCode:E.status,statusText:E.statusText});return{data:new Uint8Array(await E.arrayBuffer()),mediaType:(B=E.headers.get("content-type"))!=null?B:void 0}}catch(E){if(PFA.isInstance(E))throw E;throw new PFA({url:Q,cause:E})}},piQ=(A=niQ)=>(B)=>Promise.all(B.map(async(Q)=>Q.isUrlSupportedByModel?null:A(Q))),s0B,L9,ag,d0B,w5Q,_0B,D5Q,M5Q,H5Q,t0B,F5Q,L5Q,U5Q,G5Q,R5Q,S5Q,Cd,x5Q,h5Q=({maxRetries:A=2,initialDelayInMs:B=2000,backoffFactor:Q=2,abortSignal:E}={})=>async(g)=>l0B(g,{maxRetries:A,delayInMs:B,backoffFactor:Q,abortSignal:E}),P5Q=class{constructor({data:A,mediaType:B}){let Q=A instanceof Uint8Array;this.base64Data=Q?void 0:A,this.uint8ArrayData=Q?A:void 0,this.mediaType=B}get base64(){if(this.base64Data==null)this.base64Data=HO(this.uint8ArrayData);return this.base64Data}get uint8Array(){if(this.uint8ArrayData==null)this.uint8ArrayData=Lx(this.base64Data);return this.uint8ArrayData}},O5Q,T5Q=class{constructor({content:A,finishReason:B,usage:Q,warnings:E,request:g,response:C,providerMetadata:I}){this.content=A,this.finishReason=B,this.usage=Q,this.warnings=E,this.request=g,this.response=C,this.providerMetadata=I}get text(){return this.content.filter((A)=>A.type==="text").map((A)=>A.text).join("")}get reasoning(){return this.content.filter((A)=>A.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map((A)=>A.text).join("")}get files(){return this.content.filter((A)=>A.type==="file").map((A)=>A.file)}get sources(){return this.content.filter((A)=>A.type==="source")}get toolCalls(){return this.content.filter((A)=>A.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter((A)=>A.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter((A)=>A.dynamic===!0)}get toolResults(){return this.content.filter((A)=>A.type==="tool-result")}get staticToolResults(){return this.toolResults.filter((A)=>A.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter((A)=>A.dynamic===!0)}},QaE,m0B,n0B,waE,wd=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){if(this._promise)return this._promise;return this._promise=new Promise((A,B)=>{if(this.status.type==="resolved")A(this.status.value);else if(this.status.type==="rejected")B(this.status.error);this._resolve=A,this._reject=B}),this._promise}resolve(A){var B;if(this.status={type:"resolved",value:A},this._promise)(B=this._resolve)==null||B.call(this,A)}reject(A){var B;if(this.status={type:"rejected",error:A},this._promise)(B=this._reject)==null||B.call(this,A)}},a5Q,$5Q=class{constructor({model:A,telemetry:B,headers:Q,settings:E,maxRetries:g,abortSignal:C,system:I,prompt:w,messages:D,tools:H,toolChoice:L,transforms:R,activeTools:U,repairToolCall:G,stopConditions:Y,output:J,providerOptions:c,prepareStep:h,includeRawChunks:V,now:T,currentDate:k,generateId:q,onChunk:s,onError:j,onFinish:i,onAbort:d,onStepFinish:l,experimental_context:e,download:CA}){this._totalUsage=new wd,this._finishReason=new wd,this._steps=new wd,this.output=J,this.includeRawChunks=V,this.tools=H;let SA,XA=[],KA=[],m=void 0,u=void 0,IA={},kA=[],QA=[],WA,bA={},FA={},a=new TransformStream({async transform(EA,JA){var r,UA,LA;JA.enqueue(EA);let{part:qA}=EA;if(qA.type==="text-delta"||qA.type==="reasoning-delta"||qA.type==="source"||qA.type==="tool-call"||qA.type==="tool-result"||qA.type==="tool-input-start"||qA.type==="tool-input-delta"||qA.type==="raw")await(s==null?void 0:s({chunk:qA}));if(qA.type==="error")await j({error:Y5Q(qA.error)});if(qA.type==="text-start")bA[qA.id]={type:"text",text:"",providerMetadata:qA.providerMetadata},XA.push(bA[qA.id]);if(qA.type==="text-delta"){let mA=bA[qA.id];if(mA==null){JA.enqueue({part:{type:"error",error:`text part ${qA.id} not found`},partialOutput:void 0});return}mA.text+=qA.text,mA.providerMetadata=(r=qA.providerMetadata)!=null?r:mA.providerMetadata}if(qA.type==="text-end")delete bA[qA.id];if(qA.type==="reasoning-start")FA[qA.id]={type:"reasoning",text:"",providerMetadata:qA.providerMetadata},XA.push(FA[qA.id]);if(qA.type==="reasoning-delta"){let mA=FA[qA.id];if(mA==null){JA.enqueue({part:{type:"error",error:`reasoning part ${qA.id} not found`},partialOutput:void 0});return}mA.text+=qA.text,mA.providerMetadata=(UA=qA.providerMetadata)!=null?UA:mA.providerMetadata}if(qA.type==="reasoning-end"){let mA=FA[qA.id];if(mA==null){JA.enqueue({part:{type:"error",error:`reasoning part ${qA.id} not found`},partialOutput:void 0});return}mA.providerMetadata=(LA=qA.providerMetadata)!=null?LA:mA.providerMetadata,delete FA[qA.id]}if(qA.type==="file")XA.push({type:"file",file:qA.file});if(qA.type==="source")XA.push(qA);if(qA.type==="tool-call")XA.push(qA);if(qA.type==="tool-result"&&!qA.preliminary)XA.push(qA);if(qA.type==="tool-error")XA.push(qA);if(qA.type==="start-step")IA=qA.request,kA=qA.warnings;if(qA.type==="finish-step"){let mA=C0B({content:XA,tools:H}),LB=new T5Q({content:XA,finishReason:qA.finishReason,usage:qA.usage,warnings:kA,request:IA,response:{...qA.response,messages:[...KA,...mA]},providerMetadata:qA.providerMetadata});await(l==null?void 0:l(LB)),HiQ(kA),QA.push(LB),XA=[],FA={},bA={},KA.push(...mA),SA.resolve()}if(qA.type==="finish")u=qA.totalUsage,m=qA.finishReason},async flush(EA){try{if(QA.length===0){let LA=new PiQ({message:"No output generated. Check the stream for errors."});wB._finishReason.reject(LA),wB._totalUsage.reject(LA),wB._steps.reject(LA);return}let JA=m!=null?m:"unknown",r=u!=null?u:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};wB._finishReason.resolve(JA),wB._totalUsage.resolve(r),wB._steps.resolve(QA);let UA=QA[QA.length-1];await(i==null?void 0:i({finishReason:JA,totalUsage:r,usage:UA.usage,content:UA.content,text:UA.text,reasoningText:UA.reasoningText,reasoning:UA.reasoning,files:UA.files,sources:UA.sources,toolCalls:UA.toolCalls,staticToolCalls:UA.staticToolCalls,dynamicToolCalls:UA.dynamicToolCalls,toolResults:UA.toolResults,staticToolResults:UA.staticToolResults,dynamicToolResults:UA.dynamicToolResults,request:UA.request,response:UA.response,warnings:UA.warnings,providerMetadata:UA.providerMetadata,steps:QA})),WA.setAttributes(FO({telemetry:B,attributes:{"ai.response.finishReason":JA,"ai.response.text":{output:()=>UA.text},"ai.response.toolCalls":{output:()=>{var LA;return((LA=UA.toolCalls)==null?void 0:LA.length)?JSON.stringify(UA.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(UA.providerMetadata),"ai.usage.inputTokens":r.inputTokens,"ai.usage.outputTokens":r.outputTokens,"ai.usage.totalTokens":r.totalTokens,"ai.usage.reasoningTokens":r.reasoningTokens,"ai.usage.cachedInputTokens":r.cachedInputTokens}}))}catch(JA){EA.error(JA)}finally{WA.end()}}}),wA=_5Q();this.addStream=wA.addStream,this.closeStream=wA.close;let GA=wA.stream.getReader(),MA=new ReadableStream({async start(EA){EA.enqueue({type:"start"})},async pull(EA){function JA(){d==null||d({steps:QA}),EA.enqueue({type:"abort"}),EA.close()}try{let{done:r,value:UA}=await GA.read();if(r){EA.close();return}if(C==null?void 0:C.aborted){JA();return}EA.enqueue(UA)}catch(r){if(cJ(r)&&(C==null?void 0:C.aborted))JA();else EA.error(r)}},cancel(EA){return wA.stream.cancel(EA)}});for(let EA of R)MA=MA.pipeThrough(EA({tools:H,stopStream(){wA.terminate()}}));this.baseStream=MA.pipeThrough(l5Q(J)).pipeThrough(a);let{maxRetries:TA,retry:OA}=X5Q({maxRetries:g,abortSignal:C}),oB=f5Q(B),aA=g5Q(E),BB=J5Q({model:A,telemetry:B,headers:Q,settings:{...aA,maxRetries:TA}}),wB=this;ZFA({name:"ai.streamText",attributes:FO({telemetry:B,attributes:{...yFA({operationId:"ai.streamText",telemetry:B}),...BB,"ai.prompt":{input:()=>JSON.stringify({system:I,prompt:w,messages:D})}}}),tracer:oB,endWhenDone:!1,fn:async(EA)=>{WA=EA;async function JA({currentStep:r,responseMessages:UA,usage:LA}){var qA,mA,LB,tB,WQ;let WE=wB.includeRawChunks;SA=new wd;let Bw=await K5Q({system:I,prompt:w,messages:D}),TC=[...Bw.messages,...UA],Zg=await(h==null?void 0:h({model:A,steps:QA,stepNumber:QA.length,messages:TC})),hB=await A5Q({prompt:{system:(qA=Zg==null?void 0:Zg.system)!=null?qA:Bw.system,messages:(mA=Zg==null?void 0:Zg.messages)!=null?mA:TC},supportedUrls:await A.supportedUrls,download:CA}),YA=i0B((LB=Zg==null?void 0:Zg.model)!=null?LB:A),{toolChoice:dA,tools:IB}=I5Q({tools:H,toolChoice:(tB=Zg==null?void 0:Zg.toolChoice)!=null?tB:L,activeTools:(WQ=Zg==null?void 0:Zg.activeTools)!=null?WQ:U}),{result:{stream:SB,response:YQ,request:UQ},doStreamSpan:rB,startTimestampMs:n}=await OA(()=>ZFA({name:"ai.streamText.doStream",attributes:FO({telemetry:B,attributes:{...yFA({operationId:"ai.streamText.doStream",telemetry:B}),...BB,"ai.model.provider":YA.provider,"ai.model.id":YA.modelId,"ai.prompt.messages":{input:()=>c5Q(hB)},"ai.prompt.tools":{input:()=>IB==null?void 0:IB.map((hQ)=>JSON.stringify(hQ))},"ai.prompt.toolChoice":{input:()=>dA!=null?JSON.stringify(dA):void 0},"gen_ai.system":YA.provider,"gen_ai.request.model":YA.modelId,"gen_ai.request.frequency_penalty":aA.frequencyPenalty,"gen_ai.request.max_tokens":aA.maxOutputTokens,"gen_ai.request.presence_penalty":aA.presencePenalty,"gen_ai.request.stop_sequences":aA.stopSequences,"gen_ai.request.temperature":aA.temperature,"gen_ai.request.top_k":aA.topK,"gen_ai.request.top_p":aA.topP}}),tracer:oB,endWhenDone:!1,fn:async(hQ)=>{return{startTimestampMs:T(),doStreamSpan:hQ,result:await YA.doStream({...aA,tools:IB,toolChoice:dA,responseFormat:J==null?void 0:J.responseFormat,prompt:hB,providerOptions:c,abortSignal:C,headers:Q,includeRawChunks:WE})}}})),PA=u5Q({tools:H,generatorStream:SB,tracer:oB,telemetry:B,system:I,messages:TC,repairToolCall:G,abortSignal:C,experimental_context:e}),pA=UQ!=null?UQ:{},DB=[],TB=[],eB,JB={},kB="unknown",OB={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},$Q,xE=!0,Pg={id:q(),timestamp:k(),modelId:A.modelId},iI="";wB.addStream(PA.pipeThrough(new TransformStream({async transform(hQ,$E){var bC,AC,QI,dC;if(hQ.type==="stream-start"){eB=hQ.warnings;return}if(xE){let _C=T()-n;xE=!1,rB.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":_C}),rB.setAttributes({"ai.response.msToFirstChunk":_C}),$E.enqueue({type:"start-step",request:pA,warnings:eB!=null?eB:[]})}let Qw=hQ.type;switch(Qw){case"text-start":case"text-end":{$E.enqueue(hQ);break}case"text-delta":{if(hQ.delta.length>0)$E.enqueue({type:"text-delta",id:hQ.id,text:hQ.delta,providerMetadata:hQ.providerMetadata}),iI+=hQ.delta;break}case"reasoning-start":case"reasoning-end":{$E.enqueue(hQ);break}case"reasoning-delta":{$E.enqueue({type:"reasoning-delta",id:hQ.id,text:hQ.delta,providerMetadata:hQ.providerMetadata});break}case"tool-call":{$E.enqueue(hQ),DB.push(hQ);break}case"tool-result":{if($E.enqueue(hQ),!hQ.preliminary)TB.push(hQ);break}case"tool-error":{$E.enqueue(hQ),TB.push(hQ);break}case"response-metadata":{Pg={id:(bC=hQ.id)!=null?bC:Pg.id,timestamp:(AC=hQ.timestamp)!=null?AC:Pg.timestamp,modelId:(QI=hQ.modelId)!=null?QI:Pg.modelId};break}case"finish":{OB=hQ.usage,kB=hQ.finishReason,$Q=hQ.providerMetadata;let _C=T()-n;rB.addEvent("ai.stream.finish"),rB.setAttributes({"ai.response.msToFinish":_C,"ai.response.avgOutputTokensPerSecond":1000*((dC=OB.outputTokens)!=null?dC:0)/_C});break}case"file":{$E.enqueue(hQ);break}case"source":{$E.enqueue(hQ);break}case"tool-input-start":{JB[hQ.id]=hQ.toolName;let _C=H==null?void 0:H[hQ.toolName];if((_C==null?void 0:_C.onInputStart)!=null)await _C.onInputStart({toolCallId:hQ.id,messages:TC,abortSignal:C,experimental_context:e});$E.enqueue({...hQ,dynamic:(_C==null?void 0:_C.type)==="dynamic"});break}case"tool-input-end":{delete JB[hQ.id],$E.enqueue(hQ);break}case"tool-input-delta":{let _C=JB[hQ.id],QQ=H==null?void 0:H[_C];if((QQ==null?void 0:QQ.onInputDelta)!=null)await QQ.onInputDelta({inputTextDelta:hQ.delta,toolCallId:hQ.id,messages:TC,abortSignal:C,experimental_context:e});$E.enqueue(hQ);break}case"error":{$E.enqueue(hQ),kB="error";break}case"raw":{if(WE)$E.enqueue(hQ);break}default:throw Error(`Unknown chunk type: ${Qw}`)}},async flush(hQ){let $E=DB.length>0?JSON.stringify(DB):void 0;try{rB.setAttributes(FO({telemetry:B,attributes:{"ai.response.finishReason":kB,"ai.response.text":{output:()=>iI},"ai.response.toolCalls":{output:()=>$E},"ai.response.id":Pg.id,"ai.response.model":Pg.modelId,"ai.response.timestamp":Pg.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify($Q),"ai.usage.inputTokens":OB.inputTokens,"ai.usage.outputTokens":OB.outputTokens,"ai.usage.totalTokens":OB.totalTokens,"ai.usage.reasoningTokens":OB.reasoningTokens,"ai.usage.cachedInputTokens":OB.cachedInputTokens,"gen_ai.response.finish_reasons":[kB],"gen_ai.response.id":Pg.id,"gen_ai.response.model":Pg.modelId,"gen_ai.usage.input_tokens":OB.inputTokens,"gen_ai.usage.output_tokens":OB.outputTokens}}))}catch(dC){}finally{rB.end()}hQ.enqueue({type:"finish-step",finishReason:kB,usage:OB,providerMetadata:$Q,response:{...Pg,headers:YQ==null?void 0:YQ.headers}});let bC=k5Q(LA,OB);await SA.promise;let AC=DB.filter((dC)=>dC.providerExecuted!==!0),QI=TB.filter((dC)=>dC.providerExecuted!==!0);if(AC.length>0&&QI.length===AC.length&&!await y5Q({stopConditions:Y,steps:QA})){UA.push(...C0B({content:QA[QA.length-1].content,tools:H}));try{await JA({currentStep:r+1,responseMessages:UA,usage:bC})}catch(dC){hQ.enqueue({type:"error",error:dC}),wB.closeStream()}}else hQ.enqueue({type:"finish",finishReason:kB,totalUsage:bC}),wB.closeStream()}})))}await JA({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch((EA)=>{wB.addStream(new ReadableStream({start(JA){JA.enqueue({type:"error",error:EA}),JA.close()}})),wB.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then((A)=>A[A.length-1])}get content(){return this.finalStep.then((A)=>A.content)}get warnings(){return this.finalStep.then((A)=>A.warnings)}get providerMetadata(){return this.finalStep.then((A)=>A.providerMetadata)}get text(){return this.finalStep.then((A)=>A.text)}get reasoningText(){return this.finalStep.then((A)=>A.reasoningText)}get reasoning(){return this.finalStep.then((A)=>A.reasoning)}get sources(){return this.finalStep.then((A)=>A.sources)}get files(){return this.finalStep.then((A)=>A.files)}get toolCalls(){return this.finalStep.then((A)=>A.toolCalls)}get staticToolCalls(){return this.finalStep.then((A)=>A.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then((A)=>A.dynamicToolCalls)}get toolResults(){return this.finalStep.then((A)=>A.toolResults)}get staticToolResults(){return this.finalStep.then((A)=>A.staticToolResults)}get dynamicToolResults(){return this.finalStep.then((A)=>A.dynamicToolResults)}get usage(){return this.finalStep.then((A)=>A.usage)}get request(){return this.finalStep.then((A)=>A.request)}get response(){return this.finalStep.then((A)=>A.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[A,B]=this.baseStream.tee();return this.baseStream=B,A}get textStream(){return Id(this.teeStream().pipeThrough(new TransformStream({transform({part:A},B){if(A.type==="text-delta")B.enqueue(A.text)}})))}get fullStream(){return Id(this.teeStream().pipeThrough(new TransformStream({transform({part:A},B){B.enqueue(A)}})))}async consumeStream(A){var B;try{await d5Q({stream:this.fullStream,onError:A==null?void 0:A.onError})}catch(Q){(B=A==null?void 0:A.onError)==null||B.call(A,Q)}}get experimental_partialOutputStream(){if(this.output==null)throw new wiQ;return Id(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:A},B){if(A!=null)B.enqueue(A)}})))}toUIMessageStream({originalMessages:A,generateMessageId:B,onFinish:Q,messageMetadata:E,sendReasoning:g=!0,sendSources:C=!1,sendStart:I=!0,sendFinish:w=!0,onError:D=ZR}={}){let H=B!=null?W5Q({originalMessages:A,responseMessageId:B}):void 0,L={},R=(G)=>{var Y,J;let c=L[G];return((J=(Y=this.tools)==null?void 0:Y[c])==null?void 0:J.type)==="dynamic"?!0:void 0},U=this.fullStream.pipeThrough(new TransformStream({transform:async(G,Y)=>{let J=E==null?void 0:E({part:G}),c=G.type;switch(c){case"text-start":{Y.enqueue({type:"text-start",id:G.id,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"text-delta":{Y.enqueue({type:"text-delta",id:G.id,delta:G.text,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"text-end":{Y.enqueue({type:"text-end",id:G.id,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"reasoning-start":{Y.enqueue({type:"reasoning-start",id:G.id,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"reasoning-delta":{if(g)Y.enqueue({type:"reasoning-delta",id:G.id,delta:G.text,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"reasoning-end":{Y.enqueue({type:"reasoning-end",id:G.id,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"file":{Y.enqueue({type:"file",mediaType:G.file.mediaType,url:`data:${G.file.mediaType};base64,${G.file.base64}`});break}case"source":{if(C&&G.sourceType==="url")Y.enqueue({type:"source-url",sourceId:G.id,url:G.url,title:G.title,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});if(C&&G.sourceType==="document")Y.enqueue({type:"source-document",sourceId:G.id,mediaType:G.mediaType,title:G.title,filename:G.filename,...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{}});break}case"tool-input-start":{L[G.id]=G.toolName;let h=R(G.id);Y.enqueue({type:"tool-input-start",toolCallId:G.id,toolName:G.toolName,...G.providerExecuted!=null?{providerExecuted:G.providerExecuted}:{},...h!=null?{dynamic:h}:{}});break}case"tool-input-delta":{Y.enqueue({type:"tool-input-delta",toolCallId:G.id,inputTextDelta:G.delta});break}case"tool-call":{L[G.toolCallId]=G.toolName;let h=R(G.toolCallId);if(G.invalid)Y.enqueue({type:"tool-input-error",toolCallId:G.toolCallId,toolName:G.toolName,input:G.input,...G.providerExecuted!=null?{providerExecuted:G.providerExecuted}:{},...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{},...h!=null?{dynamic:h}:{},errorText:D(G.error)});else Y.enqueue({type:"tool-input-available",toolCallId:G.toolCallId,toolName:G.toolName,input:G.input,...G.providerExecuted!=null?{providerExecuted:G.providerExecuted}:{},...G.providerMetadata!=null?{providerMetadata:G.providerMetadata}:{},...h!=null?{dynamic:h}:{}});break}case"tool-result":{let h=R(G.toolCallId);Y.enqueue({type:"tool-output-available",toolCallId:G.toolCallId,output:G.output,...G.providerExecuted!=null?{providerExecuted:G.providerExecuted}:{},...G.preliminary!=null?{preliminary:G.preliminary}:{},...h!=null?{dynamic:h}:{}});break}case"tool-error":{let h=R(G.toolCallId);Y.enqueue({type:"tool-output-error",toolCallId:G.toolCallId,errorText:D(G.error),...G.providerExecuted!=null?{providerExecuted:G.providerExecuted}:{},...h!=null?{dynamic:h}:{}});break}case"error":{Y.enqueue({type:"error",errorText:D(G.error)});break}case"start-step":{Y.enqueue({type:"start-step"});break}case"finish-step":{Y.enqueue({type:"finish-step"});break}case"start":{if(I)Y.enqueue({type:"start",...J!=null?{messageMetadata:J}:{},...H!=null?{messageId:H}:{}});break}case"finish":{if(w)Y.enqueue({type:"finish",...J!=null?{messageMetadata:J}:{}});break}case"abort":{Y.enqueue(G);break}case"tool-input-end":break;case"raw":break;default:throw Error(`Unknown chunk type: ${c}`)}if(J!=null&&c!=="start"&&c!=="finish")Y.enqueue({type:"message-metadata",messageMetadata:J})}}));return Id(s5Q({stream:U,messageId:H!=null?H:B==null?void 0:B(),originalMessages:A,onFinish:Q,onError:D}))}pipeUIMessageStreamToResponse(A,{originalMessages:B,generateMessageId:Q,onFinish:E,messageMetadata:g,sendReasoning:C,sendSources:I,sendFinish:w,sendStart:D,onError:H,...L}={}){b5Q({response:A,stream:this.toUIMessageStream({originalMessages:B,generateMessageId:Q,onFinish:E,messageMetadata:g,sendReasoning:C,sendSources:I,sendFinish:w,sendStart:D,onError:H}),...L})}pipeTextStreamToResponse(A,B){Z5Q({response:A,textStream:this.textStream,...B})}toUIMessageStreamResponse({originalMessages:A,generateMessageId:B,onFinish:Q,messageMetadata:E,sendReasoning:g,sendSources:C,sendFinish:I,sendStart:w,onError:D,...H}={}){return q5Q({stream:this.toUIMessageStream({originalMessages:A,generateMessageId:B,onFinish:Q,messageMetadata:E,sendReasoning:g,sendSources:C,sendFinish:I,sendStart:w,onError:D}),...H})}toTextStreamResponse(A){return V5Q({textStream:this.textStream,...A})}},FaE,UaE,m5Q,n5Q=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:A}){return{partial:A}},async parseOutput({text:A}){return A}}),p5Q=({schema:A})=>{let B=U4(A);return{type:"object",responseFormat:{type:"json",schema:B.jsonSchema},async parsePartial({text:Q}){let E=await r0B(Q);switch(E.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:E.value};default:{let g=E.state;throw Error(`Unsupported parse state: ${g}`)}}},async parseOutput({text:Q},E){let g=await jR({text:Q});if(!g.success)throw new B0B({message:"No object generated: could not parse the response.",cause:g.error,text:Q,response:E.response,usage:E.usage,finishReason:E.finishReason});let C=await oJ({value:g.value,schema:B});if(!C.success)throw new B0B({message:"No object generated: response did not match schema.",cause:C.error,text:Q,response:E.response,usage:E.usage,finishReason:E.finishReason});return C.value}}},r5Q=({model:A,middleware:B,modelId:Q,providerId:E})=>{return qFA(B).reverse().reduce((g,C)=>{return e5Q({model:g,middleware:C,modelId:Q,providerId:E})},A)},e5Q=({model:A,middleware:{transformParams:B,wrapGenerate:Q,wrapStream:E,overrideProvider:g,overrideModelId:C,overrideSupportedUrls:I},modelId:w,providerId:D})=>{var H,L,R;async function U({params:G,type:Y}){return B?await B({params:G,type:Y,model:A}):G}return{specificationVersion:"v2",provider:(H=D!=null?D:g==null?void 0:g({model:A}))!=null?H:A.provider,modelId:(L=w!=null?w:C==null?void 0:C({model:A}))!=null?L:A.modelId,supportedUrls:(R=I==null?void 0:I({model:A}))!=null?R:A.supportedUrls,async doGenerate(G){let Y=await U({params:G,type:"generate"}),J=async()=>A.doGenerate(Y);return Q?Q({doGenerate:J,doStream:async()=>A.doStream(Y),params:Y,model:A}):J()},async doStream(G){let Y=await U({params:G,type:"stream"}),J=async()=>A.doGenerate(Y),c=async()=>A.doStream(Y);return E?E({doGenerate:J,doStream:c,params:Y,model:A}):c()}}},e0B="AI_NoSuchProviderError",AGB,AsQ,BGB,BsQ,QsQ=class{constructor({separator:A,languageModelMiddleware:B}){this.providers={},this.separator=A,this.languageModelMiddleware=B}registerProvider({id:A,provider:B}){this.providers[A]=B}getProvider(A,B){let Q=this.providers[A];if(Q==null)throw new BsQ({modelId:A,modelType:B,providerId:A,availableProviders:Object.keys(this.providers)});return Q}splitId(A,B){let Q=A.indexOf(this.separator);if(Q===-1)throw new hF({modelId:A,modelType:B,message:`Invalid ${B} id for registry: ${A} (must be in the format "providerId${this.separator}modelId")`});return[A.slice(0,Q),A.slice(Q+this.separator.length)]}languageModel(A){var B,Q;let[E,g]=this.splitId(A,"languageModel"),C=(Q=(B=this.getProvider(E,"languageModel")).languageModel)==null?void 0:Q.call(B,g);if(C==null)throw new hF({modelId:A,modelType:"languageModel"});if(this.languageModelMiddleware!=null)C=r5Q({model:C,middleware:this.languageModelMiddleware});return C}textEmbeddingModel(A){var B;let[Q,E]=this.splitId(A,"textEmbeddingModel"),g=this.getProvider(Q,"textEmbeddingModel"),C=(B=g.textEmbeddingModel)==null?void 0:B.call(g,E);if(C==null)throw new hF({modelId:A,modelType:"textEmbeddingModel"});return C}imageModel(A){var B;let[Q,E]=this.splitId(A,"imageModel"),g=this.getProvider(Q,"imageModel"),C=(B=g.imageModel)==null?void 0:B.call(g,E);if(C==null)throw new hF({modelId:A,modelType:"imageModel"});return C}transcriptionModel(A){var B;let[Q,E]=this.splitId(A,"transcriptionModel"),g=this.getProvider(Q,"transcriptionModel"),C=(B=g.transcriptionModel)==null?void 0:B.call(g,E);if(C==null)throw new hF({modelId:A,modelType:"transcriptionModel"});return C}speechModel(A){var B;let[Q,E]=this.splitId(A,"speechModel"),g=this.getProvider(Q,"speechModel"),C=(B=g.speechModel)==null?void 0:B.call(g,E);if(C==null)throw new hF({modelId:A,modelType:"speechModel"});return C}},EsQ,WFA,U9,gsQ,CsQ,SaE,IsQ,wsQ,xaE,DsQ,MsQ,EGB,HsQ,FsQ,LsQ,faE,Md="2.0",UsQ,GsQ,RsQ,KsQ,caE,YsQ,JsQ,SsQ,xsQ,fsQ,csQ,ksQ,osQ,hsQ,oaE;

// === Module: B7 (offset: 0xb9cf73, 1,460 chars) ===
var B7=z(()=>{rw();CB();NF=iA(AQ(),1),hJB=NF.createContext(null)});function OJB({children:A}){let{isAuthenticated:B,isLoading:Q}=Tg(),{user:E,isLoading:g,error:C}=ox(),{isLoading:I,error:w,hasPlan:D}=A7(),{teams:H,selectedTeam:L,isLoading:R,error:U}=ew(),{projects:G,selectedProject:Y,isLoading:J,error:c}=xw(),{sessionId:h,isCreating:V}=hL(),[T,k]=kM.useState(null),q=kM.useCallback((CA)=>{k(CA)},[]),s=kM.useCallback(()=>{k(null)},[]),j=kM.useMemo(()=>{if(C||w||U||c)return"error";if(Q)return"loading";if(!B)return"unauthenticated";if(g||I)return"loading";if(!E)return"error";if(!D)return"no_plan";if(R)return"loading";if(H.length===0)return"error";if(H.length>1&&!L)return"select_team";if(!L)return"loading";if(J)return"loading";if(G.length===0)return"create_project";if(!Y)return"select_project";if(V||!h)return"loading";return"ready"},[B,Q,E,g,C,I,w,D,H,L,R,U,G,Y,J,c,h,V]),i=T??j,d=C||w||U||c,l=kM.useRef(null);kM.useEffect(()=>{if(l.current!==null&&l.current!==i)FI({category:"navigation",message:`App status: ${l.current} \u2192 ${i}`,level:"info",data:{fromStatus:l.current,toStatus:i}});l.current=i},[i]),kM.useEffect(()=>{if(T&&T!=="welcome"&&Y)k(null)},[T,Y]);let e=kM.useMemo(()=>({status:i,error:d,setStatus:q,markWelcomeSeen:s}),[i,d,q,s]);return O.jsxDEV(PJB.Provider,{value:e,children:A},void 0,!1,void 0,this)}function pR(){let A=kM.useContext(PJB);if(!A)throw Error("useAppState must be used within an AppStateProvider");return A}var kM,PJB;
